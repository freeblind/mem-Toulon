<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UE 3.10 S1 ‚Äî Hygi√®ne & pr√©vention des infections (Quiz)</title>
  <style>
    *{margin:0;padding:0;box-sizing:border-box}
    :root{
      --primary:#667eea;
      --primary2:#764ba2;
      --bg:#f1f3f6;
      --card:#f8f9fa;
      --white:#ffffff;
      --text:#2c3e50;
      --muted:#6c757d;
      --ok:#2ecc71;
      --warn:#f39c12;
      --bad:#e74c3c;
      --line:#e3e7ee;
      --shadow:0 10px 26px rgba(0,0,0,.08);
      --radius:16px;
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Noto Sans", "Liberation Sans", sans-serif;
    }
    body{
      font-family:var(--sans);
      background:linear-gradient(135deg,var(--primary),var(--primary2));
      min-height:100vh;
      color:var(--text);
      padding:22px;
    }
    .wrap{max-width:1200px;margin:0 auto}
    header{
      background:rgba(255,255,255,.18);
      border:1px solid rgba(255,255,255,.22);
      border-radius:22px;
      padding:20px 20px 16px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      color:#fff;
    }
    .headTop{display:flex;gap:16px;justify-content:space-between;align-items:flex-start;flex-wrap:wrap}
    h1{font-size:22px;letter-spacing:.3px;font-weight:800}
    .sub{margin-top:8px;font-size:14px;opacity:.92;line-height:1.4}
    .controls{
      display:flex;gap:12px;align-items:center;flex-wrap:wrap;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      padding:12px 14px;border-radius:16px;
    }
    .controls label{font-size:13px;opacity:.95;display:flex;gap:8px;align-items:center;user-select:none;font-weight:600}
    .controls input[type="checkbox"]{transform:translateY(1px)}
    .btnRow{margin-top:14px;display:flex;gap:12px;flex-wrap:wrap}
    button{
      border:0;
      cursor:pointer;
      border-radius:14px;
      padding:11px 14px;
      font-weight:700;
      box-shadow: var(--shadow);
      background:#fff;
      color:var(--text);
      transition: transform .06s ease, opacity .15s ease;
      font-size:13px;
    }
    button:hover{transform: translateY(-1px)}
    button:active{transform: translateY(0px)}
    .primaryBtn{background:linear-gradient(135deg,#ffffff,#f1f3ff)}
    .dangerBtn{background:linear-gradient(135deg,#ffe8ea,#fff);color:#b71c1c}
    .ghostBtn{background:rgba(255,255,255,.15);border:1px solid rgba(255,255,255,.25);color:#fff}
    main{margin-top:16px}
    .tabs{
      display:flex;gap:12px;flex-wrap:wrap;
      padding:14px 14px 4px;
    }
    .tab{
      border:0;
      border-radius:999px;
      padding:12px 18px;
      font-weight:800;
      background:rgba(255,255,255,.20);
      color:#fff;
      opacity:.86;
      box-shadow: 0 8px 18px rgba(0,0,0,.10);
      font-size:14px;
    }
    .tab.active{opacity:1;background:#fff;color:var(--primary2)}
    .panel{
      background:var(--bg);
      border-radius:22px;
      padding:16px;
      box-shadow: var(--shadow);
      border:1px solid rgba(255,255,255,.35);
    }
    .panelHead{
      display:flex;justify-content:space-between;align-items:flex-start;gap:16px;flex-wrap:wrap;
      padding:12px 10px 10px;
    }
    .panelHead h2{font-size:17px;font-weight:800}
    .kpis{display:flex;gap:12px;flex-wrap:wrap}
    .kpi{
      background:var(--white);
      border:1px solid var(--line);
      border-radius:14px;
      padding:12px 14px;
      box-shadow: var(--shadow);
      min-width:140px;
    }
    .kpi .kTitle{font-size:11px;color:var(--muted);margin-bottom:5px;font-weight:700;text-transform:uppercase;letter-spacing:.3px}
    .kpi .kVal{font-weight:900;font-family:var(--mono);font-size:18px}
    .kpi .kSub{margin-top:3px;font-size:11px;color:var(--muted)}
    .intro{padding:0 10px 12px;color:var(--muted);font-size:14px;line-height:1.5}
    .content{display:grid;grid-template-columns:1fr;gap:14px;padding:12px}
    .card{
      background:var(--white);
      border:1px solid var(--line);
      border-radius: var(--radius);
      padding:16px;
      box-shadow: var(--shadow);
      transition: box-shadow .2s ease;
    }
    .card:hover{box-shadow: 0 12px 30px rgba(0,0,0,.12)}
    .card h3{font-size:15px;margin-bottom:10px;line-height:1.3;font-weight:800}
    .badge{
      display:inline-block;
      padding:5px 11px;
      border-radius:999px;
      font-size:11px;
      font-weight:900;
      margin-left:8px;
      border:1px solid var(--line);
      background:#fff;
      vertical-align:middle;
    }
    .badge.muted{color:var(--muted);font-weight:800}
    .badge.ok{background:rgba(46,204,113,.10);border-color:rgba(46,204,113,.25);color:#167c3b}
    .badge.warn{background:rgba(243,156,18,.12);border-color:rgba(243,156,18,.25);color:#8a5a00}
    .badge.bad{background:rgba(231,76,60,.10);border-color:rgba(231,76,60,.25);color:#a82217}
    .meta{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .meta .chip{
      font-family:var(--mono);
      font-size:11px;
      padding:5px 11px;
      border-radius:999px;
      border:1px solid var(--line);
      color:var(--muted);
      background:var(--card);
      font-weight:700;
    }
    .qtext{font-size:14px;line-height:1.55;margin-bottom:12px}
    .qtext b{font-weight:900}
    .muted{color:var(--muted)}
    
    /* Styled context box for AES scenarios */
    .contextBox{
      background:linear-gradient(135deg, #f8f9ff 0%, #fff5f5 100%);
      border:2px solid rgba(102,126,234,.15);
      border-radius:14px;
      padding:14px 16px;
      margin-bottom:14px;
    }
    .contextBox .contextTitle{
      font-size:12px;
      font-weight:900;
      text-transform:uppercase;
      letter-spacing:.5px;
      color:var(--primary2);
      margin-bottom:8px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .contextBox .contextTitle::before{
      content:"üìã";
      font-size:14px;
    }
    .contextBox .contextText{
      font-size:13px;
      line-height:1.6;
      color:#34495e;
    }
    .contextBox .contextText b{
      font-weight:800;
      color:var(--text);
    }
    
    textarea, input[type="text"], input[type="number"]{
      width:100%;
      border:1px solid var(--line);
      border-radius:14px;
      padding:11px 13px;
      outline:none;
      background:#fff;
      font-family:var(--sans);
      font-size:13px;
    }
    textarea{min-height:120px;resize:vertical}
    .opts{display:grid;gap:9px;margin-top:10px}
    .opt{
      display:flex;gap:11px;align-items:flex-start;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--card);
      transition: all .15s ease;
    }
    .opt:hover{background:#fff;border-color:rgba(102,126,234,.25)}
    .opt input{margin-top:3px}
    .inline{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
    .inline button{
      padding:10px 13px;
      box-shadow:none;
      border:1px solid var(--line);
      background:#fff;
      font-weight:800;
    }
    .help{
      font-size:12px;color:var(--muted);
      margin-top:10px;line-height:1.5;
    }
    .feedback{
      margin-top:12px;
      border-radius:14px;
      padding:12px 14px;
      border:1px solid var(--line);
      background: #fff;
      line-height:1.55;
      font-size:13px;
    }
    .feedback.ok{border-color:rgba(46,204,113,.35);background:rgba(46,204,113,.07)}
    .feedback.warn{border-color:rgba(243,156,18,.35);background:rgba(243,156,18,.08)}
    .feedback.bad{border-color:rgba(231,76,60,.35);background:rgba(231,76,60,.07)}
    .feedback ul{margin:10px 0 0 20px}
    .feedback li{margin:5px 0}
    .twoCol{display:grid;grid-template-columns:1fr;gap:12px}
    @media(min-width:900px){
      .content.two{grid-template-columns:1fr 1fr}
      .twoCol{grid-template-columns:1fr 1fr}
    }

    /* TF / Binary blocks */
    .tfTable{display:grid;gap:9px;margin-top:10px}
    .tfRow{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      align-items:center;
      padding:11px 12px;
      border:1px solid var(--line);
      border-radius:14px;
      background:var(--card);
      transition: background .15s ease;
    }
    .tfRow:hover{background:#fff}
    .tfBtns{display:flex;gap:8px;flex-wrap:wrap;justify-content:flex-end}
    .choiceBtn{
      border:1px solid var(--line);
      background:#fff;
      border-radius:999px;
      padding:8px 11px;
      font-weight:900;
      box-shadow:none;
      font-size:12px;
      color:var(--muted);
      transition: all .15s ease;
    }
    .choiceBtn:hover{border-color:rgba(102,126,234,.3)}
    .choiceBtn.active{
      color:var(--primary2);
      border-color: rgba(102,126,234,.40);
      background: rgba(102,126,234,.10);
    }

    /* Stage sort */
    .stageBox{border:1px solid var(--line);background:var(--card);border-radius:14px;padding:12px}
    .step{
      display:grid;
      grid-template-columns: 1fr auto;
      gap:12px;
      align-items:center;
      padding:11px 12px;
      border:1px solid var(--line);
      background:#fff;
      border-radius:14px;
      margin:9px 0;
      transition: box-shadow .15s ease;
    }
    .step:hover{box-shadow: 0 4px 12px rgba(0,0,0,.08)}
    .step .stepText{font-size:13px;line-height:1.4}
    .step .stepBtns{display:flex;gap:8px}
    .miniBtn{
      border:1px solid var(--line);
      background:var(--card);
      border-radius:12px;
      padding:7px 11px;
      font-weight:900;
      box-shadow:none;
      font-size:11px;
      color:var(--muted);
      min-width:36px;
      transition: all .15s ease;
    }
    .miniBtn:hover{background:#fff;border-color:rgba(102,126,234,.3)}
    .exportPanel{margin-top:12px;padding:12px;border:1px solid var(--line);border-radius:14px;background:var(--card);display:none}
    .exportPanel.visible{display:block}
    .exportPanel textarea{font-family:var(--mono);font-size:11px;min-height:140px}
  </style>
</head>
<body>
<div class="wrap">
<header>
  <div class="headTop">
    <div>
      <h1>UE 3.10 S1 ‚Äî Hygi√®ne & pr√©vention des infections</h1>
      <div class="sub">Quiz interactif ‚Äî Formation MEM ‚Ä¢ Situations cliniques vari√©es</div>
    </div>
    <div class="controls">
      <label><input type="checkbox" id="shuffle"> M√©langer</label>
      <label><input type="checkbox" id="hideHelp"> Masquer aides</label>
    </div>
  </div>
  <div class="btnRow">
    <button class="primaryBtn" id="checkAll">‚úì Tout corriger</button>
    <button id="resetTab">‚Üª R√©initialiser l'onglet</button>
    <button class="dangerBtn" id="resetAll">‚úó Tout effacer</button>
    <button class="ghostBtn" id="toggleExport">üìä Import/Export</button>
  </div>
</header>

<main>
  <div class="tabs">
    <button class="tab active" data-tab="qcm">QCM G√©n√©ral</button>
    <button class="tab" data-tab="vf">Vrai / Faux</button>
    <button class="tab" data-tab="cas_aes">Cas cliniques AES</button>
    <button class="tab" data-tab="dechets">D√©chets</button>
  </div>

  <div class="panel">
    <div class="panelHead">
      <h2 id="panelTitle">Questions</h2>
      <div class="kpis">
        <div class="kpi">
          <div class="kTitle">Progression</div>
          <div class="kVal" id="kpiDone">‚Äî</div>
          <div class="kSub" id="kpiSub">questions</div>
        </div>
        <div class="kpi">
          <div class="kTitle">Score</div>
          <div class="kVal" id="kpiScore">‚Äî</div>
          <div class="kSub">points</div>
        </div>
      </div>
    </div>
    <div class="intro" id="intro"></div>
    <div class="content" id="content"></div>
    <div class="exportPanel" id="exportPanel">
      <h3 style="font-size:14px;margin-bottom:10px">Import / Export de progression</h3>
      <textarea id="jsonArea" placeholder="Export / Import JSON (sauvegarde / restauration de ta progression)"></textarea>
      <div style="margin-top:10px;display:flex;gap:10px">
        <button id="exportBtn">üì§ Copier export</button>
        <button id="importBtn">üì• Importer sauvegarde</button>
      </div>
    </div>
  </div>
</main>
</div>

<script>
const STORAGE_KEY = "ue3_10_quiz_v2";
const esc = s => s.replace(/</g,"&lt;").replace(/>/g,"&gt;");
const labelType = t => ({mcq:"QCM",tf_block:"Vrai / Faux",stage_sort:"Ordre des √©tapes"}[t] || t);

/* ---------- Questions ---------- */
function makeQcmQuestions(){
  return [
    {
      id:"QCM_HYGIENE_MAINS", type:"mcq", points:2,
      title:"QCM 1 ‚Äî Hygi√®ne des mains : g√©n√©ralit√©s",
      prompt:"Parmi les affirmations suivantes, lesquelles sont vraies ?",
      multi:true,
      options:[
        {id:"a", text:"L'hygi√®ne des mains est la mesure la plus efficace pour pr√©venir les infections nosocomiales", correct:true},
        {id:"b", text:"Il faut r√©aliser une hygi√®ne des mains avant et apr√®s tout contact patient", correct:true},
        {id:"c", text:"Les bijoux aux mains sont acceptables s'ils sont d√©sinfect√©s avant chaque soin", correct:false},
        {id:"d", text:"Les ongles courts et sans vernis sont recommand√©s pour les professionnels de sant√©", correct:true}
      ],
      explain:"Les bijoux (bagues, bracelets) doivent √™tre retir√©s car ils emp√™chent une hygi√®ne efficace. Le vernis √† ongles est proscrit car il favorise la persistance de microorganismes."
    },
    {
      id:"QCM_PRECAUTIONS_STANDARD", type:"mcq", points:2,
      title:"QCM 2 ‚Äî Pr√©cautions standard",
      prompt:"Les pr√©cautions standard s'appliquent :",
      multi:false,
      options:[
        {id:"a", text:"Uniquement aux patients connus infect√©s", correct:false},
        {id:"b", text:"√Ä tous les patients, tout le temps", correct:true},
        {id:"c", text:"Seulement en cas d'√©pid√©mie", correct:false},
        {id:"d", text:"Uniquement aux patients immunod√©prim√©s", correct:false}
      ],
      explain:"Les pr√©cautions standard sont universelles : elles s'appliquent √† tous les patients, sans exception, car tout patient peut √™tre porteur d'agents infectieux, connus ou non."
    },
    {
      id:"QCM_EPI", type:"mcq", points:3,
      title:"QCM 3 ‚Äî √âquipements de protection individuelle",
      prompt:"Quels EPI sont n√©cessaires pour un soin avec risque de projection de liquides biologiques ?",
      multi:true,
      options:[
        {id:"a", text:"Gants √† usage unique", correct:true},
        {id:"b", text:"Masque chirurgical ou FFP2 selon le risque", correct:true},
        {id:"c", text:"Lunettes ou visi√®re de protection", correct:true},
        {id:"d", text:"Surblouse imperm√©able si risque important", correct:true},
        {id:"e", text:"Charlotte (toujours obligatoire)", correct:false}
      ],
      explain:"Le choix des EPI d√©pend du risque : projections/a√©rosolisation ‚Üí masque + protection oculaire + tablier/surblouse si besoin. La charlotte n'est pas syst√©matique."
    },
    {
      id:"QCM_PS_AXES", type:"mcq", points:3,
      title:"QCM 4 ‚Äî Les 6 axes des pr√©cautions standard",
      prompt:"Quelle proposition liste correctement les 6 axes des pr√©cautions standard ?",
      multi:false,
      options:[
        {id:"a", text:"Hygi√®ne des mains / EPI / Hygi√®ne respiratoire / Pr√©vention AES / Gestion des excreta / Gestion de l‚Äôenvironnement", correct:true},
        {id:"b", text:"Hygi√®ne des mains / Vaccination / Isolement / Antibioth√©rapie / D√©pistage / St√©rilisation", correct:false},
        {id:"c", text:"EPI / Bio-nettoyage / Circuit du m√©dicament / Tra√ßabilit√© / Gestion des repas / St√©rilisation", correct:false},
        {id:"d", text:"Hygi√®ne respiratoire / Port de surchaussures / Port de charlotte / Port de FFP3 / Douche / D√©sinfection a√©rienne", correct:false}
      ],
      explain:"Les 6 axes sont : hygi√®ne des mains, EPI/tenue, hygi√®ne respiratoire, pr√©vention AES/AEV, gestion des excreta, gestion de l‚Äôenvironnement."
    },
    {
      id:"QCM_SHA_CONDITION", type:"mcq", points:2,
      title:"QCM 5 ‚Äî SHA : condition d‚Äôutilisation",
      prompt:"La condition indispensable (sine qua non) pour utiliser une solution hydroalcoolique (SHA) est :",
      multi:false,
      options:[
        {id:"a", text:"Mains mouill√©es pour am√©liorer la diffusion", correct:false},
        {id:"b", text:"Mains visiblement propres et s√®ches (non souill√©es)", correct:true},
        {id:"c", text:"Port de gants obligatoire", correct:false},
        {id:"d", text:"SHA uniquement apr√®s un lavage au savon", correct:false}
      ],
      explain:"La SHA s‚Äôutilise sur des mains s√®ches et non souill√©es. Si mains souill√©es/mouill√©es ‚Üí lavage au savon."
    },
    {
      id:"QCM_SHA_VS_LAVAGE", type:"mcq", points:2,
      title:"QCM 6 ‚Äî SHA vs lavage",
      prompt:"Dans quel cas la friction SHA n'est-elle PAS suffisante et un lavage au savon est n√©cessaire ?",
      multi:true,
      options:[
        {id:"a", text:"Mains visiblement souill√©es", correct:true},
        {id:"b", text:"Mains mouill√©es", correct:true},
        {id:"c", text:"Suspicion/risque de spores (ex : Clostridioides difficile)", correct:true},
        {id:"d", text:"Avant un contact social avec un patient", correct:false},
        {id:"e", text:"Apr√®s retrait de gants, mains propres et s√®ches", correct:false}
      ],
      explain:"La friction ne remplace pas le lavage si mains souill√©es ou mouill√©es, et en contexte de spores."
    },
    {
      id:"QCM_GANTS_REGLE", type:"mcq", points:2,
      title:"QCM 7 ‚Äî R√®gle d‚Äôor des gants",
      prompt:"Quelle r√®gle est correcte concernant les gants √† usage unique (UU) ?",
      multi:false,
      options:[
        {id:"a", text:"1 paire = 1 patient = 1 soin (puis √©limination)", correct:true},
        {id:"b", text:"On peut garder la m√™me paire de gants pour plusieurs patients si on les frictionne au SHA", correct:false},
        {id:"c", text:"On peut stocker des gants dans la poche pour gagner du temps", correct:false},
        {id:"d", text:"Les gants dispensent de l‚Äôhygi√®ne des mains", correct:false}
      ],
      explain:"Les gants UU ne se lavent pas et ne se frictionnent pas. Ils ne dispensent jamais de l‚ÄôHDM."
    },
    {
      id:"QCM_GANTS_INDICATIONS", type:"mcq", points:3,
      title:"QCM 8 ‚Äî Indications de port de gants",
      prompt:"Dans quelles situations le port de gants UU est-il indiqu√© ?",
      multi:true,
      options:[
        {id:"a", text:"Risque de contact avec du sang ou des liquides biologiques", correct:true},
        {id:"b", text:"Contact avec peau l√©s√©e (plaie, escarre)", correct:true},
        {id:"c", text:"Manipulation de produits chimiques/d√©tergents (adapt√© au risque)", correct:true},
        {id:"d", text:"Prendre le pouls radial (peau intacte, sans liquide biologique)", correct:false},
        {id:"e", text:"R√©aliser une toilette compl√®te d‚Äôun patient non contamin√© (sans risque souillant)", correct:false}
      ],
      explain:"Gants si exposition √† liquides biologiques/peau l√©s√©e/produits chimiques, pas ‚Äúautomatiques‚Äù pour tout geste."
    },
    {
      id:"QCM_MASQUE_CHIR", type:"mcq", points:2,
      title:"QCM 9 ‚Äî Masque chirurgical : port et changement",
      prompt:"Le masque chirurgical :",
      multi:true,
      options:[
        {id:"a", text:"Doit couvrir nez, bouche et menton (pas en collier)", correct:true},
        {id:"b", text:"Se manipule surtout lors de la pose et du retrait, puis HDM", correct:true},
        {id:"c", text:"Se change d√®s qu‚Äôil est mouill√©/souill√© et au maximum toutes les 3 heures en port prolong√©", correct:true},
        {id:"d", text:"Prot√®ge contre les infections strictement ‚Äúa√©riennes‚Äù (tuberculose BK+ par ex.)", correct:false}
      ],
      explain:"Le masque chirurgical prot√®ge surtout en ‚Äúgouttelettes‚Äù et doit √™tre chang√© si souill√©/mouill√©, et en port prolong√© (r√©f√©rence 3h dans tes supports)."
    },
    {
      id:"QCM_FFP2", type:"mcq", points:3,
      title:"QCM 10 ‚Äî Pr√©cautions ¬´ air ¬ª : tuberculose",
      prompt:"Pour un patient atteint de tuberculose pulmonaire contagieuse (BK+), la protection respiratoire du soignant est :",
      multi:false,
      options:[
        {id:"a", text:"Aucun masque si distance > 2 m√®tres", correct:false},
        {id:"b", text:"Un masque chirurgical", correct:false},
        {id:"c", text:"Un appareil de protection respiratoire (APR) de type FFP1 (selon protocole)", correct:true},
        {id:"d", text:"Un APR FFP2 uniquement en toute situation", correct:false}
      ],
      explain:"En pr√©cautions ¬´ air ¬ª, la protection du soignant repose sur un APR de type FFP (dans tes supports : FFP1 pour tuberculose contagieuse ; FFP2 plut√¥t en situation de tuberculose multir√©sistante, selon protocole local)."
    },
    {
      id:"QCM_HYGIENE_RESP", type:"mcq", points:2,
      title:"QCM 11 ‚Äî Hygi√®ne respiratoire",
      prompt:"Quels √©l√©ments font partie de l‚Äôhygi√®ne respiratoire ?",
      multi:true,
      options:[
        {id:"a", text:"Port du masque (selon situation)", correct:true},
        {id:"b", text:"Mouchoirs √† usage unique + √©limination imm√©diate", correct:true},
        {id:"c", text:"Hygi√®ne des mains apr√®s contact avec des s√©cr√©tions", correct:true},
        {id:"d", text:"Port syst√©matique de surchaussures", correct:false}
      ],
      explain:"Trio classique : masque / mouchoirs UU + √©limination / HDM apr√®s contact avec s√©cr√©tions."
    },
    {
      id:"QCM_AES_DEF", type:"mcq", points:2,
      title:"QCM 12 ‚Äî D√©finition d‚Äôun AES/AEV",
      prompt:"Un AES/AEV correspond √† :",
      multi:false,
      options:[
        {id:"a", text:"Toute projection sur peau intacte, quel que soit le liquide", correct:false},
        {id:"b", text:"Une exposition accidentelle √† du sang/liquides biologiques par piq√ªre, coupure, projection muqueuse ou contact sur peau l√©s√©e", correct:true},
        {id:"c", text:"Tout contact avec un patient en isolement", correct:false},
        {id:"d", text:"Toute toux d‚Äôun patient en chambre", correct:false}
      ],
      explain:"AES = exposition par effraction cutan√©e / muqueuse / peau l√©s√©e √† sang ou liquide biologique."
    },
    {
      id:"QCM_AES_PREVENTION", type:"mcq", points:3,
      title:"QCM 13 ‚Äî Pr√©vention des AES",
      prompt:"Quelles mesures contribuent √† pr√©venir les AES/AEV ?",
      multi:true,
      options:[
        {id:"a", text:"Utiliser un collecteur OPCT √† port√©e de main", correct:true},
        {id:"b", text:"√âliminer imm√©diatement les OPCT sans recapuchonnage", correct:true},
        {id:"c", text:"Utiliser du mat√©riel s√©curis√© quand disponible", correct:true},
        {id:"d", text:"Recapuchonner l‚Äôaiguille pour √©viter de se piquer", correct:false},
        {id:"e", text:"D√©clarer tout AES sans d√©lai", correct:true}
      ],
      explain:"Pr√©vention : collecteur proche, pas de recapuchonnage, mat√©riel s√©curis√©, organisation, et d√©claration rapide."
    },
    {
      id:"QCM_AES_DELAI", type:"mcq", points:2,
      title:"QCM 14 ‚Äî D√©lai de prise en charge AES",
      prompt:"Apr√®s un AES/AEV, la prise en charge doit √™tre d√©marr√©e :",
      multi:false,
      options:[
        {id:"a", text:"Dans la limite des 4 heures", correct:true},
        {id:"b", text:"Dans la semaine", correct:false},
        {id:"c", text:"√Ä la fin du stage", correct:false},
        {id:"d", text:"Uniquement si le patient source est identifi√©", correct:false}
      ],
      explain:"Tes proc√©dures insistent sur un d√©marrage imp√©ratif dans la limite des 4 heures (signalement + √©valuation)."
    },
    {
      id:"QCM_DAS_DASRI", type:"mcq", points:2,
      title:"QCM 15 ‚Äî DAS vs DASRI",
      prompt:"Quelle r√®gle est la plus juste pour distinguer DAS et DASRI ?",
      multi:false,
      options:[
        {id:"a", text:"Tout d√©chet venant d‚Äôun patient est DASRI", correct:false},
        {id:"b", text:"OPCT (piquants/coupants) et d√©chets souill√©s par sang/liquides biologiques ‚Üí DASRI ; emballages propres ‚Üí DAS (selon protocole)", correct:true},
        {id:"c", text:"Les masques vont toujours en DASRI", correct:false},
        {id:"d", text:"Les gants vont toujours en DAS", correct:false}
      ],
      explain:"R√®gle simplifi√©e : OPCT + souillures biologiques ‚Üí DASRI. Emballages propres ‚Üí DAS, en respectant le protocole local."
    },
    {
      id:"QCM_TENUE_OBLIG", type:"mcq", points:3,
      title:"QCM 16 ‚Äî Tenue professionnelle : √©l√©ments obligatoires",
      prompt:"Quels √©l√©ments rel√®vent des exigences de tenue professionnelle (pr√©requis) ?",
      multi:true,
      options:[
        {id:"a", text:"Manches courtes", correct:true},
        {id:"b", text:"Cheveux attach√©s", correct:true},
        {id:"c", text:"Z√©ro bijou aux mains/poignets", correct:true},
        {id:"d", text:"Chaussures ferm√©es, lavables, d√©di√©es au travail", correct:true},
        {id:"e", text:"Vernis √† ongles discret autoris√©", correct:false}
      ],
      explain:"Pr√©requis : hygi√®ne, manches courtes, cheveux attach√©s, 0 bijou, ongles courts sans vernis, chaussures adapt√©es."
    },
    {
      id:"QCM_SURBLOUSE", type:"mcq", points:2,
      title:"QCM 17 ‚Äî Tablier / surblouse UU",
      prompt:"Le tablier ou la surblouse UU :",
      multi:true,
      options:[
        {id:"a", text:"S‚Äôutilise en cas de soins mouillants/souillants ou risque de projections", correct:true},
        {id:"b", text:"Se limite au lieu m√™me des soins (ne pas circuler avec)", correct:true},
        {id:"c", text:"Se conserve pour plusieurs patients si elle est ‚Äúpeu sale‚Äù", correct:false},
        {id:"d", text:"Se change entre 2 patients ou 2 activit√©s diff√©rentes", correct:true}
      ],
      explain:"Protection tenue : limit√©e au soin, chang√©e selon activit√©/patient, √©limination dans la fili√®re adapt√©e."
    },
    {
      id:"QCM_ENVIRONNEMENT", type:"mcq", points:2,
      title:"QCM 18 ‚Äî Gestion de l‚Äôenvironnement",
      prompt:"Parmi les actions suivantes, lesquelles rel√®vent de la gestion de l‚Äôenvironnement (pr√©cautions standard) ?",
      multi:true,
      options:[
        {id:"a", text:"Nettoyer et d√©sinfecter les surfaces souill√©es", correct:true},
        {id:"b", text:"Respecter les circuits du linge et des d√©chets (transport √©tanche, sacs ferm√©s)", correct:true},
        {id:"c", text:"Immersion/pr√©-d√©sinfection du mat√©riel r√©utilisable selon proc√©dure", correct:true},
        {id:"d", text:"Prescrire une antibioth√©rapie prophylactique √† tous les patients", correct:false}
      ],
      explain:"La gestion de l‚Äôenvironnement comprend mat√©riel r√©utilisable, bio-nettoyage, circuits linge/d√©chets."
    },
    {
      id:"QCM_CHAINE_EPID", type:"mcq", points:3,
      title:"QCM 19 ‚Äî Cha√Æne √©pid√©miologique",
      prompt:"Quelles composantes font partie de la cha√Æne √©pid√©miologique (transmission d‚Äôun agent infectieux) ?",
      multi:true,
      options:[
        {id:"a", text:"R√©servoir / source", correct:true},
        {id:"b", text:"Mode de transmission (contact, gouttelettes, air‚Ä¶)", correct:true},
        {id:"c", text:"Porte d‚Äôentr√©e", correct:true},
        {id:"d", text:"H√¥te r√©ceptif (terrain)", correct:true},
        {id:"e", text:"Couleur de l‚Äôuniforme du soignant", correct:false}
      ],
      explain:"Cha√Æne : r√©servoir ‚Üí transmission ‚Üí porte d‚Äôentr√©e ‚Üí h√¥te r√©ceptif (et porte de sortie selon mod√®les)."
    },
    {
      id:"QCM_TERMS", type:"mcq", points:3,
      title:"QCM 20 ‚Äî Antisepsie, d√©sinfection, st√©rilisation",
      prompt:"Associe la bonne d√©finition au bon terme :",
      multi:false,
      options:[
        {id:"a", text:"Antisepsie = sur tissus vivants ; D√©sinfection = sur surfaces/objets ; St√©rilisation = destruction de toutes formes microbiennes", correct:true},
        {id:"b", text:"Antisepsie = sur surfaces ; D√©sinfection = sur peau ; St√©rilisation = seulement contre les bact√©ries", correct:false},
        {id:"c", text:"D√©sinfection = d√©truit forc√©ment les spores ; St√©rilisation = r√©duit partiellement les microbes", correct:false},
        {id:"d", text:"Antisepsie = uniquement pour les virus ; D√©sinfection = uniquement pour les champignons", correct:false}
      ],
      explain:"Antisepsie sur tissus vivants, d√©sinfection sur inertes, st√©rilisation = objectif ‚Äúz√©ro micro-organisme‚Äù (y compris spores)."
    }
    ,
    {
      id:"QCM_CIRCUIT_LINGE", type:"mcq", points:3,
      title:"QCM 21 ‚Äî Circuit du linge : gestes cl√©s",
      prompt:"Concernant le circuit du linge (propre/sale), quelles affirmations sont correctes ?",
      multi:true,
      options:[
        {id:"a", text:"Je r√©alise une friction au PHA avant de toucher du linge propre", correct:true},
        {id:"b", text:"Je r√©alise une friction au PHA apr√®s avoir touch√© du linge sale", correct:true},
        {id:"c", text:"Je peux poser temporairement le sac de linge sale au sol si je le reprends tout de suite", correct:false},
        {id:"d", text:"Le linge propre et le linge sale peuvent emprunter le m√™me ascenseur seulement s‚Äôils sont dans des containers ferm√©s", correct:true}
      ],
      explain:"Objectif : √©viter les transmissions crois√©es. Ne jamais d√©poser le linge/sac au sol. Les circuits propre/sale ne doivent pas se croiser ; si un m√™me itin√©raire est utilis√©, il faut des contenants ferm√©s et une organisation d√©di√©e."
    },
    {
      id:"QCM_LINGE_STOCKAGE", type:"mcq", points:2,
      title:"QCM 22 ‚Äî Circuit du linge : stockage",
      prompt:"Le stockage du linge sale dans un local de service d√©di√© :",
      multi:false,
      options:[
        {id:"a", text:"Peut √™tre sup√©rieur √† 72 h si les sacs sont correctement ferm√©s", correct:false},
        {id:"b", text:"Doit rester limit√© (rep√®re : ‚â§ 72 h) selon l‚Äôorganisation du service", correct:true},
        {id:"c", text:"Doit se faire dans la chambre du patient pour gagner du temps", correct:false},
        {id:"d", text:"Est indiff√©rent tant qu‚Äôil n‚Äôy a pas d‚Äôodeur", correct:false}
      ],
      explain:"Rep√®re enseign√© : le linge sale doit √™tre √©vacu√© r√©guli√®rement et le stockage en service ne doit pas d√©passer 72 h dans le local pr√©vu √† cet effet."
    },
    {
      id:"QCM_VESTIAIRE_TENUES", type:"mcq", points:3,
      title:"QCM 23 ‚Äî Gestion du vestiaire et des tenues",
      prompt:"Quelles r√®gles rel√®vent de la gestion du vestiaire/tenue professionnelle ?",
      multi:true,
      options:[
        {id:"a", text:"√âviter tout contact entre tenue civile et tenue professionnelle", correct:true},
        {id:"b", text:"Tenue propre : transport dans armoires ou chariots ferm√©s/prot√©g√©s", correct:true},
        {id:"c", text:"Tenue sale : d√©pose dans des sacs correctement ferm√©s et stock√©s dans un local sp√©cifique", correct:true},
        {id:"d", text:"Le vestiaire n√©cessite un entretien quotidien + nettoyage r√©gulier de l‚Äôint√©rieur des placards", correct:true},
        {id:"e", text:"Stocker des tenues sales dans son vestiaire personnel est recommand√© pour √©viter de contaminer le service", correct:false}
      ],
      explain:"La tenue est un vecteur possible de transmission : s√©paration civil/pro, circuits d√©di√©s (propre/sale), sacs ferm√©s, et entretien du vestiaire."
    },
    {
      id:"QCM_TENUE_INTERDITS", type:"mcq", points:3,
      title:"QCM 24 ‚Äî Tenue professionnelle : ce qui est proscrit",
      prompt:"Parmi les propositions suivantes, lesquelles sont proscrites (tenue pro) ?",
      multi:true,
      options:[
        {id:"a", text:"Port d‚Äôun tissu polaire sous la tenue", correct:true},
        {id:"b", text:"Sous-pull / col roul√© sous la tenue", correct:true},
        {id:"c", text:"Foulard", correct:true},
        {id:"d", text:"Mettre du mat√©riel dans les poches (sparadrap, pince, ciseaux‚Ä¶)", correct:true},
        {id:"e", text:"Avant-bras d√©gag√©s (manches courtes)", correct:false}
      ],
      explain:"Rep√®res : manches courtes, pas de polaire, pas de sous-pull/col roul√©, pas de foulard, rien dans les poches (mat√©riel = r√©servoir + risque d‚ÄôAES/contamination)."
    },
    {
      id:"QCM_PROTECTION_VISAGE", type:"mcq", points:2,
      title:"QCM 25 ‚Äî Protection du visage",
      prompt:"Lors d‚Äôun geste avec risque de projection/a√©rosolisation de liquide biologique (ex. aspiration de mucosit√©s, vidange d‚Äôun collecteur d‚Äôurines), on porte :",
      multi:false,
      options:[
        {id:"a", text:"Uniquement des gants", correct:false},
        {id:"b", text:"Masque √† usage m√©dical + lunettes/visi√®re", correct:true},
        {id:"c", text:"Une charlotte seule", correct:false},
        {id:"d", text:"Deux masques chirurgicaux superpos√©s", correct:false}
      ],
      explain:"Risque de projection/a√©rosolisation ‚Üí protection du visage : masque + protection oculaire (lunettes/visi√®re), en plus des gants/tenue selon le risque."
    },
    {
      id:"QCM_FLORE", type:"mcq", points:3,
      title:"QCM 26 ‚Äî Flore cutan√©e : transitoire vs r√©sidente",
      prompt:"Quelle proposition est la plus correcte ?",
      multi:false,
      options:[
        {id:"a", text:"La flore transitoire est stable et profonde ; la flore r√©sidente est superficielle et variable", correct:false},
        {id:"b", text:"La flore transitoire provient surtout des souillures (visible/invisible) et varie ; la flore r√©sidente est plus stable et plus profonde", correct:true},
        {id:"c", text:"La flore r√©sidente est uniquement pathog√®ne", correct:false},
        {id:"d", text:"La flore transitoire ne se transmet jamais par les mains", correct:false}
      ],
      explain:"But de l‚ÄôHDM : √©liminer la flore transitoire (la plus impliqu√©e dans les transmissions crois√©es manuport√©es)."
    },
    {
      id:"QCM_RESERVOIRS", type:"mcq", points:2,
      title:"QCM 27 ‚Äî R√©servoirs de micro-organismes en milieu de soins",
      prompt:"Parmi les √©l√©ments suivants, lesquels peuvent √™tre des r√©servoirs de micro-organismes √† l‚Äôh√¥pital ?",
      multi:true,
      options:[
        {id:"a", text:"Le patient", correct:true},
        {id:"b", text:"Le personnel", correct:true},
        {id:"c", text:"Les locaux / surfaces", correct:true},
        {id:"d", text:"Les visiteurs", correct:true},
        {id:"e", text:"Le mat√©riel", correct:true},
        {id:"f", text:"Uniquement l‚Äôair", correct:false}
      ],
      explain:"En pratique : patient + soignants + environnement (locaux/surfaces) + visiteurs + mat√©riel."
    },
    {
      id:"QCM_EXCRETA", type:"mcq", points:3,
      title:"QCM 28 ‚Äî Gestion des excreta",
      prompt:"Concernant la gestion des excreta, quelles propositions sont correctes ?",
      multi:true,
      options:[
        {id:"a", text:"Transporter un bassin/urinal avec un couvercle (ou syst√®me type Carebag¬Æ) limite la contamination", correct:true},
        {id:"b", text:"Une douchette sur les WC est une alternative √©quivalente au lave-bassin", correct:false},
        {id:"c", text:"Porter un tablier UU d√®s que soin mouillant ou gestion des excreta", correct:true},
        {id:"d", text:"Hygi√®ne des mains apr√®s gestion des excreta est indispensable", correct:true}
      ],
      explain:"Gestion excreta = limiter les projections/a√©rosols : couvercle/carebag, √©quipements adapt√©s (lave-bassin), tablier si soin mouillant/souillant, et HDM syst√©matique."
    },
    {
      id:"QCM_AEV_NON_AEV", type:"mcq", points:3,
      title:"QCM 29 ‚Äî AEV ou non ?",
      prompt:"Vous vous piquez avec un trocart lors de la pr√©paration d‚Äôune injection (aucun contact avec un liquide biologique). Quelle est la meilleure r√©ponse ?",
      multi:false,
      options:[
        {id:"a", text:"C‚Äôest un AEV : d√©claration urgente et s√©rologies syst√©matiques", correct:false},
        {id:"b", text:"Ce n‚Äôest pas un AEV (pas de liquide biologique) : nettoyage eau+savon + pansement sec, puis proc√©dure AT selon r√®glement", correct:true},
        {id:"c", text:"On prescrit une antibioprophylaxie d‚Äôembl√©e", correct:false},
        {id:"d", text:"Aucune mesure n‚Äôest n√©cessaire", correct:false}
      ],
      explain:"D√©finition enseign√©e : AEV = contact avec sang ou autre liquide biologique potentiellement contaminant + effraction/ muqueuse/ peau l√©s√©e. Ici, effraction sans liquide biologique ‚Üí pas AEV (mais AT + soins locaux)."
    },
    {
      id:"QCM_AES_DELAIS_ADMIN", type:"mcq", points:3,
      title:"QCM 30 ‚Äî D√©lais : prise en charge et d√©claration",
      prompt:"√Ä propos des d√©lais apr√®s AES/AEV, quelles propositions sont correctes ?",
      multi:true,
      options:[
        {id:"a", text:"La prise en charge doit √™tre d√©marr√©e dans la limite des 4 heures", correct:true},
        {id:"b", text:"La d√©claration d‚Äôaccident du travail doit √™tre effectu√©e dans les 48 heures (hors week-end) selon la proc√©dure", correct:true},
        {id:"c", text:"Il est acceptable d‚Äôattendre la fin du stage si on pense que le risque est faible", correct:false},
        {id:"d", text:"L‚Äôabsence d‚Äôidentification du patient source dispense de la d√©claration", correct:false}
      ],
      explain:"Rep√®res de proc√©dure : initier la prise en charge (signalement + urgences) dans la limite des 4 h ; d√©claration AT dans les 48 h (hors week-end) selon la fili√®re de l‚Äôinstitut/√©tablissement d‚Äôattache."
    }
  ];
}


function makeVfQuestions(){
  return [
    {
      id:"VF_PS_HDM", type:"tf_block", points:6,
      title:"Vrai / Faux ‚Äî Pr√©cautions standard & hygi√®ne des mains",
      prompt:"Indique si chaque affirmation est vraie ou fausse.",
      labels:["Faux","Vrai"],
      items:[
        {id:"ps1", text:"Les pr√©cautions standard s‚Äôappliquent √† tous les patients, quel que soit leur statut infectieux.", correctIndex:1},
        {id:"ps2", text:"Le port de gants dispense de l‚Äôhygi√®ne des mains apr√®s le retrait des gants.", correctIndex:0},
        {id:"ps3", text:"La friction hydroalcoolique est indiqu√©e sur des mains visiblement propres et s√®ches.", correctIndex:1},
        {id:"ps4", text:"Sur des mains mouill√©es, la friction hydroalcoolique reste la technique recommand√©e.", correctIndex:0},
        {id:"ps5", text:"Un lavage au savon est requis quand les mains sont visiblement souill√©es.", correctIndex:1},
        {id:"ps6", text:"L‚Äôhygi√®ne des mains n‚Äôest n√©cessaire qu‚Äôapr√®s un contact avec un liquide biologique.", correctIndex:0},
        {id:"ps7", text:"La d√©sinfection n‚Äôa pas forc√©ment d‚Äôaction sur les spores, contrairement √† la st√©rilisation.", correctIndex:1},
        {id:"ps8", text:"L‚Äôantisepsie concerne les surfaces inertes, la d√©sinfection concerne la peau.", correctIndex:0}
      ]
    },
    {
      id:"VF_EPI_RESP", type:"tf_block", points:6,
      title:"Vrai / Faux ‚Äî EPI, tenue et hygi√®ne respiratoire",
      prompt:"Indique si chaque affirmation est vraie ou fausse.",
      labels:["Faux","Vrai"],
      items:[
        {id:"epi1", text:"En cas de risque de projection, une protection oculaire (lunettes/visi√®re) est une mesure de protection individuelle pertinente.", correctIndex:1},
        {id:"epi2", text:"Un masque chirurgical peut √™tre conserv√© tant qu‚Äôil n‚Äôest pas d√©chir√©, m√™me s‚Äôil est humide.", correctIndex:0},
        {id:"epi3", text:"Frictionner une paire de gants au SHA est une alternative acceptable √† leur changement.", correctIndex:0},
        {id:"epi4", text:"La tenue professionnelle implique des avant-bras d√©gag√©s et l‚Äôabsence de bijoux aux mains/poignets.", correctIndex:1},
        {id:"epi5", text:"L‚Äôhygi√®ne respiratoire inclut l‚Äôhygi√®ne des mains apr√®s contact avec des s√©cr√©tions respiratoires.", correctIndex:1},
        {id:"epi6", text:"La surblouse est un EPI dont l‚Äôindication d√©pend du risque de contact/projection sur la tenue.", correctIndex:1},
        {id:"epi7", text:"Des chaussures ouvertes am√©liorent la s√©curit√© en limitant la chaleur et la transpiration.", correctIndex:0},
        {id:"epi8", text:"Le port d‚Äôun masque chirurgical est une mesure d‚Äôhygi√®ne respiratoire qui peut prot√©ger l‚Äôentourage contre les gouttelettes.", correctIndex:1}
      ]
    },
    {
      id:"VF_AES_DECHETS", type:"tf_block", points:8,
      title:"Vrai / Faux ‚Äî AES/AEV et tri DAS/DASRI",
      prompt:"Indique si chaque affirmation est vraie ou fausse.",
      labels:["Faux","Vrai"],
      items:[
        {id:"aes1", text:"Une projection de sang sur une peau intacte non l√©s√©e correspond √† un AES/AEV.", correctIndex:0},
        {id:"aes2", text:"Apr√®s une piq√ªre avec un dispositif souill√©, presser fortement la plaie pour la faire saigner est recommand√©.", correctIndex:0},
        {id:"aes3", text:"Apr√®s une projection oculaire, le rin√ßage imm√©diat abondant est prioritaire.", correctIndex:1},
        {id:"aes4", text:"La prise en charge d‚Äôun AES/AEV doit √™tre r√©alis√©e le plus t√¥t possible, id√©alement dans les premi√®res heures.", correctIndex:1},
        {id:"das1", text:"Un d√©chet piquant/coupant/tranchant doit √™tre √©limin√© en OPCT (fili√®re DASRI), m√™me sans trace de sang.", correctIndex:1},
        {id:"das2", text:"Un coton avec une simple trace de sang s√®che, sans risque d‚Äô√©coulement et hors contexte de site infectieux, est obligatoirement DASRI.", correctIndex:0},
        {id:"das3", text:"Un pansement fortement impr√©gn√© de sang avec risque d‚Äô√©coulement rel√®ve de la fili√®re DASRI.", correctIndex:1},
        {id:"das4", text:"Un √©couvillon utilis√© pour un pr√©l√®vement sur un site infectieux suspect√©/av√©r√© rel√®ve de la fili√®re DASRI.", correctIndex:1},
        {id:"das5", text:"Un emballage non souill√© (ex. blister vide) rel√®ve de la fili√®re DAS.", correctIndex:1},
        {id:"das6", text:"Une seringue sans aiguille, contenant du sang liquide ou avec risque d‚Äô√©coulement, rel√®ve de la fili√®re DAS.", correctIndex:0}
      ]
    }
    ,
    {
      id:"VF_LINGE", type:"tf_block", points:10,
      title:"Vrai / Faux ‚Äî Circuit du linge",
      prompt:"Indique si chaque affirmation est vraie ou fausse.",
      labels:["Faux","Vrai"],
      items:[
        {id:"l1", text:"Je fais une friction au PHA avant de toucher du linge propre.", correctIndex:1, explain:"Le linge propre doit rester propre : HDM avant manipulation."},
        {id:"l2", text:"Je fais une friction au PHA apr√®s avoir touch√© du linge sale.", correctIndex:1, explain:"Apr√®s contact avec du linge sale = risque de contamination des mains, donc HDM."},
        {id:"l3", text:"Je peux poser le linge sale par terre dans la chambre avant de l‚Äô√©vacuer.", correctIndex:0, explain:"Jamais au sol (contamination de l‚Äôenvironnement + recontamination du linge/sac)."},
        {id:"l4", text:"Je peux poser le sac de linge sale par terre avant de l‚Äô√©vacuer.", correctIndex:0, explain:"M√™me r√®gle : le sac ne doit pas √™tre pos√© au sol."},
        {id:"l5", text:"Le linge propre et le linge sale peuvent circuler par le m√™me ascenseur uniquement s‚Äôils sont dans des containers ferm√©s.", correctIndex:1, explain:"Possible si organisation + contenants ferm√©s (sinon risque de croisement propre/sale)."},
        {id:"l6", text:"Le circuit du linge propre et le circuit du linge sale ne doivent jamais se croiser.", correctIndex:1, explain:"Principe de base des circuits : √©viter les croisements."},
        {id:"l7", text:"Le stockage du linge sale dans le local de service pr√©vu √† cet effet peut √™tre sup√©rieur √† 72 h.", correctIndex:0, explain:"Rep√®re enseign√© : √©viter >72 h en stockage de service (√©vacuation r√©guli√®re)."},
        {id:"l8", text:"Je peux manipuler du linge sale ¬´ √† bras le corps ¬ª si je porte des gants.", correctIndex:0, explain:"M√™me avec gants, rien contre soi : risque de contaminer la tenue et de diss√©miner."}
      ],
      explain:"Points cl√©s : HDM avant linge propre / apr√®s linge sale, jamais au sol, circuits d√©di√©s, contenants ferm√©s, √©vacuation r√©guli√®re."
    },
    {
      id:"VF_TENUE_VESTIAIRE", type:"tf_block", points:10,
      title:"Vrai / Faux ‚Äî Tenue professionnelle & EPI (rappels)",
      prompt:"Indique si chaque affirmation est vraie ou fausse.",
      labels:["Faux","Vrai"],
      items:[
        {id:"t1", text:"Je peux porter mon alliance pour r√©aliser un bio-nettoyage.", correctIndex:0, explain:"Z√©ro bijou mains/poignets : g√™ne l‚ÄôHDM et favorise la persistance microbienne."},
        {id:"t2", text:"Je peux stocker des tenues sales dans mon vestiaire.", correctIndex:0, explain:"Tenue sale : sacs ferm√©s + local sp√©cifique ; √©viter contamination civil/pro."},
        {id:"t3", text:"Une veste ¬´ passe-couloir ¬ª √† manches longues par-dessus la tenue est compatible avec les r√®gles de tenue.", correctIndex:0, explain:"Manches longues / veste passe-couloir proscrites : avant-bras d√©gag√©s."},
        {id:"t4", text:"Le tissu polaire est proscrit en secteur de soins.", correctIndex:1, explain:"Rep√®re de tenue : polaire proscrite."},
        {id:"t5", text:"Je peux garder un sous-pull (col roul√©) sous la tenue professionnelle.", correctIndex:0, explain:"Sous-pull/col roul√© proscrits : avant-bras d√©gag√©s et tenue adapt√©e."},
        {id:"t6", text:"Le tablier/surblouse √† UU est limit√© au lieu m√™me des soins et doit √™tre chang√© entre 2 patients ou 2 activit√©s.", correctIndex:1, explain:"Protection de tenue : usage cibl√©, non ¬´ passe-partout ¬ª, changement selon patient/activit√©."},
        {id:"t7", text:"Il est acceptable de conserver ses chaussures de ville en service si elles sont propres.", correctIndex:0, explain:"Chaussures d√©di√©es : ferm√©es, lavables, sans talon, r√©serv√©es au lieu de travail."},
        {id:"t8", text:"En cas de risque de projection/a√©rosolisation, le port d‚Äôun masque √† usage m√©dical et de lunettes est indiqu√©.", correctIndex:1, explain:"Protection du visage = masque + protection oculaire lors de risque de projection/a√©rosolisation."}
      ],
      explain:"Rappels : avant-bras d√©gag√©s, 0 bijou, rien dans les poches, chaussures pro, et EPI adapt√©s au risque."
    }
  ];
}

function makeCasAesQuestions(){
  return [
    // ========== SITUATION 1 : Piq√ªre VIH, aiguille creuse ==========
    {
      id:"AES_SITUATION_1", type:"mcq", points:4,
      title:"Situation clinique 1 ‚Äî Piq√ªre profonde, patient VIH+",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en stage aux urgences.</b> Lors d'un pr√©l√®vement sanguin sur un patient agit√© connu <b>s√©ropositif au VIH</b>, vous vous piquez profond√©ment avec l'aiguille creuse 21G <b>apr√®s le pr√©l√®vement</b>. L'aiguille contenait du sang visible. Vous portez des gants qui n'ont pas emp√™ch√© la piq√ªre.
        </div>
      </div>
      Quelle est la conduite √† tenir IMM√âDIATE ?`,
      multi:true,
      options:[
        {id:"a", text:"Retirer imm√©diatement les gants", correct:true},
        {id:"b", text:"Laver la plaie √† l'eau et au savon pendant au moins 5 minutes", correct:true},
        {id:"c", text:"Faire saigner activement en pressant fort", correct:false},
        {id:"d", text:"Appliquer un antiseptique (B√©tadine dermique, Dakin) apr√®s le lavage", correct:true},
        {id:"e", text:"D√©clarer l'AES et contacter le m√©decin r√©gulateur en URGENCE", correct:true},
        {id:"f", text:"Attendre la fin du service pour ne pas d√©ranger", correct:false}
      ],
      explain:"Ne JAMAIS faire saigner activement (ne pas presser/faire couler). L‚Äôobjectif est de r√©duire la charge biologique puis de d√©marrer la prise en charge sans d√©lai : soins locaux + signalement et √©valuation m√©dicale (proc√©dure : prise en charge √† initier dans la limite des 4 heures)."
    },
    
    // ========== SITUATION 2 : Projection sang VHB, muqueuse ==========
    {
      id:"AES_SITUATION_2", type:"stage_sort", points:4,
      title:"Situation clinique 2 ‚Äî Projection de sang sur muqueuse oculaire",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en salle d'intervention.</b> Lors d'un geste de radiologie interventionnelle, vous recevez une <b>projection de sang dans l'≈ìil</b> (sans lunettes de protection). Le patient est porteur du <b>virus de l'h√©patite B (VHB)</b> avec AgHBs positif.
        </div>
      </div>
      Remettez les √©tapes dans le BON ORDRE (utilisez ‚Üë ‚Üì) :`,
      steps:[
        {id:"s1", text:"Stopper le geste et s'√©loigner de la zone de soins"},
        {id:"s2", text:"Rincer abondamment l'≈ìil au s√©rum physiologique ou √† l'eau pendant au moins 5 minutes (ouvrir bien la paupi√®re)"},
        {id:"s3", text:"Retirer les EPI souill√©s et r√©aliser une hygi√®ne des mains"},
        {id:"s4", text:"D√©clarer imm√©diatement l'AES au m√©decin r√©gulateur"},
        {id:"s5", text:"V√©rifier le statut vaccinal anti-VHB et le taux d'anticorps anti-HBs"}
      ],
      answer:["s1","s2","s3","s4","s5"],
      explain:"Le rin√ßage imm√©diat et prolong√© est PRIORITAIRE pour √©liminer au maximum le sang contaminant. La v√©rification du statut vaccinal VHB d√©terminera si une injection d'immunoglobulines anti-HBs est n√©cessaire."
    },
    
    // ========== SITUATION 3 : Coupure tuberculose, inhalation ==========
    {
      id:"AES_SITUATION_3", type:"mcq", points:3,
      title:"Situation clinique 3 ‚Äî Soins √† un patient tuberculeux",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en service de pneumologie.</b> Vous r√©alisez une radiographie thoracique portable au lit d'un patient atteint de <b>tuberculose pulmonaire active</b> (BK+). Vous portez un masque chirurgical au lieu d'un FFP2. Le patient tousse violemment sans masque pendant l'examen.
        </div>
      </div>
      Quelle est l'analyse CORRECTE de cette situation ?`,
      multi:true,
      options:[
        {id:"a", text:"Il s'agit d'un AES par voie a√©rienne (inhalation de bacilles de Koch)", correct:true},
        {id:"b", text:"Le masque chirurgical ne prot√®ge pas contre les a√©rosols infectieux", correct:true},
        {id:"c", text:"Un masque FFP2 aurait d√ª √™tre port√© obligatoirement", correct:true},
        {id:"d", text:"Il faut d√©clarer l'exposition et b√©n√©ficier d'un suivi m√©dical (IDR, radiographie)", correct:true},
        {id:"e", text:"Pas de risque car vous n'avez pas eu de contact direct avec le patient", correct:false}
      ],
      explain:"La tuberculose se transmet par voie a√©rienne (gouttelettes < 5 ¬µm). Le port du FFP2 est OBLIGATOIRE pour tout soin aupr√®s d'un patient BK+. Un suivi incluant IDR (ou IGRA) et surveillance clinico-radiologique sera mis en place."
    },
    
    // ========== SITUATION 4 : Contact selles COVID, peau l√©s√©e ==========
    {
      id:"AES_SITUATION_4", type:"mcq", points:3,
      title:"Situation clinique 4 ‚Äî Contact avec selles d'un patient COVID+",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en service de g√©riatrie.</b> Lors d'un change de protection, vous recevez des <b>selles liquides</b> sur votre avant-bras o√π vous avez une <b>plaie r√©cente d'ecz√©ma suintante</b>. Le patient est positif au <b>SARS-CoV-2 (COVID-19)</b>. Vous ne portez pas de surblouse imperm√©able.
        </div>
      </div>
      Quelle est la conduite √† tenir ?`,
      multi:true,
      options:[
        {id:"a", text:"Nettoyer imm√©diatement la zone souill√©e √† l'eau et au savon", correct:true},
        {id:"b", text:"Appliquer un antiseptique apr√®s le lavage", correct:true},
        {id:"c", text:"D√©clarer l'AES car contact de liquide biologique sur peau l√©s√©e", correct:true},
        {id:"d", text:"Surveillance des sympt√¥mes COVID pendant 10 jours", correct:true},
        {id:"e", text:"Aucune mesure n√©cessaire car les selles ne transmettent pas le COVID", correct:false}
      ],
      explain:"Le SARS-CoV-2 peut √™tre pr√©sent dans les selles. Une peau l√©s√©e constitue une porte d'entr√©e potentielle. M√™me si le risque est moindre que par voie respiratoire, la d√©claration et le suivi sont n√©cessaires."
    },
    
    // ========== SITUATION 5 : Piq√ªre h√©patite C, aiguille pleine ==========
    {
      id:"AES_SITUATION_5", type:"mcq", points:4,
      title:"Situation clinique 5 ‚Äî Piq√ªre superficielle, patient VHC+",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en salle de radiologie interventionnelle.</b> En √©liminant le mat√©riel, vous vous piquez <b>superficiellement</b> avec une aiguille de suture (aiguille pleine, courbe) ayant servi sur un patient porteur du <b>virus de l'h√©patite C (VHC+)</b>. Pas de saignement visible.
        </div>
      </div>
      Quels √©l√©ments caract√©risent ce risque d'AES ?`,
      multi:true,
      options:[
        {id:"a", text:"Le risque VHC existe m√™me avec une piq√ªre superficielle", correct:true},
        {id:"b", text:"L'aiguille pleine pr√©sente un risque moindre qu'une aiguille creuse", correct:true},
        {id:"c", text:"Il existe un traitement prophylactique post-exposition pour le VHC", correct:false},
        {id:"d", text:"Un suivi s√©rologique VHC sera n√©cessaire (ARN VHC √† J0, M1, M3)", correct:true},
        {id:"e", text:"L'absence de saignement √©limine tout risque", correct:false}
      ],
      explain:"Le risque VHC (environ 3% par piq√ªre) existe m√™me sans saignement visible. AUCUNE prophylaxie post-exposition n'existe pour le VHC, d'o√π l'importance du suivi s√©rologique pour d√©tecter une √©ventuelle s√©roconversion et traiter pr√©cocement si besoin."
    },
    
    // ========== SITUATION 6 : Morsure humaine, risque bact√©rien ==========
    {
      id:"AES_SITUATION_6", type:"mcq", points:3,
      title:"Situation clinique 6 ‚Äî Morsure par un patient agit√©",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM aux urgences.</b> Lors de la contention d'un patient tr√®s agit√© en √©tat d'√©bri√©t√©, ce dernier vous <b>mord profond√©ment la main</b> (plaie avec saignement). Le patient a une <b>hygi√®ne bucco-dentaire d√©plorable</b> avec gingivite et parodontite visibles. Statut infectieux inconnu.
        </div>
      </div>
      Quels sont les risques principaux et la conduite √† tenir ?`,
      multi:true,
      options:[
        {id:"a", text:"Risque majeur d'infection bact√©rienne polymicrobienne (Staphylocoque, Streptocoque, ana√©robies)", correct:true},
        {id:"b", text:"Nettoyage imm√©diat et d√©sinfection de la plaie", correct:true},
        {id:"c", text:"Consultation m√©dicale urgente pour √©valuer l'indication d'antibioprophylaxie", correct:true},
        {id:"d", text:"V√©rification du statut antit√©tanique", correct:true},
        {id:"e", text:"Risque viral n√©gligeable (VIH, VHB, VHC)", correct:false}
      ],
      explain:"Les morsures humaines sont TR√àS contamin√©es (flore buccale pathog√®ne). M√™me si le risque viral est faible par morsure, il n'est pas nul (salive peut contenir VIH en cas de saignement gingival). L'antibioth√©rapie pr√©ventive est souvent indiqu√©e (Augmentin¬Æ)."
    },
    
    // ========== SITUATION 7 : Contact urine, grippe, peau intacte ==========
    {
      id:"AES_SITUATION_7", type:"mcq", points:2,
      title:"Situation clinique 7 ‚Äî Projection d'urine sur peau intacte",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en service de m√©decine.</b> Lors d'un changement de poche √† urine, vous recevez des <b>√©claboussures d'urine</b> sur vos avant-bras (peau intacte, sans plaie). Le patient est hospitalis√© pour une <b>grippe saisonni√®re</b> (Influenza confirm√©).
        </div>
      </div>
      Cette situation constitue-t-elle un AES n√©cessitant une d√©claration ?`,
      multi:false,
      options:[
        {id:"a", text:"OUI, car tout contact avec un liquide biologique = AES", correct:false},
        {id:"b", text:"NON, car peau intacte + urine (risque infectieux faible) + pas de virus urinaire", correct:true},
        {id:"c", text:"OUI, √† cause du risque grippal", correct:false},
        {id:"d", text:"OUI, syst√©matiquement pour toute projection", correct:false}
      ],
      explain:"AES = exposition par piq√ªre/coupure, projection sur MUQUEUSE, ou contact avec PEAU L√âS√âE. Ici : peau intacte + urine (g√©n√©ralement st√©rile sauf infection urinaire) = PAS d'AES. N√©anmoins, lavage imm√©diat des mains requis (pr√©cautions standard)."
    },
    
    // ========== SITUATION 8 : Vomissures norovirus, projection visage ==========
    {
      id:"AES_SITUATION_8", type:"mcq", points:3,
      title:"Situation clinique 8 ‚Äî Projection de vomissures sur le visage",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en EHPAD.</b> Un r√©sident pr√©sente une <b>gastro-ent√©rite aigu√´ √† Norovirus</b> (√©pid√©mie dans l'√©tablissement). Lors de l'aide au repas, il vomit brutalement et vous recevez des <b>projections sur le visage (bouche entrouverte)</b>. Vous ne portez pas de masque.
        </div>
      </div>
      Quelle est la conduite √† tenir IMM√âDIATE ?`,
      multi:true,
      options:[
        {id:"a", text:"Cracher imm√©diatement et rincer abondamment la bouche", correct:true},
        {id:"b", text:"Laver le visage √† l'eau et au savon", correct:true},
        {id:"c", text:"Se consid√©rer comme potentiellement expos√© au Norovirus", correct:true},
        {id:"d", text:"D√©clarer l'AES (exposition muqueuse √† un liquide biologique)", correct:true},
        {id:"e", text:"Surveillance des sympt√¥mes digestifs dans les 48h (incubation courte)", correct:true},
        {id:"f", text:"Aucune mesure sp√©cifique, c'est juste une gastro", correct:false}
      ],
      explain:"Le Norovirus est EXTR√äMEMENT contagieux (quelques particules virales suffisent). L'exposition par muqueuse buccale = AES. Risque √©lev√© de d√©velopper une GEA dans les 12-48h. √âviction professionnelle si sympt√¥mes (risque de contamination d'autres r√©sidents)."
    },
    
    // ========== SITUATION 9 : Piq√ªre r√©cup√©r√©e, statut inconnu ==========
    {
      id:"AES_SITUATION_9", type:"mcq", points:3,
      title:"Situation clinique 9 ‚Äî Piq√ªre avec aiguille tra√Ænante",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en service de m√©decine.</b> En rangeant du mat√©riel, vous vous piquez avec une <b>aiguille qui tra√Ænait dans un plateau</b> (provenance inconnue, potentiellement utilis√©e depuis plusieurs heures). Impossible d'identifier le patient source.
        </div>
      </div>
      Quelle est la conduite √† tenir dans ce contexte d'incertitude ?`,
      multi:true,
      options:[
        {id:"a", text:"Soins locaux imm√©diats (lavage, antisepsie)", correct:true},
        {id:"b", text:"D√©claration AES urgente m√™me sans identification du patient source", correct:true},
        {id:"c", text:"S√©rologies de r√©f√©rence de la victime (VIH, VHB, VHC)", correct:true},
        {id:"d", text:"√âvaluation au cas par cas d'une √©ventuelle PPE VIH (selon pr√©valence locale)", correct:true},
        {id:"e", text:"Pas de d√©claration n√©cessaire sans patient source identifi√©", correct:false}
      ],
      explain:"Patient source inconnu = prise en charge AU MAXIMUM du risque (consid√©rer le pire sc√©nario). S√©rologies syst√©matiques de la victime. Discussion coll√©giale pour PPE VIH selon contexte √©pid√©miologique local. Rappel vaccinal VHB si besoin."
    },
    
    // ========== SITUATION 10 : Sang s√©ch√©, plaie main ==========
    {
      id:"AES_SITUATION_10", type:"mcq", points:2,
      title:"Situation clinique 10 ‚Äî Contact avec sang s√©ch√©",
      prompt:`<div class="contextBox">
        <div class="contextTitle">Contexte de l'accident</div>
        <div class="contextText">
          <b>Vous √™tes EMEM en salle d'examen.</b> En nettoyant une table d'examen, vous d√©couvrez du <b>sang s√©ch√©</b> (plusieurs heures) et r√©alisez que vous avez une <b>petite coupure r√©cente</b> au doigt qui a √©t√© en contact avec cette zone. Patient source non identifiable.
        </div>
      </div>
      Quelle est l'analyse de ce risque ?`,
      multi:true,
      options:[
        {id:"a", text:"Le sang s√©ch√© pr√©sente un risque viral quasi nul (VIH) car le virus est fragile", correct:true},
        {id:"b", text:"Le VHB peut survivre dans le sang s√©ch√© jusqu'√† 7 jours (risque r√©siduel)", correct:true},
        {id:"c", text:"Nettoyage imm√©diat de la plaie n√©cessaire", correct:true},
        {id:"d", text:"D√©claration AES recommand√©e malgr√© le faible risque (tra√ßabilit√©)", correct:true},
        {id:"e", text:"Risque identique au contact avec du sang frais", correct:false}
      ],
      explain:"Le VIH est d√©truit rapidement par la dessiccation (quelques minutes √† heures). Le VHB est plus r√©sistant (jusqu'√† 7 jours). Le VHC a une r√©sistance interm√©diaire. M√™me si le risque est faible, la d√©claration permet une tra√ßabilit√© et un suivi adapt√©."
    },
    
    // ========== QUESTION SYNTH√àSE : Facteurs de risque ==========
    {
      id:"AES_FACTEURS_RISQUE", type:"mcq", points:4,
      title:"Question de synth√®se ‚Äî Facteurs augmentant le risque viral",
      prompt:"Parmi les facteurs suivants, lesquels AUGMENTENT le risque de transmission virale lors d'un AES ?",
      multi:true,
      options:[
        {id:"a", text:"Aiguille creuse (vs aiguille pleine)", correct:true},
        {id:"b", text:"Piq√ªre profonde (vs superficielle)", correct:true},
        {id:"c", text:"Sang visible sur le dispositif", correct:true},
        {id:"d", text:"Geste intravasculaire (vs sous-cutan√©)", correct:true},
        {id:"e", text:"Charge virale √©lev√©e chez le patient source", correct:true},
        {id:"f", text:"Port de gants par la victime (protection totale)", correct:false},
        {id:"g", text:"D√©lai court entre utilisation et piq√ªre", correct:true}
      ],
      explain:"TOUS ces facteurs influencent l'inoculum viral. Les gants r√©duisent le risque mais ne le suppriment pas totalement (70-80% de r√©duction du volume de sang inocul√©). Un d√©lai court = virus encore infectieux."
    },
    
    // ========== QUESTION ORDRE : Conduite AES compl√®te ==========
    {
      id:"AES_ORDRE_COMPLET", type:"stage_sort", points:5,
      title:"Question de synth√®se ‚Äî Conduite √† tenir compl√®te apr√®s AES",
      prompt:"Remettez dans l'ordre CHRONOLOGIQUE les √©tapes de prise en charge d'un AES (du plus urgent au plus diff√©r√©) :",
      steps:[
        {id:"o1", text:"Arr√™ter le geste et se mettre en s√©curit√©"},
        {id:"o2", text:"Soins imm√©diats : nettoyage eau/savon 5 min + antisepsie (ou rin√ßage si muqueuse)"},
        {id:"o3", text:"Retirer les EPI souill√©s et hygi√®ne des mains"},
        {id:"o4", text:"Pr√©venir l'encadrement et d√©clarer l'AES IMM√âDIATEMENT"},
        {id:"o5", text:"Contacter le m√©decin r√©gulateur / m√©decine du travail (√©valuation urgente)"},
        {id:"o6", text:"Recueillir les informations : type d'exposition, patient source, statut vaccinal"},
        {id:"o7", text:"R√©aliser les pr√©l√®vements (s√©rologies victime, √©ventuellement patient source)"},
        {id:"o8", text:"Initier si n√©cessaire une prophylaxie post-exposition (PPE) dans les 4h si possible"},
        {id:"o9", text:"R√©diger la d√©claration √©crite d'accident du travail dans les 48h"},
        {id:"o10", text:"Suivi m√©dical √† long terme (M1, M3, M6 selon les protocoles)"}
      ],
      answer:["o1","o2","o3","o4","o5","o6","o7","o8","o9","o10"],
      explain:"Chronologie cl√© : SOINS IMM√âDIATS d'abord (minutes) ‚Üí D√âCLARATION (< 1h) ‚Üí √âVALUATION M√âDICALE (< 4h pour PPE VIH) ‚Üí SUIVI (mois)."
    },
    
    // ========== QUESTION VF : Id√©es re√ßues AES ==========
    {
      id:"AES_IDEES_RECUES", type:"tf_block", points:6,
      title:"Question de synth√®se ‚Äî Id√©es re√ßues sur les AES",
      prompt:"Vrai ou Faux ? (attention aux pi√®ges courants)",
      labels:["Faux","Vrai"],
      items:[
        {id:"i1", text:"Il faut faire saigner abondamment la plaie pour 'laver' l'int√©rieur", correctIndex:0, explain:"FAUX : ne jamais faire saigner. Risque de faire p√©n√©trer plus profond√©ment l'agent infectieux."},
        {id:"i2", text:"Les gants prot√®gent totalement contre les AES par piq√ªre", correctIndex:0, explain:"FAUX : les gants r√©duisent le risque (~70-80%) mais ne l'√©liminent pas."},
        {id:"i3", text:"On peut d√©sinfecter ses gants √† la SHA et continuer le soin", correctIndex:0, explain:"FAUX : gants √† usage UNIQUE. Changer de gants = changer de patient ou de t√¢che."},
        {id:"i4", text:"Une piq√ªre avec une petite aiguille ne n√©cessite pas de d√©claration", correctIndex:0, explain:"FAUX : TOUTE piq√ªre avec mat√©riel souill√© = AES √† d√©clarer."},
        {id:"i5", text:"La prophylaxie VIH est efficace m√™me si d√©but√©e √† 48h", correctIndex:1, explain:"VRAI mais moins efficace. Id√©al < 4h, acceptable jusqu'√† 48h, possible jusqu'√† 72h selon les cas."},
        {id:"i6", text:"Le risque VHC est plus √©lev√© que le risque VIH par piq√ªre", correctIndex:1, explain:"VRAI : VHC ~3%, VIH ~0,3%, VHB ~30% (si patient AgHBs+ et victime non vaccin√©e)."},
        {id:"i7", text:"Une projection de sang sur peau intacte est toujours un AES", correctIndex:0, explain:"FAUX : peau intacte = g√©n√©ralement PAS AES (mais hygi√®ne imm√©diate requise)."},
        {id:"i8", text:"La tuberculose peut se transmettre par un AES non percutan√© (toux)", correctIndex:1, explain:"VRAI : transmission a√©rienne (d'o√π l'importance du FFP2 pour tout soin aupr√®s d'un patient BK+)."}
      ],
      explain:"Ces erreurs sont fr√©quentes. En cas de doute : TOUJOURS d√©clarer, ne jamais minimiser."
    }
  ];
}

function makeDechetsQuestions(){
  const items = [
    ["d1",  "Emballage papier d'un pansement st√©rile non utilis√©", 0,
      "Non souill√© ‚Üí DAS."],
    ["d2",  "Bo√Æte en carton d'un dispositif st√©rile (propre)", 0,
      "Emballage propre ‚Üí DAS."],
    ["d3",  "Gants non souill√©s (t√¢che h√¥teli√®re / pas de contact avec liquide biologique)", 0,
      "Pas de souillure biologique ‚Üí DAS (selon circuit local)."],

    ["d4",  "Cotons/tampons apr√®s d√©sinfection cutan√©e, sans sang", 0,
      "Sans sang/liquide biologique ‚Üí DAS."],
    ["d5",  "Flacon de produit d√©sinfectant vide (non souill√©)", 0,
      "Emballage non souill√© ‚Üí DAS."],

    ["d6",  "Pansement retir√© : peu souill√©, plaie NON infect√©e, trace s√®che sans risque d‚Äô√©coulement", 0,
      "Trace minime sans √©coulement et hors site infectieux ‚Üí plut√¥t DAS (si protocole local le permet)."],
    ["d7",  "Pansement retir√© : tr√®s impr√©gn√© de sang (risque d‚Äô√©coulement) OU provenant d‚Äôune plaie infect√©e/suspecte", 1,
      "Fortement impr√©gn√© avec risque d‚Äô√©coulement ou contact avec site infectieux ‚Üí DASRI."],

    ["d8",  "Cotons apr√®s pr√©l√®vement capillaire : trace s√®che minime, sans risque d‚Äô√©coulement (pas de suspicion infectieuse)", 0,
      "Trace minime sans √©coulement et hors site infectieux ‚Üí plut√¥t DAS (selon protocole local)."],
    ["d9",  "Cotons/compresse apr√®s pr√©l√®vement capillaire : sang en quantit√© (risque d‚Äô√©coulement)", 1,
      "Sang en quantit√© avec risque d‚Äô√©coulement ‚Üí DASRI."],

    ["d10", "Compresses imbib√©es de sang (risque d‚Äô√©coulement)", 1,
      "Fortement souill√© de sang avec risque d‚Äô√©coulement ‚Üí DASRI."],

    ["d11", "Aiguille utilis√©e", 1,
      "OPCT (piquant/coupant/tranchant) ‚Üí DASRI (collecteur)."],

    ["d12", "Seringue utilis√©e sans aiguille : trace s√®che minime, sans risque d‚Äô√©coulement (pas de suspicion infectieuse)", 0,
      "Trace minime sans √©coulement ‚Üí plut√¥t DAS (selon protocole local)."],
    ["d13", "Seringue utilis√©e sans aiguille : sang pr√©sent / risque d‚Äô√©coulement", 1,
      "Sang en quantit√© avec risque d‚Äô√©coulement ‚Üí DASRI."],

    ["d14", "Tubulure de perfusion souill√©e de sang (risque d‚Äô√©coulement)", 1,
      "Souill√© de sang avec risque d‚Äô√©coulement ‚Üí DASRI."],

    ["d15", "Masque chirurgical port√© sans souillure visible", 0,
      "Non souill√© ‚Üí DAS (selon circuit local)."],
    ["d16", "Masque avec projections de sang", 1,
      "Souill√© de sang ‚Üí DASRI."],

    ["d17", "√âcouvillon apr√®s pr√©l√®vement microbiologique sur site infectieux suspect√©/av√©r√© (ex : plaie suppur√©e)", 1,
      "Contact avec site infectieux suspect√©/av√©r√© ‚Üí DASRI (souvent attendu dans les protocoles)."],

    ["d18", "Essuie-mains papier apr√®s lavage des mains (hors soin)", 0,
      "DAS."],
    ["d19", "Urinal/vase jetable sans sang (urines)", 0,
      "En g√©n√©ral DAS si non souill√© par sang (selon protocole local)."],

    ["d20", "Protection absorbante (couche) : urines seules, sans sang", 0,
      "En g√©n√©ral DAS (DAOM) selon circuit local."],
    ["d21", "Protection absorbante avec sang (risque d‚Äô√©coulement)", 1,
      "Sang en quantit√© / risque d‚Äô√©coulement ‚Üí DASRI."]
  ];

  return [
    {
      id:"DECHETS_SA_DASRI", type:"tf_block", points:10,
      title:"Exercice ‚Äî Classer les d√©chets : DAS ou DASRI",
      prompt:"Pour chaque exemple, choisis la bonne fili√®re : <b>DAS</b> ou <b>DASRI</b> (r√©f√©rentiel de tri et protocole local).",
      labels:["DAS","DASRI"],
      items: items.map(([id,text,ci,ex])=>({id, text, correctIndex:ci, explain: ex})),
      explain:
        "Rep√®res (logique 2025) : <b>OPCT</b> (piquants/coupants/tranchants) ‚Üí <b>DASRI</b>. " +
        "Sinon : <b>DASRI</b> si le d√©chet est en contact avec un <b>site infectieux suspect√©/av√©r√©</b> " +
        "ou s‚Äôil est <b>fortement impr√©gn√©</b> de sang/liquide biologique avec <b>risque d‚Äô√©coulement</b>. " +
        "Si simple trace s√®che sans √©coulement et hors site infectieux : plut√¥t <b>DAS</b> (si le protocole local l‚Äôautorise)."
    }
  ];
}

/* ---------- BANK & state ---------- */
const BANK = {
  qcm: makeQcmQuestions(),
  vf: makeVfQuestions(),
  cas_aes: makeCasAesQuestions(),
  dechets: makeDechetsQuestions()
};

let currentTab = "qcm";
let state = {
  answers: {},
  feedback: {},
  shuffled: { qcm:false, vf:false, cas_aes:false, dechets:false },
  order: { qcm:[], vf:[], cas_aes:[], dechets:[] }
};

function keyForId(qid, tab){ return qid; }
function keyFor(q){ return keyForId(q.id); }

function save(){
  try{
    localStorage.setItem(STORAGE_KEY, JSON.stringify({currentTab, state}));
  }catch(e){}
}
function load(){
  try{
    const raw = localStorage.getItem(STORAGE_KEY);
    if(!raw) return;
    const obj = JSON.parse(raw);
    if(obj && obj.state){
      currentTab = obj.currentTab || currentTab;
      state = Object.assign(state, obj.state);
    }
  }catch(e){}
}
function exportToArea(){
  const area = document.getElementById("jsonArea");
  area.value = JSON.stringify({currentTab, state}, null, 2);
}
function importFromArea(){
  const area = document.getElementById("jsonArea");
  const obj = JSON.parse(area.value);
  if(obj && obj.state){
    currentTab = obj.currentTab || currentTab;
    state = Object.assign(state, obj.state);
  }
  save();
}

/* ---------- Shuffle / ordering ---------- */
function getQuestions(tab){
  const bank = BANK[tab] || [];
  const doShuffle = document.getElementById("shuffle").checked;
  if(!doShuffle){
    state.shuffled[tab] = false;
    state.order[tab] = [];
    return bank;
  }
  if(!state.shuffled[tab] || state.order[tab].length !== bank.length){
    const ids = bank.map(q=>q.id);
    for(let i=ids.length-1; i>0; i--){
      const j = Math.floor(Math.random()*(i+1));
      [ids[i], ids[j]] = [ids[j], ids[i]];
    }
    state.order[tab] = ids;
    state.shuffled[tab] = true;
    save();
  }
  const orderMap = new Map(state.order[tab].map((id,i)=>[id,i]));
  return [...bank].sort((a,b)=>(orderMap.get(a.id)||0)-(orderMap.get(b.id)||0));
}

/* ---------- Render helpers ---------- */
function renderPromptElement(q){
  const el = document.createElement("span");
  el.innerHTML = q.prompt;
  return el;
}

function renderQuestionUI(q){
  const hideHelp = document.getElementById("hideHelp").checked;
  const container = document.createElement("div");

  if(q.type === "mcq"){
    const opts = document.createElement("div");
    opts.className = "opts";
    for(const opt of q.options){
      const row = document.createElement("div");
      row.className = "opt";
      const input = document.createElement("input");
      input.type = q.multi ? "checkbox" : "radio";
      input.name = `mcq_${q.id}`;
      input.value = opt.id;
      const key = keyFor(q);
      const saved = state.answers[key];
      if(q.multi){
        const arr = Array.isArray(saved) ? saved : [];
        input.checked = arr.includes(opt.id);
        input.addEventListener("change", ()=>{
          let current = state.answers[key];
          if(!Array.isArray(current)) current = [];
          if(input.checked){
            if(!current.includes(opt.id)) current.push(opt.id);
          }else{
            current = current.filter(x=>x!==opt.id);
          }
          state.answers[key] = current;
          save();
        });
      }else{
        if(saved === opt.id) input.checked = true;
        input.addEventListener("change", ()=>{
          if(input.checked){
            state.answers[key] = opt.id;
            save();
          }
        });
      }
      const lbl = document.createElement("label");
      lbl.textContent = opt.text;
      row.appendChild(input);
      row.appendChild(lbl);
      opts.appendChild(row);
    }
    container.appendChild(opts);
  }

  if(q.type === "tf_block"){
    const labels = q.labels || ["Faux","Vrai"];
    const table = document.createElement("div");
    table.className = "tfTable";
    for(const it of q.items){
      const tfRow = document.createElement("div");
      tfRow.className = "tfRow";
      const txt = document.createElement("div");
      txt.className = "tfText";
      txt.textContent = it.text;
      tfRow.appendChild(txt);

      const btns = document.createElement("div");
      btns.className = "tfBtns";
      const key = keyFor(q);
      const ans = state.answers[key] || {};
      for(let idx=0; idx<labels.length; idx++){
        const btn = document.createElement("button");
        btn.className = "choiceBtn";
        btn.textContent = labels[idx];
        if(ans[it.id] === idx) btn.classList.add("active");
        btn.addEventListener("click", (e)=>{
          e.preventDefault();
          let current = state.answers[key] || {};
          current[it.id] = idx;
          state.answers[key] = current;
          save();
          renderQuestionUI_update(q);
        });
        btns.appendChild(btn);
      }
      tfRow.appendChild(btns);
      table.appendChild(tfRow);
    }
    container.appendChild(table);
  }

  if(q.type === "stage_sort"){
    const box = document.createElement("div");
    box.className = "stageBox";
    const key = keyFor(q);
    const selected = Array.isArray(state.answers[key]) ? state.answers[key] : [];
    const pool = q.steps.filter(s=>!selected.includes(s.id));

    function redraw(){
      box.innerHTML = "";
      const sel = state.answers[key] || [];
      for(let i=0; i<sel.length; i++){
        const st = q.steps.find(s=>s.id===sel[i]);
        if(!st) continue;
        const stepDiv = document.createElement("div");
        stepDiv.className = "step";
        const txt = document.createElement("div");
        txt.className = "stepText";
        txt.textContent = `${i+1}. ${st.text}`;
        stepDiv.appendChild(txt);

        const btnsDiv = document.createElement("div");
        btnsDiv.className = "stepBtns";
        if(i>0){
          const up = document.createElement("button");
          up.className = "miniBtn";
          up.textContent = "‚Üë";
          up.addEventListener("click", (e)=>{
            e.preventDefault();
            const c = state.answers[key] || [];
            [c[i], c[i-1]] = [c[i-1], c[i]];
            state.answers[key] = c;
            save();
            redraw();
          });
          btnsDiv.appendChild(up);
        }
        if(i<sel.length-1){
          const down = document.createElement("button");
          down.className = "miniBtn";
          down.textContent = "‚Üì";
          down.addEventListener("click", (e)=>{
            e.preventDefault();
            const c = state.answers[key] || [];
            [c[i], c[i+1]] = [c[i+1], c[i]];
            state.answers[key] = c;
            save();
            redraw();
          });
          btnsDiv.appendChild(down);
        }
        const remove = document.createElement("button");
        remove.className = "miniBtn";
        remove.textContent = "‚úó";
        remove.addEventListener("click", (e)=>{
          e.preventDefault();
          const c = state.answers[key] || [];
          c.splice(i, 1);
          state.answers[key] = c;
          save();
          redraw();
        });
        btnsDiv.appendChild(remove);

        stepDiv.appendChild(btnsDiv);
        box.appendChild(stepDiv);
      }

      const availPool = q.steps.filter(s=>!sel.includes(s.id));
      if(availPool.length){
        const poolDiv = document.createElement("div");
        poolDiv.style.marginTop = "10px";
        poolDiv.innerHTML = "<b>√âtapes restantes :</b>";
        for(const st of availPool){
          const btn = document.createElement("button");
          btn.style.marginLeft = "8px";
          btn.style.marginTop = "6px";
          btn.textContent = `+ ${st.text}`;
          btn.addEventListener("click", (e)=>{
            e.preventDefault();
            const c = state.answers[key] || [];
            c.push(st.id);
            state.answers[key] = c;
            save();
            redraw();
          });
          poolDiv.appendChild(btn);
        }
        box.appendChild(poolDiv);
      }
    }
    redraw();
    container.appendChild(box);
  }

  return container;
}

function renderQuestionUI_update(q){
  const card = document.querySelector(`.card[data-qid="${q.id}"]`);
  if(!card) return;
  const oldUI = card.querySelector(".opts, .tfTable, .stageBox");
  if(!oldUI) return;
  const newUI = renderQuestionUI(q);
  oldUI.parentNode.replaceChild(newUI.firstChild, oldUI);
}

function renderFeedbackBlock(res, q, hideHelp){
  const fb = document.createElement("div");
  fb.className = `feedback ${res.level}`;
  const summary = document.createElement("div");
  summary.innerHTML = `<b>Score : ${res.score.toFixed(1)} / ${q.points} pts</b>`;
  fb.appendChild(summary);
  if(res.details && res.details.length){
    const ul = document.createElement("ul");
    for(const d of res.details){
      const li = document.createElement("li");
      li.textContent = d;
      ul.appendChild(li);
    }
    fb.appendChild(ul);
  }
  if(!hideHelp && q.explain){
    const exp = document.createElement("div");
    exp.style.marginTop = "8px";
    exp.innerHTML = `<b>Explication :</b> ${q.explain}`;
    fb.appendChild(exp);
  }
  if(!hideHelp && q.type === "tf_block"){
    const ans = state.answers[keyFor(q)] || {};
    const wrongItems = q.items.filter(it=>{
      const v = ans[it.id];
      return (v !== it.correctIndex);
    });
    if(wrongItems.length && wrongItems.some(it=>it.explain)){
      const detailDiv = document.createElement("div");
      detailDiv.style.marginTop = "8px";
      detailDiv.innerHTML = "<b>D√©tails des erreurs :</b>";
      const ulDetail = document.createElement("ul");
      for(const it of wrongItems){
        if(it.explain){
          const li = document.createElement("li");
          li.innerHTML = `<i>${esc(it.text)}</i> ‚Üí ${it.explain}`;
          ulDetail.appendChild(li);
        }
      }
      detailDiv.appendChild(ulDetail);
      fb.appendChild(detailDiv);
    }
  }
  return fb;
}

function updateBadge(qid, res){
  const badge = document.getElementById(`badge_${qid}`);
  if(!badge) return;
  if(!res){
    badge.className = "badge muted";
    badge.textContent = "Non corrig√©";
  }else{
    badge.className = `badge ${res.level}`;
    badge.textContent = res.ok ? "‚úì Correct" : (res.level==="warn" ? "~ Partiel" : "‚úó Incorrect");
  }
}

/* ---------- KPIs ---------- */
function renderKpis(){
  const qs = getQuestions(currentTab);
  let done = 0;
  let total = 0;
  let scored = 0;
  let possible = 0;
  for(const q of qs){
    const key = keyFor(q);
    const fb = state.feedback[key];
    possible += q.points;
    if(fb){
      done++;
      scored += fb.score;
    }
    total++;
  }
  document.getElementById("kpiDone").textContent = `${done} / ${total}`;
  document.getElementById("kpiSub").textContent = done===total ? "termin√©" : "questions";
  document.getElementById("kpiScore").textContent = `${scored.toFixed(1)} / ${possible}`;
}

/* ---------- Render main ---------- */
function render(){
  document.querySelectorAll(".tab").forEach(t=>{
    t.classList.toggle("active", t.dataset.tab===currentTab);
  });

  const titles = {
    qcm: "Questions √† Choix Multiples (QCM)",
    vf: "Vrai / Faux",
    cas_aes: "Cas cliniques AES ‚Äî Situations vari√©es",
    dechets: "Tri des d√©chets ‚Äî SA vs DASRI"
  };
  const intros = {
    qcm: "Teste tes connaissances g√©n√©rales sur l'hygi√®ne et la pr√©vention des infections.",
    vf: "V√©rifie ta compr√©hension des concepts fondamentaux.",
    cas_aes: "Analyse des situations cliniques vari√©es d'AES avec diff√©rents pathog√®nes, portes d'entr√©e et vecteurs. Ces cas refl√®tent la r√©alit√© du terrain.",
    dechets: "Apprends √† distinguer les d√©chets selon leur fili√®re d'√©limination."
  };

  const qs = getQuestions(currentTab);
  document.getElementById("panelTitle").textContent = titles[currentTab] || "Questions";
  document.getElementById("intro").textContent = `${intros[currentTab] || ""} (${qs.length} question${qs.length>1?"s":""})`;

  const hideHelp = document.getElementById("hideHelp").checked;
  const content = document.getElementById("content");
  content.className = "content";
  if(currentTab==="dechets") content.classList.add("two");
  content.innerHTML = "";

  for(const q of qs){
    const card = document.createElement("div");
    card.className="card";
    card.dataset.qid = q.id;

    const h = document.createElement("h3");
    h.innerHTML = `${esc(q.title)} <span class="badge">${q.points} pt${q.points>1?"s":""}</span> <span id="badge_${q.id}" class="badge muted">Non corrig√©</span>`;
    card.appendChild(h);

    const meta = document.createElement("div");
    meta.className="meta";
    meta.innerHTML = `<span class="chip">${esc(labelType(q.type))}</span><span class="chip">${esc(q.id)}</span>`;
    card.appendChild(meta);

    const qtext = document.createElement("div");
    qtext.className="qtext";
    qtext.appendChild(renderPromptElement(q));
    card.appendChild(qtext);

    card.appendChild(renderQuestionUI(q));

    const actions = document.createElement("div");
    actions.className="inline";
    actions.style.marginTop="12px";

    const btnCheck = document.createElement("button");
    btnCheck.textContent="Corriger";
    btnCheck.onclick = ()=> checkOne(q.id);

    const btnResetOne = document.createElement("button");
    btnResetOne.textContent="R√©essayer";
    btnResetOne.onclick = ()=> resetOne(q.id);

    actions.appendChild(btnCheck);
    actions.appendChild(btnResetOne);

    const hint = document.createElement("div");
    hint.className="help";
    hint.id = `help_${q.id}`;
    hint.textContent = hideHelp ? "" : (q.extraExplain || "");
    actions.appendChild(hint);

    card.appendChild(actions);

    const fb = document.createElement("div");
    fb.id = `fb_${q.id}`;
    const savedFb = state.feedback[keyFor(q)];
    if(savedFb){
      fb.appendChild(renderFeedbackBlock(savedFb, q, hideHelp));
      updateBadge(q.id, savedFb);
    }else{
      updateBadge(q.id, null);
    }
    card.appendChild(fb);

    content.appendChild(card);
  }

  renderKpis();
}

/* ---------- Grading ---------- */
function grade(q, ans){
  if(q.type === "mcq"){
    const correctIds = q.options.filter(o=>o.correct).map(o=>o.id);
    let selected = ans || (q.multi ? [] : "");
    let ok=false, level="bad", score=0, details=[];

    if(q.multi){
      const selSet = new Set(Array.isArray(selected) ? selected : []);
      const pickedCorrect = correctIds.filter(id=>selSet.has(id)).length;
      const pickedIncorrect = q.options.filter(o=>!o.correct && selSet.has(o.id)).length;
      const missed = correctIds.filter(id=>!selSet.has(id)).length;

      ok = (pickedCorrect===correctIds.length && pickedIncorrect===0 && missed===0);

      let raw = pickedCorrect - pickedIncorrect;
      raw = Math.max(0, raw);
      score = (correctIds.length ? (raw / correctIds.length) : 0) * q.points;

      level = ok ? "ok" : (score >= q.points*0.7 ? "warn" : "bad");
      details.push(`Corrects s√©lectionn√©s : ${pickedCorrect}/${correctIds.length}.`);
      if(pickedIncorrect>0) details.push(`Choix incorrects : ${pickedIncorrect} (retire-les).`);
      if(missed>0) details.push(`Manquants : ${missed} (ajoute-les).`);
    }else{
      const sel = selected;
      ok = correctIds.includes(sel);
      score = ok ? q.points : 0;
      level = ok ? "ok" : "bad";
      details.push(ok ? "Bonne r√©ponse." : "Mauvaise r√©ponse.");
    }

    return { ok, level, score, details };
  }

  if(q.type === "tf_block"){
    const labels = q.labels || ["Faux","Vrai"];
    const a = ans || {};
    let good=0;
    let done=0;
    const wrong = [];
    for(const it of q.items){
      const v = a[it.id];
      if(v===0 || v===1){
        done++;
        if(v === it.correctIndex){
          good++;
        }else{
          wrong.push(it);
        }
      }else{
        wrong.push(it);
      }
    }
    const ratio = q.items.length ? (good / q.items.length) : 0;
    const score = ratio * q.points;
    const ok = (good === q.items.length);

    let level = ok ? "ok" : (ratio >= 0.7 ? "warn" : "bad");
    const details = [];
    details.push(`Bonnes r√©ponses : ${good}/${q.items.length}.`);
    if(done < q.items.length) details.push(`Non r√©pondu : ${q.items.length - done}.`);

    if(wrong.length){
      const preview = wrong.slice(0,6).map(it=>{
        const expected = labels[it.correctIndex] || "‚Äî";
        return `¬´ ${it.text} ¬ª ‚Üí attendu : ${expected}.`;
      });
      details.push(...preview);
      if(wrong.length>6) details.push(`(+${wrong.length-6} autres √† corriger)`);
    }

    return { ok, level, score, details };
  }

  if(q.type === "stage_sort"){
    const selected = Array.isArray(ans) ? ans : [];
    const expected = q.answer || [];
    const n = expected.length || 1;

    let correctPos = 0;
    for(let i=0;i<Math.min(selected.length, expected.length);i++){
      if(selected[i] === expected[i]) correctPos++;
    }
    const ratio = correctPos / n;
    const ok = (correctPos === n);
    const score = ratio * q.points;
    const level = ok ? "ok" : (ratio >= 0.7 ? "warn" : "bad");

    const details = [];
    details.push(`√âtapes bien plac√©es : ${correctPos}/${n}.`);
    if(!ok) details.push("Ajuste l'ordre (‚Üë ‚Üì) puis recorrige.");

    return { ok, level, score, details };
  }

  return { ok:false, level:"bad", score:0, details:["Type inconnu."] };
}

/* ---------- Actions ---------- */
function checkOne(qid){
  const q = (BANK[currentTab] || []).find(x=>x.id===qid);
  if(!q) return;
  const key = keyFor(q);
  const ans = state.answers[key];
  const res = grade(q, ans);
  state.feedback[key] = res;
  save();

  updateBadge(qid, res);
  const fbHost = document.getElementById(`fb_${qid}`);
  fbHost.innerHTML = "";
  fbHost.appendChild(renderFeedbackBlock(res, q, document.getElementById("hideHelp").checked));

  renderKpis();
}
function checkAll(){
  const qs = getQuestions(currentTab);
  for(const q of qs) checkOne(q.id);
}
function resetOne(qid){
  delete state.answers[qid];
  delete state.feedback[qid];
  save();
  render();
}
function resetTab(){
  const qs = getQuestions(currentTab);
  for(const q of qs){
    delete state.answers[q.id];
    delete state.feedback[q.id];
  }
  save();
  render();
}
function resetAll(){
  if(!confirm("Tout effacer (tous les onglets) ?")) return;
  state.answers = {};
  state.feedback = {};
  state.order = { qcm:[], vf:[], cas_aes:[], dechets:[] };
  state.shuffled = { qcm:false, vf:false, cas_aes:false, dechets:false };
  save();
  render();
}

/* ---------- Events ---------- */
document.querySelectorAll(".tab").forEach(btn=>{
  btn.addEventListener("click", ()=>{
    currentTab = btn.dataset.tab;
    render();
    save();
  });
});
document.getElementById("checkAll").addEventListener("click", checkAll);
document.getElementById("resetTab").addEventListener("click", resetTab);
document.getElementById("resetAll").addEventListener("click", resetAll);

document.getElementById("shuffle").addEventListener("change", ()=> render());
document.getElementById("hideHelp").addEventListener("change", ()=> render());

document.getElementById("toggleExport").addEventListener("click", ()=>{
  const panel = document.getElementById("exportPanel");
  panel.classList.toggle("visible");
  if(panel.classList.contains("visible")){
    exportToArea();
  }
});

document.getElementById("exportBtn").addEventListener("click", ()=>{
  exportToArea();
  const ta = document.getElementById("jsonArea");
  ta.focus();
  ta.select();
  try{ document.execCommand("copy"); }catch(e){}
  alert("Export pr√™t : JSON copi√© dans le presse-papier.");
});
document.getElementById("importBtn").addEventListener("click", ()=>{
  try{
    importFromArea();
    alert("Import termin√© avec succ√®s.");
    render();
  }catch(e){
    alert("Import impossible : " + e.message);
  }
});

/* ---------- Init ---------- */
load();
render();
</script>
</body>
</html>
