<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UE 3.10 – Hygiène & prévention du risque infectieux (S1) – Quiz interactif</title>
<style>
:root{
  --fg:#111;--bg:#fff;--muted:#6b7280;--brand:#111827;--ok:#059669;--bad:#dc2626;--card:#ffffff;
  --border:#e5e7eb;--chip:#f3f4f6;--chipfg:#111;--accent:#111827;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,'Noto Sans',sans-serif;color:var(--fg);background:var(--bg);line-height:1.5}
.container{max-width:1000px;margin:0 auto;padding:1rem}
h1{margin:.25rem 0 1rem;font-size:1.8rem}
h2{margin:1.25rem 0 .5rem}
.section{border:1px solid var(--border);border-radius:14px;background:var(--card);padding:1rem;margin:.75rem 0}
small.muted,.muted{color:var(--muted)}
.btn{appearance:none;border:1px solid var(--border);background:#fff;border-radius:10px;padding:.5rem .8rem;cursor:pointer}
.btn:hover{box-shadow:0 2px 8px rgba(0,0,0,.06)}
.btn.primary{background:var(--accent);border-color:var(--accent);color:#fff}
.btn.ghost{background:#fff}
.badge{font-size:.8rem;color:#fff;background:var(--brand);padding:.15rem .5rem;border-radius:999px}
.row{display:flex;gap:.75rem;flex-wrap:wrap;align-items:center}
.field{display:flex;gap:.5rem;align-items:flex-start;margin:.25rem 0}
.field input[type="text"], .field textarea{width:100%;padding:.6rem .7rem;border:1px solid var(--border);border-radius:10px}
.kp{display:inline-flex;align-items:center;gap:.35rem;background:var(--chip);border:1px solid var(--border);padding:.2rem .55rem;border-radius:999px}
.kp.ok{border-color:#a7f3d0;background:#ecfdf5}
.kp.bad{border-color:#fecaca;background:#fef2f2}
.feedback{margin-top:.5rem;font-size:.95rem}
.feedback.ok{color:var(--ok)}
.feedback.bad{color:var(--bad)}
hr.sep{border:none;border-top:1px dashed var(--border);margin:1rem 0}
/* drag & drop bins */
.board{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1rem}
.bin{border:2px dashed var(--border);border-radius:14px;min-height:220px;padding:.5rem;background:#fafafa}
.bin h3{margin:.25rem .5rem .5rem;font-size:1rem}
.card{border:1px solid var(--border);border-radius:12px;padding:.5rem .6rem;background:#fff;margin:.35rem 0;cursor:grab}
.card.dragging{opacity:.6}
.bin.correct{border-color:#10b981;background:#f0fdf4}
.bin.wrong{border-color:#ef4444;background:#fef2f2}
.helper{font-size:.9rem;color:var(--muted)}
/* order list drag */
.sortable{list-style:none;margin:0;padding:0}
.sortable li{border:1px solid var(--border);border-radius:10px;padding:.5rem .6rem;margin:.35rem 0;background:#fff;cursor:grab}
.sortable li.dragging{opacity:.6}
kbd{background:#111;color:#fff;border-radius:6px;padding:.1rem .35rem;font-size:.85rem}
.footer{padding:1rem 0;color:var(--muted);text-align:center}
summary{cursor:pointer}

#q7_case{font-size:1.15rem;line-height:1.6}
.bin[data-bin="pool"]{min-height:420px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.5rem;align-content:start}

.bin[data-bin="pool"] .card{margin:0;padding:.45rem .55rem;font-size:.95rem}


/* --- Q8 CLEAN LAYOUT --- */
#q8 .board{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:1rem}
#q8 .bin{border:2px dashed var(--border);border-radius:14px;min-height:220px;padding:.5rem;background:#fafafa}
#q8 .bin h3{margin:.25rem .5rem .5rem;font-size:1rem}
#q8 .bin[data-bin="pool"]{min-height:420px;display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:.5rem;align-content:start}
#q8 .bin[data-bin="pool"] .card{margin:0;padding:.45rem .55rem;font-size:.95rem}
#q8 .bin[data-bin="DAS"] .card,#q8 .bin[data-bin="DASRI"] .card{margin:.25rem;padding:.4rem .5rem;font-size:.92rem}
#q8 .card{border:1px solid var(--border);border-radius:12px;background:#fff;cursor:grab}
#q8 .card.dragging{opacity:.6}
#q8 .bin.correct{border-color:#10b981;background:#f0fdf4}
#q8 .bin.wrong{border-color:#ef4444;background:#fef2f2}


#q8 .wrong-card{outline:2px solid var(--bad); background:#fff5f5}
#q8 .ok-card{outline:1px solid #c7f9cc; background:#f0fff7}


/* Q8 pool paired slots */
#q8 .bin h3{grid-column:1/-1}
#q8 .slot{border:1px dashed transparent; min-height:48px; border-radius:10px; display:block}
#q8 .slot.placeholder{border-color:#e5e7eb; background:#fafafa}

</style>
</head>
<body>
  <div class="container">
    <h1>UE 3.10 – Hygiène & prévention du risque infectieux <small class="muted">(S1)</small></h1>
    <p class="muted">Objectif : précautions standard, définitions clés, AEV, chaîne épidémiologique, hygiène des mains, tenue, EPI, tri des déchets (DAS/DASRI). <br>Auto‑correction au clic sur “Vérifier”, pas au fil de l’eau.</p>
    <div class="row" style="margin:.5rem 0 1rem">
      <button class="btn primary" id="checkAll">Corriger tout</button>
      <button class="btn ghost" id="resetAll">Réinitialiser</button>
    </div>

    <!-- Q1: Précautions standard (checkbox + vérif sur bouton + explications erreurs) -->
    <div class="section" id="q1">
      <h2>Q1 • Précautions standard (coche toutes les bonnes réponses)</h2>
      <div class="helper">Valide pour corriger. Les erreurs seront expliquées.</div>
      <div class="field"><label><input type="checkbox" data-key="hh"> Hygiène des mains selon indications</label></div>
      <div class="field"><label><input type="checkbox" data-key="epi"> Port d’EPI adaptés selon risque</label></div>
      <div class="field"><label><input type="checkbox" data-key="resp"> Hygiène respiratoire / étiquette toux</label></div>
      <div class="field"><label><input type="checkbox" data-key="iso"> Isolement systématique de tous les patients</label></div>
      <div class="field"><label><input type="checkbox" data-key="mat"> Gestion du matériel (nettoyage, désinfection, stérilisation)</label></div>
      <div class="field"><label><input type="checkbox" data-key="surfaces"> Gestion de l’environnement (surfaces, linge)</label></div>
      <div class="field"><label><input type="checkbox" data-key="inj"> Sécurité des injections & prévention des AES/AEV</label></div>
      <div class="field"><label><input type="checkbox" data-key="alim"> Alimentation stérile obligatoire pour tous les patients</label></div>
      <div class="field"><label><input type="checkbox" data-key="tri"> Tri et élimination des déchets (DAS/DASRI)</label></div>
      <div class="field"><label><input type="checkbox" data-key="abp"> Antibioprophylaxie systématique des soignants</label></div>
      <div class="field"><label><input type="checkbox" data-key="vacc"> Vaccinations à jour pour le personnel (politique institutionnelle)</label></div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
      <details style="margin-top:.5rem"><summary>Contenu attendu</summary>
        <ul class="muted">
          <li>Hygiène des mains ; EPI adaptés ; hygiène respiratoire ; sécurité des injections/AEV ; gestion du matériel ; gestion du linge/surfaces ; tri des déchets.</li>
          <li><em>Ne sont pas des précautions standard : isolement systématique, antibioprophylaxie systématique, alimentation stérile pour tous ; politique vaccinale du personnel.</em></li>
        </ul>
      </details>
    </div>

    <!-- Q2: Définition stérilisation (entrée libre + vérif mots-clés + masque) -->
    <div class="section" id="q2">
      <h2>Q2 • Définis « stérilisation »</h2>
      <div class="helper">Vérification par mots‑clés (tolérante). Sinon, <button class="btn btn-sm" data-toggle="mask">afficher la réponse</button>.</div>
      <div class="field"><textarea rows="3" placeholder="Ta définition…"></textarea></div>
      <div class="row">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
      <hr class="sep">
      <div class="kp muted">Réponse attendue (masquée) :</div>
      <div class="section" data-mask style="display:none">
        Processus validé visant à obtenir un état <strong>stérile</strong>, c’est‑à‑dire l’<strong>élimination</strong> de <strong>tous</strong> les <strong>micro‑organismes</strong>, y compris les <strong>spores</strong> bactériennes.
      </div>
    </div>

    <!-- Q3: Conduite AEV (bouton + explications; leurres ajoutés) -->
    <div class="section" id="q3">
      <h2>Q3 • Conduite immédiate en cas d’AEV</h2>
      <div class="helper">Coche les actions immédiates correctes. Les erreurs seront expliquées.</div>
      <div class="field"><label><input type="checkbox" data-key="lavage"> Laver la zone à l’eau et au savon puis rincer (ou rinçage abondant si muqueuse)</label></div>
      <div class="field"><label><input type="checkbox" data-key="antisepsie"> Antisepsie rapide selon protocole local</label></div>
      <div class="field"><label><input type="checkbox" data-key="eval"> Alerter et faire évaluer le risque (référent/urgences), envisager prophylaxie</label></div>
      <div class="field"><label><input type="checkbox" data-key="garrot"> Mettre un garrot prolongé sur la zone exposée</label></div>
      <div class="field"><label><input type="checkbox" data-key="attendre"> Attendre la fin de service pour déclarer</label></div>
      <div class="field"><label><input type="checkbox" data-key="of"> Prévenir immédiatement mon organisme de formation</label></div>
      <div class="field"><label><input type="checkbox" data-key="dat"> Déclarer un accident du travail pour se prémunir des conséquences</label></div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
      <details style="margin-top:.5rem"><summary>Rappel (masqué)</summary>
        <ul>
          <li><strong>Immédiat :</strong> rinçage/lavage, antisepsie, évaluation du risque sans délai.</li>
          <li><strong>Ensuite :</strong> traçabilité, déclaration (AT/registre), suivi sérologique, signalement institutionnel selon procédure.</li>
        </ul>
      </details>
    </div>

    <!-- Q4: Chaîne épidémiologique (ordre + bouton "voir la solution") -->
    <div class="section" id="q4">
      <h2>Q4 • Réordonne la chaîne épidémiologique</h2>
      <div class="helper">Glisse pour obtenir l’ordre canonique.</div>
      <ol class="sortable" data-answer="Agent étiologique|Réservoir|Porte de sortie|Mode de transmission|Porte d’entrée|Hôte réceptif">
        <li draggable="true">Réservoir</li>
        <li draggable="true">Porte d’entrée</li>
        <li draggable="true">Mode de transmission</li>
        <li draggable="true">Hôte réceptif</li>
        <li draggable="true">Agent étiologique</li>
        <li draggable="true">Porte de sortie</li>
      </ol>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check-order">Vérifier l’ordre</button>
        <button class="btn ghost" data-action="show-solution">Voir le bon ordre</button>
        <span class="feedback" data-feedback></span>
      </div>
    </div>

    <!-- Q5: Hygiène des mains (QCM radios) -->
    <div class="section" id="q5">
      <h2>Q5 • Hygiène des mains : SHA ou lavage ? (plusieurs réponses)</h2>
      <div class="helper">Coche les deux réponses justes puis clique sur Vérifier.</div>
      <div class="field"><label><input type="checkbox" data-key="sha_ok"> Friction hydro‑alcoolique en l’absence de souillures visibles</label></div>
      <div class="field"><label><input type="checkbox" data-key="sha_blood"> Friction hydro‑alcoolique même si mains souillées de sang visible</label></div>
      <div class="field"><label><input type="checkbox" data-key="lavage_ok"> Lavage à l’eau + savon si mains <em>visiblement</em> souillées</label></div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
    </div>
    

    <!-- Q6: Tenue professionnelle (avec leurres, vérif sur bouton) -->
    <div class="section" id="q6">
      <h2>Q6 • Tenue professionnelle</h2>
      <div class="helper">Coche ce qui relève des exigences usuelles. Valide pour corriger.</div>
      <div class="field"><label><input type="checkbox" data-key="cheveux"> Cheveux attachés / barbe maîtrisée selon protocole</label></div>
      <div class="field"><label><input type="checkbox" data-key="parfum"> Des cheveux courts </label></div>	  
      <div class="field"><label><input type="checkbox" data-key="ongles"> Ongles courts, sans vernis/FA/ongles artificiels</label></div>
      <div class="field"><label><input type="checkbox" data-key="bijoux"> Pas de bijoux aux mains/poignets</label></div>
      <div class="field"><label><input type="checkbox" data-key="gants_toujours"> Gants portés en permanence dans le service</label></div>
      <div class="field"><label><input type="checkbox" data-key="parfum"> Utilisation de parfum fort pour masquer les odeurs</label></div>
      <div class="field"><label><input type="checkbox" data-key="parfum"> Utiliser un masque</label></div>	  
      <div class="field"><label><input type="checkbox" data-key="tenueville"> Conserver sa tenue de ville sous la sur‑blouse</label></div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
    </div>

    <!-- Q7: EPI – cas variables aléatoires (vérif sur bouton) -->
    <div class="section" id="q7">
      <h2>Q7 • EPI selon le cas (aléatoire)</h2>
      <p class="helper" id="q7_case">Chargement du cas…</p>
      <div id="q7_options"></div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check">Vérifier</button>
        <span class="feedback" data-feedback></span>
      </div>
      <details style="margin-top:.5rem"><summary>Rappels EPI (masqué)</summary>
        <ul>
          <li>Masque chirurgical : projections/gouttelettes ; FFP2 : aérosols.</li>
          <li>Protection oculaire/visière si risque de projections vers les muqueuses.</li>
          <li>Sur‑blouse/Tablier selon risque de souillure.</li>
          <li>Gants selon soin et risque de contact avec liquides biologiques.</li>
        </ul>
      </details>
    </div>

    <!-- Q8: DAS vs DASRI – plus de cartes + bacs plus hauts -->
    
<div class="section" id="q8">
  <h2>Q8 • Triez : <span class="badge">DAS</span> vs <span class="badge">DASRI</span></h2>
  <div class="helper">Glisse chaque élément dans le bon bac. Raccourci pratique : touche <kbd>R</kbd> pour réinitialiser le tri.</div>
  <div class="board" id="q8_board">
    <div class="bin" data-bin="pool" aria-label="éléments à trier">
      <h3>À trier</h3>
      <div class="card" draggable="true" data-type="DASRI">Aiguille usagée</div>
          <div class="card" draggable="true" data-type="DASRI">Compresses souillées de sang</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés</div>
          <div class="card" draggable="true" data-type="DAS">Emballage carton gras</div>
          <div class="card" draggable="true" data-type="DASRI">Dispositif piquant/coupant</div>
          <div class="card" draggable="true" data-type="DAS">Papier essuie‑mains</div>
          <div class="card" draggable="true" data-type="DAS">sonde nasale</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable</div>
          <div class="card" draggable="true" data-type="DASRI">Tubes de prélèvement remplis</div>
          <div class="card" draggable="true" data-type="DAS">Blister plastique</div>
          <div class="card" draggable="true" data-type="DASRI">Pansement fortement souillé</div>
          <div class="card" draggable="true" data-type="DAS">Serviette papier usagée</div>
          <div class="card" draggable="true" data-type="DASRI">Gants ayant servi (Clostridioides difficile)</div>
          <div class="card" draggable="true" data-type="DASRI">Compresses souillées (Clostridioides difficile)</div>
          <div class="card" draggable="true" data-type="DASRI">Sur‑blouse souillée (gale/poux/morpions)</div>
          <div class="card" draggable="true" data-type="DASRI">Peigne utilisé avec lentes (poux/morpions)</div>
          <div class="card" draggable="true" data-type="DASRI">Champ de soin souillé (diarrhée infectieuse)</div>
          <div class="card" draggable="true" data-type="DASRI">Compresse souillée (Bacillus anthracis – charbon)</div>
          <div class="card" draggable="true" data-type="DASRI">Gants souillés (choléra)</div>
          <div class="card" draggable="true" data-type="DASRI">Gants souillés (Ebola – fièvre hémorragique)</div>
          <div class="card" draggable="true" data-type="DASRI">Blouse souillée (fièvre jaune)</div>
          <div class="card" draggable="true" data-type="DASRI">Compresse souillée (rage)</div>
          <div class="card" draggable="true" data-type="DASRI">Matériel piquant après soin (typhus)</div>
          <div class="card" draggable="true" data-type="DASRI">Compresses souillées (peste)</div>
          <div class="card" draggable="true" data-type="DASRI">Coton souillé (poliomyélite)</div>
          <div class="card" draggable="true" data-type="DAS">Gants usagés (COVID‑19)</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable utilisé (grippe saisonnière)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Orthomyxovirus H3N2)</div>
          <div class="card" draggable="true" data-type="DAS">Blouse papier (Adenovirus 41)</div>
          <div class="card" draggable="true" data-type="DAS">Sachet plastique (Bunyaviridae)</div>
          <div class="card" draggable="true" data-type="DAS">Embout plastique (Paramyxovirus)</div>
    
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Rhinovirus)</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable sec (Coronavirus HKU1)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Bacillus subtilis – contrôle)</div>
          <div class="card" draggable="true" data-type="DAS">Emballage plastique étiqueté « Salmonella » (vide)</div>
          <div class="card" draggable="true" data-type="DAS">Blister plastique (E. coli – notice)</div>
          <div class="card" draggable="true" data-type="DAS">Sachet papier (Norovirus – affiche)</div>
          <div class="card" draggable="true" data-type="DAS">Brochure patient « grippe saisonnière »</div>
          <div class="card" draggable="true" data-type="DAS">Étiquette autocollante « Streptococcus » (non utilisée)</div>
          <div class="card" draggable="true" data-type="DAS">Carton d’emballage « Ebola PPE » (vide)</div>
          <div class="card" draggable="true" data-type="DAS">Flacon désinfectant vide (sans résidu biologique)</div>
          <div class="card" draggable="true" data-type="DAS">Masque FFP2 non utilisé (COVID‑19 – stock)</div>
          <div class="card" draggable="true" data-type="DAS">Sur-blouse propre (choléra – réserve)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sous sachet scellé (poliomyélite – stock)</div>
          <div class="card" draggable="true" data-type="DAS">Peigne jetable emballé (poux/morpions – stock)</div>
          <div class="card" draggable="true" data-type="DAS">Boîte de gants neuve (Clostridioides difficile – mention)</div>
          <div class="card" draggable="true" data-type="DAS">Notice « fièvre jaune »</div>
          <div class="card" draggable="true" data-type="DAS">Affichette « typhus » (prévention)</div>
          <div class="card" draggable="true" data-type="DAS">Sac poubelle neuf (peste – pictogramme)</div>
          <div class="card" draggable="true" data-type="DAS">Etiquette « H3N2 » en rab</div>
          <div class="card" draggable="true" data-type="DAS">Boîte vide de prélèvement (étiquetée virus)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Staphylococcus aureus)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Streptococcus pyogenes)</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable sec (Virus respiratoire syncytial – VRS)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Hepatitis A virus – HAV)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Corynebacterium diphtheriae)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Clostridium botulinum)</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable sec (Herpes simplex virus – HSV‑1)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Varicella‑Zoster virus – VZV)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Cytomegalovirus – CMV)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Epstein‑Barr virus – EBV)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Rotavirus)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Virus respiratoire métapneumovirus)</div>
          <div class="card" draggable="true" data-type="DAS">Masque jetable sec (Coronavirus OC43)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Mycoplasma pneumoniae)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Haemophilus influenzae)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Campylobacter jejuni)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Listeria monocytogenes)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Shigella sonnei)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Giardia lamblia)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Entamoeba histolytica)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Ascaris lumbricoides)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Trichophyton rubrum)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Candida albicans)</div>
          <div class="card" draggable="true" data-type="DAS">Gants non souillés (Toxoplasma gondii)</div>
          <div class="card" draggable="true" data-type="DAS">Compresse sèche (Leishmania donovani)</div></div>
    <div class="bin" data-bin="DAS">
      <h3>DAS (assimilables aux ordures banales)</h3>
    </div>
    <div class="bin" data-bin="DASRI">
      <h3>DASRI (infectieux/PICT)</h3>
    </div>
  </div>
  <div class="row" style="margin-top:.5rem">
    <button class="btn" data-action="check-bins">Vérifier le tri</button>
    <span class="feedback" data-feedback></span>
  </div>
</div>
</div>
        </div>
            </div>
        <div class="bin" data-bin="DAS">
          <h3>DAS (assimilables aux ordures banales)</h3>
        </div>
        <div class="bin" data-bin="DASRI">
          <h3>DASRI (infectieux/PICT)</h3>
        </div>
      </div>
      <div class="row" style="margin-top:.5rem">
        <button class="btn" data-action="check-bins">Vérifier le tri</button>
        <span class="feedback" data-feedback></span>
      </div>
    </div>

    <div class="footer">Fichier autonome. Aucune dépendance externe. Local‑friendly.</div>
  </div>

<script>
(function(){
  const q = (sel, el=document)=>el.querySelector(sel);
  const qa = (sel, el=document)=>Array.from(el.querySelectorAll(sel));
  const norm = s => (s||"").normalize('NFD').replace(/\p{Diacritic}/gu,'').toLowerCase().trim();

  // Q1: delayed check + reasons
  (function(){
    const sec = q("#q1");
    const fb = q("[data-feedback]", sec);
    const btn = q("[data-action=check]", sec);
    const keys = {
      hh:{ok:true},
      epi:{ok:true},
      resp:{ok:true},
      iso:{ok:false, why:"L’isolement est <em>ciblé</em> selon le risque/agent, pas systématique."},
      mat:{ok:true},
      surfaces:{ok:true},
      inj:{ok:true},
      alim:{ok:false, why:"Aucune obligation d’alimentation stérile pour tous les patients."},
      tri:{ok:true},
      abp:{ok:false, why:"Pas d’antibioprophylaxie systématique des soignants."},
      vacc:{ok:false}
    };
    btn.addEventListener("click", ()=>{
      const boxes = qa("input[type=checkbox]", sec);
      let totalOK = Object.values(keys).filter(v=>v.ok).length;
      let ok = 0, wrong = [];
      boxes.forEach(b=>{
        const k = b.dataset.key;
        if(b.checked && keys[k]?.ok) ok++;
        if(b.checked && keys[k] && !keys[k].ok) wrong.push({label:b.parentElement.textContent.trim(), why:keys[k].why});
      });
      let msg = `Correct: ${ok}/${totalOK}`;
      if(wrong.length){
        msg += " — À décocher : ";
        msg += wrong.map(w=>`<span class="kp bad">${w.label}</span> <span class="muted">(${w.why})</span>`).join(" ; ");
      }
      fb.innerHTML = msg;
      fb.className = "feedback " + (wrong.length===0 && ok===totalOK ? "ok":"bad");
    });
  })();

  // Q2: as before
  (function(){
    const sec = q("#q2");
    const ta = q("textarea", sec);
    const btn = q("[data-action=check]", sec);
    const fb = q("[data-feedback]", sec);
    const maskBtn = q("[data-toggle=mask]", sec);
    const mask = q("[data-mask]", sec);
    const keywords = ["tous","micro","microorganisme","micro-organisme","micro organisme","spore","elimination","destruction","sterile"];
    btn.addEventListener("click", ()=>{
      const val = norm(ta.value);
      const hits = keywords.filter(k=>val.includes(k));
      const pass = hits.length >= 4 && val.includes("steril");
      fb.textContent = pass ? "OK — mots-clés présents." : "À revoir — ajoute les notions clés (tous, micro‑organismes, spores, élimination…).";
      fb.className = "feedback " + (pass?"ok":"bad");
    });
    maskBtn.addEventListener("click", ()=>{
      mask.style.display = mask.style.display==="none" ? "block":"none";
    });
  })();

  // Q3: delayed check + reasons + lures
  (function(){
    const sec = q("#q3");
    const fb = q("[data-feedback]", sec);
    const btn = q("[data-action=check]", sec);
    const keys = {
      lavage:{ok:true},
      antisepsie:{ok:true},
      eval:{ok:true},
      garrot:{ok:false, why:"Garrot prolongé contre‑indiqué : risque tissulaire, n’empêche pas l’inoculation."},
      attendre:{ok:false, why:"La déclaration/évaluation doit être <em>immédiate</em>."},
      of:{ok:false, why:"Prévenir l’organisme de formation n’est pas une mesure <em>immédiate</em> de prise en charge clinique."},
      dat:{ok:false, why:"La déclaration d’AT est <em>administrative</em> et intervient après la prise en charge immédiate."}
    };
    btn.addEventListener("click", ()=>{
      const boxes = qa("input[type=checkbox]", sec);
      let totalOK = Object.values(keys).filter(v=>v.ok).length;
      let ok = 0, wrong = [];
      boxes.forEach(b=>{
        const k = b.dataset.key;
        if(b.checked && keys[k]?.ok) ok++;
        if(b.checked && keys[k] && !keys[k].ok) wrong.push({label:b.parentElement.textContent.trim(), why:keys[k].why});
      });
      let msg = `Correct: ${ok}/${totalOK}`;
      if(wrong.length){
        msg += " — À décocher : ";
        msg += wrong.map(w=>`<span class="kp bad">${w.label}</span> <span class="muted">(${w.why})</span>`).join(" ; ");
      }
      fb.innerHTML = msg;
      fb.className = "feedback " + (wrong.length===0 && ok===totalOK ? "ok":"bad");
    });
  })();

  // Q4: sortable + show solution
  (function(){
    const sec = q("#q4");
    const list = q(".sortable", sec);
    let dragEl = null;
    list.addEventListener("dragstart", e=>{ if(e.target.tagName==="LI"){ dragEl=e.target; e.target.classList.add("dragging"); } });
    list.addEventListener("dragend", e=>{ if(dragEl){ dragEl.classList.remove("dragging"); dragEl=null; } });
    list.addEventListener("dragover", e=>{
      e.preventDefault();
      const after = getDragAfterElement(list, e.clientY);
      if(after==null) list.appendChild(dragEl);
      else list.insertBefore(dragEl, after);
    });
    function getDragAfterElement(container, y){
      const els = [...container.querySelectorAll("li:not(.dragging)")];
      return els.reduce((closest, child)=>{
        const box = child.getBoundingClientRect();
        const offset = y - box.top - box.height/2;
        if(offset<0 && offset>closest.offset){ return {offset, element:child}; }
        else return closest;
      }, {offset: Number.NEGATIVE_INFINITY}).element;
    }
    const fb = q("[data-feedback]", sec);
    q("[data-action=check-order]", sec).addEventListener("click", ()=>{
      const ans = (list.dataset.answer||"").split("|").map(s=>s.trim());
      const cur = qa("li", list).map(li=>li.textContent.trim());
      const ok = ans.every((v,i)=>norm(v)===norm(cur[i]));
      fb.textContent = ok ? "Ordre correct ✅" : "Ordre incorrect ❌";
      fb.className = "feedback " + (ok?"ok":"bad");
    });
    q("[data-action=show-solution]", sec).addEventListener("click", ()=>{
      const ans = (list.dataset.answer||"").split("|").map(s=>s.trim());
      qa("li", list).forEach(li=>li.remove());
      ans.forEach(t=>{
        const li=document.createElement("li"); li.textContent=t; li.setAttribute("draggable","true"); list.appendChild(li);
      });
      fb.textContent = "Solution affichée.";
      fb.className = "feedback ok";
    });
  })();

  // Q5: multichoix (2 bonnes réponses)
  (function(){
    const sec = q("#q5");
    const fb = q("[data-feedback]", sec);
    const keys = { sha_ok:true, lavage_ok:true, sha_blood:false };
    q("[data-action=check]", sec).addEventListener("click", ()=>{
      const boxes = qa("input[type=checkbox]", sec);
      let okSel = 0, wrongSel = [];
      let missing = [];
      boxes.forEach(b=>{
        const k = b.dataset.key;
        const isOk = !!keys[k];
        if(b.checked && isOk) okSel++;
        if(b.checked && !isOk) wrongSel.push("« "+b.parentElement.textContent.trim()+" »");
      });
      Object.entries(keys).forEach(([k,v])=>{
        if(v && !boxes.find(b=>b.dataset.key===k && b.checked)) missing.push(k==="sha_ok"?"SHA en l’absence de souillures":"Lavage eau+savon si souillures visibles");
      });
      if(okSel===2 && wrongSel.length===0 && missing.length===0){
        fb.textContent = "Sélection correcte ✅";
        fb.className = "feedback ok";
      }else{
        let parts = [];
        if(wrongSel.length) parts.push("À décocher : " + wrongSel.join("; "));
        if(missing.length) parts.push("Manquants : " + missing.join(" ; "));
        fb.innerHTML = parts.length ? parts.join(" — ") : "Incomplet.";
        fb.className = "feedback bad";
      }
    });
  })();

  // Q6: tenue (delayed + reasons)
  (function(){
    const sec = q("#q6");
    const fb = q("[data-feedback]", sec);
    const btn = q("[data-action=check]", sec);
    const keys = {
      cheveux:{ok:true},
      ongles:{ok:true},
      bijoux:{ok:true},
      gants_toujours:{ok:false, why:"Les gants se portent selon le soin/risque, pas en permanence."},
      parfum:{ok:false, why:"Parfum fort déconseillé (allergènes, inconfort patient/équipe)."},
      tenueville:{ok:false, why:"Tenue dédiée exigée, pas de tenue de ville sous la tenue pro."}
    };
    btn.addEventListener("click", ()=>{
      const boxes = qa("input[type=checkbox]", sec);
      let totalOK = Object.values(keys).filter(v=>v.ok).length;
      let ok = 0, wrong = [];
      boxes.forEach(b=>{
        const k = b.dataset.key;
        if(b.checked && keys[k]?.ok) ok++;
        if(b.checked && keys[k] && !keys[k].ok) wrong.push({label:b.parentElement.textContent.trim(), why:keys[k].why});
      });
      let msg = `Correct: ${ok}/${totalOK}`;
      if(wrong.length){
        msg += " — À décocher : ";
        msg += wrong.map(w=>`<span class="kp bad">${w.label}</span> <span class="muted">(${w.why})</span>`).join(" ; ");
      }
      fb.innerHTML = msg;
      fb.className = "feedback " + (wrong.length===0 && ok===totalOK ? "ok":"bad");
    });
  })();

  // Q7: random case with expected EPI set
  (function(){
    const sec = q("#q7");
    const fb = q("[data-feedback]", sec);
    const container = q("#q7_options", sec);
    const cas = [
      {txt:"Patient tousse fortement (gouttelettes), soin non invasif.", ok:["Masque chirurgical","Protection oculaire/visière","Sur‑blouse selon risque"]},
      {txt:"Aérosolisation (aspiration trachéale).", ok:["FFP2","Protection oculaire/visière","Sur‑blouse selon risque","Gants"]},
      {txt:"Soin propre sans exposition prévue aux liquides biologiques.", ok:["Hygiène des mains"], extra:["Pas d’EPI spécifique"]},
      {txt:"Ponction veineuse (risque contact sang).", ok:["Gants","Protection oculaire/visière"]},
      {txt:"Patient avec vomissements abondants (projection).", ok:["Sur‑blouse","Protection oculaire/visière","Gants","Masque chirurgical"]},
      {txt:"Manipulation de linge potentiellement souillé.", ok:["Gants","Sur‑blouse"]},
      {txt:"Transport d’un patient sans symptôme respiratoire, pas de soin.", ok:["Hygiène des mains"]},
      {txt:"Dépose d’un cathéter périphérique (sang possible).", ok:["Gants","Protection oculaire/visière"]},
      {txt:"Nettoyage d’une salle après acte sanglant.", ok:["Gants","Sur‑blouse","Protection oculaire/visière"]},
      {txt:"Soin avec risque d’aérosol (Nébulisation chez patient contagieux respiratoire).", ok:["FFP2","Protection oculaire/visière","Sur‑blouse"]}
    ];
    const options = ["Hygiène des mains","Gants","Masque chirurgical","FFP2","Protection oculaire/visière","Sur‑blouse","Tablier plastique","Aucun EPI"];
    const chosen = cas[Math.floor(Math.random()*cas.length)];
    q("#q7_case").innerHTML = "<span style=\"font-weight:700;text-decoration:underline\">cas pratigue</span> : " + chosen.txt;
    // Build checkboxes
    options.forEach(o=>{
      const div=document.createElement("div"); div.className="field";
      const id = "q7_"+o.replace(/\W+/g,'_');
      div.innerHTML = `<label><input type="checkbox" id="${id}" data-label="${o}"> ${o}</label>`;
      container.appendChild(div);
    });
    q("[data-action=check]", sec).addEventListener("click", ()=>{
      const boxes = qa("input[type=checkbox]", container);
      const okset = new Set(chosen.ok);
      // Build lures reasoning
      const reasons = {
        "Aucun EPI":"Formulation piégeuse : préférer formuler les protections requises ou 'Hygiène des mains' seule si aucun EPI spécifique.",
        "Masque chirurgical":"Adapté aux gouttelettes/projections, pas aux aérosols.",
        "FFP2":"Pour exposition aux aérosols/airborne.",
        "Gants":"Si risque de contact avec liquides biologiques ou surface fortement souillée.",
        "Protection oculaire/visière":"Si risque de projections vers les muqueuses.",
        "Sur‑blouse":"Si risque de souillure des vêtements par projections/contacts.",
        "Tablier plastique":"Protection complémentaire contre mouillage/souillure frontale.",
        "Hygiène des mains":"Toujours selon indications, avant/après le soin."
      };
      let wrong=[], missing=[];
      boxes.forEach(b=>{
        const lab = b.dataset.label;
        const checked = b.checked;
        const isOk = okset.has(lab);
        if(checked && !isOk){ wrong.push(`<span class="kp bad">${lab}</span> <span class="muted">(${reasons[lab]||"Inadapté au scénario."})</span>`); }
      });
      okset.forEach(req=>{
        const found = boxes.find(b=>b.dataset.label===req && b.checked);
        if(!found) missing.push(`<span class="kp bad">${req}</span> <span class="muted">(attendu)</span>`);
      });
      if(!wrong.length && !missing.length){
        fb.innerHTML = "Sélection adaptée ✅";
        fb.className = "feedback ok";
      }else{
        let parts=[];
        if(wrong.length) parts.push("À décocher : " + wrong.join(" ; "));
        if(missing.length) parts.push("Manquants : " + missing.join(" ; "));
        fb.innerHTML = parts.join(" — ");
        fb.className = "feedback bad";
      }
    });
  })();

  

  // Global buttons
  q("#checkAll").addEventListener("click", ()=>{
    q("#q1 [data-action=check]").click();
    q("#q2 [data-action=check]").click();
    q("#q4 [data-action=check-order]").click();
    q("#q5 [data-action=check]").click();
    q("#q6 [data-action=check]").click();
    q("#q7 [data-action=check]").click();
    q("#q8 [data-action=check-bins]").click();
  });
  q("#resetAll").addEventListener("click", ()=>{
    qa("input[type=checkbox], input[type=radio]").forEach(i=>{ i.checked=false; });
    qa("textarea").forEach(t=>t.value="");
    qa(".feedback").forEach(f=>{ f.textContent=""; f.className="feedback"; f.innerHTML=""; });
    const pool = q('#q8 [data-bin="pool"]');
    qa("#q8 .card").forEach(c=>{ pool.appendChild(c); c.style.borderColor="#e5e7eb"; });
  });
})();
</script>

<script>
(function(){
  function shuffleFields(sectionId){
    const sec = document.querySelector(sectionId);
    if(!sec) return;
    const fields = Array.from(sec.querySelectorAll('.field'));
    if(fields.length < 2) return;
    const parent = fields[0].parentElement;
    const row = sec.querySelector('.row'); // keep buttons at bottom
    const items = fields.slice();
    for(let i=items.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      [items[i], items[j]] = [items[j], items[i]];
    }
    items.forEach(el=> parent.insertBefore(el, row));
  }
  document.addEventListener('DOMContentLoaded', ()=>{
    shuffleFields('#q1');
    shuffleFields('#q3');
  });
})();

// Q8: clean drag & drop + validation (with per-card highlighting)
(function(){
  const root = document.querySelector('#q8');
  const pool = ()=> root.querySelector('[data-bin="pool"]');
  function buildSlotsInitial(){
    const p = pool();
    if(!p) return;
    const cards = Array.from(p.querySelectorAll('.card'));
    // Clear pool
    p.querySelectorAll('.card').forEach(()=>{}); // cards will be re-attached
    // Wrap each card in a slot; two slots per row thanks to CSS grid (2 columns)
    cards.forEach(c=>{
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.appendChild(c);
      p.appendChild(slot);
    });
  }
  function collapseEmptyRows(){
    const p = pool();
    const slots = Array.from(p.querySelectorAll('.slot'));
    for(let i=0;i<slots.length;i+=2){
      const a = slots[i], b = slots[i+1];
      if(!b){ continue; }
      const aEmpty = !a.querySelector('.card');
      const bEmpty = !b.querySelector('.card');
      if(aEmpty && bEmpty){
        a.remove();
        b.remove();
      }
    }
  }
  function leavePlaceholder(slot){
    if(!slot) return;
    if(slot.querySelector('.card')) return;
    slot.classList.add('placeholder');
  }
  function takeFromPool(card){
    const s = card.closest('.slot');
    if(s && s.parentElement === pool()){
      // remove card, leave placeholder
      s.classList.add('placeholder');
    }
  }
  function putIntoPool(card){
    const p = pool();
    // find first placeholder slot
    const ph = p.querySelector('.slot.placeholder');
    if(ph){
      ph.classList.remove('placeholder');
      ph.appendChild(card);
    }else{
      // create new row slot
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.appendChild(card);
      p.appendChild(slot);
    }
  }
  if(!root) return;
  buildSlotsInitial();
  const q = (sel, el=document)=>el.querySelector(sel);
  const qa = (sel, el=document)=>Array.from(el.querySelectorAll(sel));

  // Drag & drop
  let dragged = null;
  root.addEventListener('dragstart', e=>{
    const card = e.target.closest('.card');
    if(!card) return;
    dragged = card;
    dragged.__originSlot = card.closest('.slot') || null;
    card.classList.add('dragging');
    e.dataTransfer.effectAllowed = 'move';
  });
  root.addEventListener('dragend', e=>{
    const card = e.target.closest('.card');
    if(card) card.classList.remove('dragging');
    dragged = null;
  });
  root.addEventListener('dragover', e=>{
    if(!dragged) return;
    const bin = e.target.closest('.bin');
    if(!bin) return;
    e.preventDefault();
  });
  root.addEventListener('drop', e=>{
    if(!dragged) return;
    const bin = e.target.closest('.bin');
    if(!bin) return;
    e.preventDefault();
    const fromPool = dragged.closest('.slot') && dragged.closest('.slot').parentElement === pool();
    if(bin.getAttribute('data-bin')==='pool'){
      putIntoPool(dragged);
    }else{
      // moving to DAS/DASRI
      bin.appendChild(dragged);
      if(fromPool){
        // leave placeholder in originating slot
        const s = dragged.__lastSlotRef || null;
      }
    }
    // mark origin slot as placeholder if it belongs to pool and is empty
    const originSlot = dragged.__originSlot || dragged.closest('.slot');
    if(originSlot && originSlot.parentElement===pool()){
      if(!originSlot.querySelector('.card')) originSlot.classList.add('placeholder');
    }
    collapseEmptyRows();
  });

  // Reset with 'R'
  document.addEventListener('keydown', e=>{
    if(e.key.toLowerCase()!=='r') return;
    const pool = q('[data-bin="pool"]', root);
    const p = pool();
    const all = qa('.card', root);
    all.forEach(c=> p.appendChild(c));
    // remove old slots
    qa('.slot', p).forEach(s=> s.remove());
    // rebuild slots with cards in place
    const cards = qa('.card', p);
    cards.forEach(c=>{
      const slot = document.createElement('div');
      slot.className = 'slot';
      slot.appendChild(c);
      p.appendChild(slot);
    });
    clearFeedback();
  });

  function clearFeedback(){
    qa('.bin', root).forEach(b=> b.classList.remove('correct','wrong'));
    qa('.card', root).forEach(c=> c.classList.remove('wrong-card','ok-card'));
    const fb = q('[data-feedback]', root);
    if(fb){ fb.textContent=''; fb.className='feedback'; }
  }

  // Check
  q('[data-action="check-bins"]', root).addEventListener('click', ()=>{
    clearFeedback();
    const bins = {
      DAS: q('[data-bin="DAS"]', root),
      DASRI: q('[data-bin="DASRI"]', root),
      pool: q('[data-bin="pool"]', root)
    };
    let wrong = 0;
    // Cards left in pool => wrong, highlight them
    qa('.card', bins.pool).forEach(c=>{ c.classList.add('wrong-card'); wrong++; });

    // Validate DAS / DASRI
    for(const [name, el] of Object.entries(bins)){
      if(name==='pool') continue;
      const cards = qa('.card', el);
      let wrongHere = 0;
      cards.forEach(c=>{
        const t = c.getAttribute('data-type');
        const isOk = t===name;
        c.classList.add(isOk ? 'ok-card' : 'wrong-card');
        if(!isOk) wrongHere++;
      });
      if(wrongHere===0) el.classList.add('correct'); else el.classList.add('wrong');
      wrong += wrongHere;
    }
    const fb = q('[data-feedback]', root);
    if(wrong===0){
      fb.textContent = 'Tri correct ✅';
      fb.className = 'feedback ok';
    }else{
      fb.textContent = `Erreurs : ${wrong}. Les éléments problématiques sont en surbrillance.`;
      fb.className = 'feedback bad';
    }
  });
})();

</script>
</body>
</html>
