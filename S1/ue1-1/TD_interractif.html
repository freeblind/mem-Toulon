<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>UE 1.1 - Psychologie : Exercice interactif complet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    :root {
      --bg-gradient: radial-gradient(circle at top, #f5f7ff 0, #e8f0ff 30%, #fefefe 100%);
      --primary: #3b82f6;
      --primary-soft: #dbeafe;
      --accent: #ec4899;
      --accent-soft: #fce7f3;
      --good: #16a34a;
      --bad: #dc2626;
      --text-main: #0f172a;
      --text-soft: #6b7280;
      --card-bg: #ffffffcc;
      --border-soft: #e5e7eb;
      --shadow-soft: 0 18px 40px rgba(15, 23, 42, 0.08);
      --radius-xl: 20px;
      --radius-pill: 999px;
      --transition-fast: 0.2s ease;
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: var(--bg-gradient);
      color: var(--text-main);
      min-height: 100vh;
      padding: 24px;
      display: flex;
      justify-content: center;
    }

    .app-shell {
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
    }

    header {
      margin-bottom: 20px;
    }

    .title {
      font-size: clamp(1.7rem, 2.4vw, 2.2rem);
      font-weight: 800;
      letter-spacing: 0.02em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .title-badge {
      font-size: 0.8rem;
      padding: 4px 10px;
      border-radius: 999px;
      background: linear-gradient(135deg, var(--accent), var(--primary));
      color: #fff;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .subtitle {
      margin-top: 6px;
      font-size: 0.95rem;
      color: var(--text-soft);
      max-width: 720px;
    }

    .shell-card {
      background: var(--card-bg);
      border-radius: 28px;
      padding: 18px 20px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(148, 163, 184, 0.18);
      backdrop-filter: blur(12px);
    }

    .tab-bar {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-bottom: 16px;
    }

    .tab-button {
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      padding: 8px 16px;
      font-size: 0.9rem;
      background: #fff;
      color: var(--text-soft);
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      transition: background var(--transition-fast), color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast), border-color var(--transition-fast);
      box-shadow: 0 6px 18px rgba(15, 23, 42, 0.04);
    }

    .tab-button span.emoji {
      font-size: 1.1rem;
    }

    .tab-button.active {
      background: linear-gradient(135deg, var(--primary-soft), var(--accent-soft));
      color: var(--text-main);
      border-color: rgba(59, 130, 246, 0.55);
      box-shadow: 0 10px 26px rgba(59, 130, 246, 0.25);
      transform: translateY(-1px);
    }

    .tab-button:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 26px rgba(15, 23, 42, 0.16);
    }

    .tab-panels {
      margin-top: 4px;
    }

    .tab-panel {
      display: none;
      animation: fadeIn 0.25s ease-out;
    }

    .tab-panel.active {
      display: block;
    }

    @keyframes fadeIn {
      from {opacity: 0; transform: translateY(4px);}
      to {opacity: 1; transform: translateY(0);}
    }

    .panel-header {
      margin-bottom: 14px;
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
      align-items: baseline;
      gap: 8px;
    }

    .panel-title {
      font-size: 1.1rem;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-subtitle {
      font-size: 0.85rem;
      color: var(--text-soft);
      max-width: 540px;
    }

    .pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border-radius: var(--radius-pill);
      padding: 3px 10px;
      font-size: 0.75rem;
      background: #eff6ff;
      color: #1d4ed8;
      border: 1px solid #bfdbfe;
      white-space: nowrap;
    }

    .pill.neutral {
      background: #f3f4ff;
      color: #4b5563;
      border-color: #e5e7eb;
    }

    .pill strong {
      font-weight: 700;
    }

    .section-card {
      border-radius: var(--radius-xl);
      border: 1px solid var(--border-soft);
      padding: 14px 16px;
      background: #ffffffee;
      margin-bottom: 16px;
    }

    .btn-row {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 10px;
      align-items: center;
    }

    .btn {
      border-radius: var(--radius-pill);
      border: 1px solid transparent;
      padding: 7px 14px;
      font-size: 0.85rem;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      background: #f3f4ff;
      color: #111827;
      transition: background var(--transition-fast), color var(--transition-fast), box-shadow var(--transition-fast), transform var(--transition-fast), border-color var(--transition-fast);
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), #6366f1);
      color: #fff;
      box-shadow: 0 12px 30px rgba(37, 99, 235, 0.28);
    }

    .btn-outline {
      background: transparent;
      color: var(--text-main);
      border-color: #cbd5f5;
    }

    .btn-soft {
      background: #fdf2ff;
      color: #4c1d95;
      border-color: #f5d0ff;
    }

    .btn-next {
      margin-top: 4px;
    }

    .btn:hover {
      transform: translateY(-0.5px);
      box-shadow: 0 8px 20px rgba(15, 23, 42, 0.1);
    }

    .btn:active {
      transform: translateY(0);
      box-shadow: 0 3px 8px rgba(15, 23, 42, 0.14);
    }

    .btn .emoji {
      font-size: 1rem;
    }

    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.85rem;
    }

    th, td {
      padding: 6px 8px;
      text-align: left;
      vertical-align: top;
    }

    thead th {
      font-size: 0.8rem;
      text-transform: uppercase;
      letter-spacing: 0.06em;
      color: var(--text-soft);
      border-bottom: 1px solid var(--border-soft);
      background: #f9fafb;
    }

    tbody tr:nth-child(even) {
      background: #f9fafb;
    }

    tbody tr:nth-child(odd) {
      background: #ffffff;
    }

    tbody tr {
      transition: background 0.15s ease;
    }

    tbody tr:hover {
      background: #eef2ff;
    }

    .term {
      font-weight: 600;
      min-width: 120px;
    }

    select, input[type="text"], textarea {
      width: 100%;
      font-size: 0.85rem;
      padding: 6px 8px;
      border-radius: 8px;
      border: 1px solid #cbd5f5;
      outline: none;
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast);
      background: #fff;
    }

    select:focus, input[type="text"]:focus, textarea:focus {
      border-color: var(--primary);
      box-shadow: 0 0 0 1px rgba(59, 130, 246, 0.5);
      background: #f9fbff;
    }

    .feedback {
      font-size: 0.78rem;
      white-space: nowrap;
    }

    .feedback.good {
      color: var(--good);
      font-weight: 600;
    }

    .feedback.bad {
      color: var(--bad);
      font-weight: 600;
    }

    .feedback.neutral {
      color: var(--text-soft);
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 0.7rem;
      background: #e5e7eb;
      color: #374151;
    }

    .chip.good {
      background: #dcfce7;
      color: #166534;
    }

    .chip.bad {
      background: #fee2e2;
      color: #b91c1c;
    }

    .chip.info {
      background: #dbeafe;
      color: #1d4ed8;
    }

    .vf-question {
      border-radius: 12px;
      border: 1px solid #e5e7eb;
      padding: 10px 10px;
      margin-bottom: 8px;
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .vf-text {
      font-size: 0.9rem;
    }

    .vf-actions {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .vf-btn {
      border-radius: var(--radius-pill);
      border: 1px solid #d1d5db;
      padding: 4px 10px;
      font-size: 0.8rem;
      cursor: pointer;
      background: #fff;
      transition: background var(--transition-fast), color var(--transition-fast), border-color var(--transition-fast), transform var(--transition-fast), box-shadow var(--transition-fast);
    }

    .vf-btn.selected {
      background: #1d4ed8;
      color: #fff;
      border-color: #1d4ed8;
      box-shadow: 0 6px 14px rgba(37, 99, 235, 0.35);
      transform: translateY(-1px);
    }

    .vf-feedback {
      font-size: 0.78rem;
      color: var(--text-soft);
    }

    .vf-feedback.good {
      color: var(--good);
      font-weight: 600;
    }

    .vf-feedback.bad {
      color: var(--bad);
      font-weight: 600;
    }

    .stat-line {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 8px;
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    .stat-line strong {
      color: var(--text-main);
    }

    .badge-count {
      border-radius: var(--radius-pill);
      background: #eef2ff;
      padding: 2px 8px;
      font-size: 0.75rem;
      color: #312e81;
    }

    .situation-box {
      border-radius: 16px;
      border: 1px dashed #cbd5f5;
      background: #f9fafb;
      padding: 10px 12px;
      margin-top: 6px;
      font-size: 0.9rem;
      line-height: 1.4;
    }

    textarea {
      resize: vertical;
      min-height: 60px;
    }

    .situation-feedback {
      margin-top: 8px;
      font-size: 0.82rem;
    }

    .situation-feedback p {
      margin-bottom: 4px;
    }

    .highlight {
      font-weight: 600;
      color: #1f2937;
    }

    .concept-tag {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e0f2fe;
      color: #075985;
      font-size: 0.75rem;
      margin-right: 4px;
      margin-bottom: 4px;
    }

    .concept-tag strong {
      font-weight: 700;
    }

    /* D√©finitions ‚Äì d√©tails sous le select */
    .def-detail {
      margin-top: 4px;
      font-size: 0.78rem;
      line-height: 1.3;
    }

    .def-wrong {
      color: #b91c1c;
    }

    .def-correct {
      color: #15803d;
    }

    .select-good {
      border-color: #16a34a !important;
      background: #f0fdf4;
    }

    .select-bad {
      border-color: #dc2626 !important;
      background: #fef2f2;
    }

    /* Freud ‚Äì ordre repens√© */
    .freud-order-section {
      margin-bottom: 16px;
    }

    .freud-order-info {
      font-size: 0.8rem;
      color: var(--text-soft);
      margin-top: 4px;
    }

    .freud-order-list {
      list-style: none;
      padding: 0;
      margin-top: 8px;
    }

    .freud-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 6px 8px;
      margin-bottom: 6px;
      border-radius: 10px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      gap: 8px;
    }

    .freud-left {
      flex: 1;
    }

    .freud-position-label {
      font-size: 0.78rem;
      color: var(--text-soft);
      margin-bottom: 2px;
    }

    .freud-input {
      width: 100%;
    }

    .freud-controls {
      display: inline-flex;
      flex-direction: column;
      gap: 4px;
      margin-left: 8px;
    }

    .freud-move-btn {
      border-radius: 999px;
      border: 1px solid #d1d5db;
      background: #fff;
      padding: 2px 8px;
      font-size: 0.8rem;
      cursor: pointer;
    }

    .freud-move-btn:hover {
      background: #e5e7eb;
    }

    .freud-item.good {
      border-color: #16a34a;
      background: #ecfdf3;
    }

    .freud-item.bad {
      border-color: #dc2626;
      background: #fef2f2;
    }

    .freud-solution {
      margin-top: 6px;
      font-size: 0.82rem;
    }

    .freud-solution span {
      font-weight: 600;
    }

    .freud-tag {
      display: inline-block;
      margin-right: 4px;
      margin-bottom: 2px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #e0f2fe;
      font-size: 0.78rem;
      color: #075985;
    }

    @media (max-width: 768px) {
      body {
        padding: 16px;
      }
      .shell-card {
        padding: 14px 14px 16px;
        border-radius: 22px;
      }
      th, td {
        font-size: 0.8rem;
      }
      .panel-header {
        flex-direction: column;
        align-items: flex-start;
      }
      .situation-box {
        font-size: 0.85rem;
      }
    }
  </style>
</head>
<body>
<div class="app-shell">
  <header>
    <div class="title">
      <span class="title-badge">UE 1.1 ‚Ä¢ Psycho</span>
      <span>Entra√Ænement interactif complet</span>
    </div>
    <p class="subtitle">
      D√©finitions, QCM Vrai/Faux, stades de l‚Äôenfance selon Freud (ordre + √¢ges) et analyse de situations cliniques
      (m√©canismes de d√©fense, empathie, attachement, transfert, etc.).
    </p>
  </header>

  <div class="shell-card">
    <nav class="tab-bar">
      <button class="tab-button active" data-target="tab-defs">
        <span class="emoji">üß©</span>
        D√©finitions √† remettre
      </button>
      <button class="tab-button" data-target="tab-vf">
        <span class="emoji">‚úÖ</span>
        Vrai / Faux
      </button>
      <button class="tab-button" data-target="tab-freud">
        <span class="emoji">üë∂</span>
        Stades de l‚Äôenfance (Freud)
      </button>
      <button class="tab-button" data-target="tab-situations">
        <span class="emoji">ü©∫</span>
        Situations cliniques
      </button>
      <button class="tab-button" data-target="tab-cognitive">
        <span class="emoji">üß†</span>
        Psychologie cognitive
      </button>
      <button class="tab-button" data-target="tab-topiques">
        <span class="emoji">üî∫</span>
        Topiques de Freud
      </button>
      <button class="tab-button" data-target="tab-psychopatho">
        <span class="emoji">üî¨</span>
        Psychopathologie
      </button>
      <button class="tab-button" data-target="tab-sociale">
        <span class="emoji">üë•</span>
        Psychologie sociale
      </button>
      <button class="tab-button" data-target="tab-deuil">
        <span class="emoji">üïäÔ∏è</span>
        √âtapes du deuil
      </button>
      <button class="tab-button" data-target="tab-cas-avances">
        <span class="emoji">üìã</span>
        Cas cliniques avanc√©s
      </button>
    </nav>

    <div class="tab-panels">

      <!-- TAB 1 : DEFINITIONS -->
      <section id="tab-defs" class="tab-panel active">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>1. D√©finitions √† remettre</span>
              <span class="pill neutral">Concept / th√©orie / mod√®le / m√©canismes de d√©fense‚Ä¶</span>
            </div>
            <p class="panel-subtitle">
              Associe chaque concept √† la bonne d√©finition. En cas d‚Äôerreur, ta r√©ponse s‚Äôaffiche en rouge
              et la bonne d√©finition en vert juste en dessous.
            </p>
          </div>
        </div>

        <div class="section-card">
          <table>
            <thead>
            <tr>
              <th>Concept</th>
              <th>D√©finition</th>
              <th>Feedback</th>
            </tr>
            </thead>
            <tbody id="definitions-body">
            <!-- Rempli en JavaScript -->
            </tbody>
          </table>

          <div class="btn-row">
            <button id="check-definitions" class="btn btn-primary">
              <span class="emoji">üîç</span> Corriger
            </button>
            <button id="reset-definitions" class="btn btn-outline">
              <span class="emoji">‚ôªÔ∏è</span> R√©initialiser
            </button>
            <span id="definitions-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-vf')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Vrai / Faux
          </button>
        </div>
      </section>

      <!-- TAB 2 : VRAI FAUX -->
      <section id="tab-vf" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>2. Vrai / Faux cibl√©</span>
              <span class="pill neutral">√âmotion ‚Ä¢ Stress ‚Ä¢ D√©fenses ‚Ä¢ Empathie ‚Ä¢ Attachement‚Ä¶</span>
            </div>
            <p class="panel-subtitle">
              Choisis Vrai ou Faux pour chaque affirmation. Feedback imm√©diat avec une explication courte.
            </p>
          </div>
        </div>

        <div class="section-card">
          <div id="vf-container">
            <!-- Questions V/F g√©n√©r√©es en JS -->
          </div>
          <div class="btn-row">
            <button id="check-vf" class="btn btn-primary">
              <span class="emoji">üß†</span> Corriger tout
            </button>
            <button id="reset-vf" class="btn btn-outline">
              <span class="emoji">üßº</span> Effacer mes r√©ponses
            </button>
            <span id="vf-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-freud')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Stades de l‚Äôenfance
          </button>
        </div>
      </section>

      <!-- TAB 3 : FREUD -->
      <section id="tab-freud" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>3. Stades de l‚Äôenfance selon Freud</span>
              <span class="pill neutral">Travail sur l‚Äôordre + tranches d‚Äô√¢ges</span>
            </div>
            <p class="panel-subtitle">
              <strong>Partie A :</strong> saisis le nom des stades du plus jeune au plus vieux, en les pla√ßant dans la bonne
              position. Tu peux d√©placer les lignes avec les fl√®ches.<br>
              <strong>Partie B :</strong> se d√©bloque uniquement apr√®s avoir valid√© la Partie A : tu associes alors chaque stade
              √† la bonne tranche d‚Äô√¢ge.
            </p>
          </div>
        </div>

        <!-- PARTIE A : ORDONNER LES STADES SANS DONNER LES NOMS -->
        <div class="section-card freud-order-section">
          <div class="panel-subtitle" style="margin-bottom:4px;">
            <strong>Partie A ‚Äì Ordre des stades :</strong> √©cris les stades du <span class="highlight">plus jeune au plus vieux</span>.
          </div>
          <div class="freud-order-info">
            Tu peux utiliser les fl√®ches pour d√©placer les lignes, sans avoir √† tout r√©√©crire.
          </div>

          <ul id="freud-order-list" class="freud-order-list">
            <!-- Rempli en JS -->
          </ul>

          <div class="btn-row">
            <button id="check-freud-order" class="btn btn-primary">
              <span class="emoji">‚úÖ</span> Corriger l‚Äôordre
            </button>
            <button id="reset-freud-order" class="btn btn-outline">
              <span class="emoji">üßΩ</span> Effacer les r√©ponses
            </button>
            <span id="freud-order-stat" class="stat-line"></span>
          </div>

          <div id="freud-order-solution" class="freud-solution"></div>
        </div>

        <!-- PARTIE B : TRANCHES D‚Äô√ÇGES (D√âBLOQU√âE APR√àS VALIDATION PARTIE A) -->
        <p id="freud-ages-locked-text" class="freud-order-info">
          üîí Cette partie se d√©bloque apr√®s avoir valid√© le classement des stades (bouton ¬´ Corriger l‚Äôordre ¬ª).
        </p>

        <div class="section-card" id="freud-ages-section" style="display:none;">
          <div style="font-size:0.85rem; color:var(--text-soft); margin-bottom:6px;">
            <strong>Partie B ‚Äì Tranches d‚Äô√¢ges :</strong> associe chaque stade √† la bonne tranche d‚Äô√¢ge.
            Plusieurs options sont volontairement fausses.
          </div>
          <table>
            <thead>
            <tr>
              <th>Stade</th>
              <th>√Çge (choisis la bonne plage)</th>
              <th>Feedback</th>
            </tr>
            </thead>
            <tbody id="freud-body">
            <!-- Lignes cr√©√©es en JS -->
            </tbody>
          </table>

          <div class="btn-row">
            <button id="check-freud" class="btn btn-primary">
              <span class="emoji">üß™</span> Corriger les √¢ges
            </button>
            <button id="reset-freud" class="btn btn-outline">
              <span class="emoji">üîÅ</span> R√©initialiser
            </button>
            <span id="freud-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-situations')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Situations cliniques
          </button>
        </div>
      </section>

      <!-- TAB 4 : SITUATIONS CLINIQUES -->
      <section id="tab-situations" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>4. Analyse de situations cliniques</span>
              <span class="pill">
                <span>üéØ</span> D√©fenses, stress, √©motions, empathie, transfert‚Ä¶
              </span>
            </div>
            <p class="panel-subtitle">
              G√©n√®re des situations cliniques vari√©es (√¢ge, sexe, contexte m√©dical‚Ä¶) et retrouve le ou les
              concepts cl√©s (d√©ni, refoulement, √©vitement, sublimation, transfert, contre-transfert, etc.).
            </p>
          </div>
        </div>

        <div class="section-card">
          <div class="btn-row">
            <button id="new-situation" class="btn btn-primary">
              <span class="emoji">üé≤</span> G√©n√©rer une situation
            </button>
            <span class="badge-count" id="situation-counter">Situations vues : 0</span>
          </div>

          <div class="situation-box" id="situation-text">
            Clique sur ¬´ G√©n√©rer une situation ¬ª pour commencer.
          </div>

          <div style="margin-top: 10px;">
            <label for="situation-answer" style="font-size:0.85rem; color:var(--text-soft);">
              Tes r√©ponses (un ou plusieurs concepts, s√©par√©s par des virgules) :
            </label>
            <input type="text" id="situation-answer" placeholder="Ex. : d√©ni, √©vitement, stress">
          </div>

          <div class="btn-row">
            <button id="check-situation" class="btn btn-soft">
              <span class="emoji">‚úîÔ∏è</span> V√©rifier
            </button>
            <button id="show-solution" class="btn btn-outline">
              <span class="emoji">üí°</span> Voir les concepts attendus
            </button>
          </div>

          <div id="situation-feedback" class="situation-feedback">
            <!-- Feedback dynamique -->
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-defs')">
            <span class="emoji">üîÅ</span> Revenir √† l‚Äôexercice 1
          </button>
        </div>
      </section>

      <!-- TAB 5 : PSYCHOLOGIE COGNITIVE -->
      <section id="tab-cognitive" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>5. Psychologie cognitive</span>
              <span class="pill neutral">Traitement de l'information ‚Ä¢ M√©moire ‚Ä¢ Attention</span>
            </div>
            <p class="panel-subtitle">
              Teste tes connaissances sur les processus cognitifs : les 7 √©tapes du traitement de l'information, les types de m√©moire, etc.
            </p>
          </div>
        </div>

        <div class="section-card">
          <table>
            <thead>
            <tr>
              <th>Question</th>
              <th>R√©ponse</th>
              <th>Feedback</th>
            </tr>
            </thead>
            <tbody id="cognitive-body">
            <!-- Rempli en JavaScript -->
            </tbody>
          </table>

          <div class="btn-row">
            <button id="check-cognitive" class="btn btn-primary">
              <span class="emoji">üîç</span> Corriger
            </button>
            <button id="reset-cognitive" class="btn btn-outline">
              <span class="emoji">‚ôªÔ∏è</span> R√©initialiser
            </button>
            <span id="cognitive-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-topiques')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Topiques de Freud
          </button>
        </div>
      </section>

      <!-- TAB 6 : TOPIQUES DE FREUD -->
      <section id="tab-topiques" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>6. Les topiques de Freud</span>
              <span class="pill neutral">Structure de l'appareil psychique</span>
            </div>
            <p class="panel-subtitle">
              Identifie comment Freud nomme ses divisions de l'appareil psychique, puis compl√®te les diff√©rents niveaux ou instances.
            </p>
          </div>
        </div>

        <!-- Question introductive -->
        <div class="section-card">
          <div style="font-size:0.9rem; margin-bottom:10px;">
            <strong>Question pr√©liminaire :</strong> Comment Freud nomme-t-il les diff√©rentes divisions de l'appareil psychique ?
            <input type="text" id="topique-mot" placeholder="√âcrire ici..." style="width:180px; display:inline-block; margin-left:8px;">
          </div>
          <div id="topique-intro-feedback" class="stat-line"></div>
        </div>

        <!-- 1√®re topique -->
        <div class="section-card">
          <div style="font-size:0.85rem; color:var(--text-soft); margin-bottom:8px;">
            <strong>1√®re <span id="label-topique-1">______</span> :</strong> Compl√®te les 3 niveaux (dans n'importe quel ordre).
          </div>
          
          <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:10px;">
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Niveau 1 :</label>
              <input type="text" class="topique-1ere" placeholder="√âcrire ici..." style="width:100%;">
            </div>
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Niveau 2 :</label>
              <input type="text" class="topique-1ere" placeholder="√âcrire ici..." style="width:100%;">
            </div>
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Niveau 3 :</label>
              <input type="text" class="topique-1ere" placeholder="√âcrire ici..." style="width:100%;">
            </div>
          </div>
          <div id="topique-1ere-feedback" class="stat-line" style="margin-top:8px;"></div>
        </div>

        <!-- 2√®me topique -->
        <div class="section-card">
          <div style="font-size:0.85rem; color:var(--text-soft); margin-bottom:8px;">
            <strong>2√®me <span id="label-topique-2">______</span> :</strong> Compl√®te les 3 instances (dans n'importe quel ordre).
          </div>
          
          <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:10px;">
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Instance 1 :</label>
              <input type="text" class="topique-2eme" placeholder="√âcrire ici..." style="width:100%;">
            </div>
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Instance 2 :</label>
              <input type="text" class="topique-2eme" placeholder="√âcrire ici..." style="width:100%;">
            </div>
            <div style="flex:1; min-width:150px;">
              <label style="font-size:0.8rem; color:var(--text-soft);">Instance 3 :</label>
              <input type="text" class="topique-2eme" placeholder="√âcrire ici..." style="width:100%;">
            </div>
          </div>
          <div id="topique-2eme-feedback" class="stat-line" style="margin-top:8px;"></div>
        </div>

        <div class="btn-row">
          <button id="check-topiques" class="btn btn-primary">
            <span class="emoji">üîç</span> Corriger tout
          </button>
          <button id="reset-topiques" class="btn btn-outline">
            <span class="emoji">‚ôªÔ∏è</span> R√©initialiser
          </button>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-psychopatho')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Psychopathologie
          </button>
        </div>
      </section>

      <!-- TAB 7 : PSYCHOPATHOLOGIE -->
      <section id="tab-psychopatho" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>7. Mod√®les psychopathologiques</span>
              <span class="pill neutral">Psychanalytique ‚Ä¢ Cognitif ‚Ä¢ Syst√©mique</span>
            </div>
            <p class="panel-subtitle">
              Identifie les caract√©ristiques de chaque mod√®le : psychanalytique, cognitif et syst√©mique.
            </p>
          </div>
        </div>

        <div class="section-card">
          <table>
            <thead>
            <tr>
              <th>Affirmation</th>
              <th>Mod√®le</th>
              <th>Feedback</th>
            </tr>
            </thead>
            <tbody id="psychopatho-body">
            <!-- Rempli en JavaScript -->
            </tbody>
          </table>

          <div class="btn-row">
            <button id="check-psychopatho" class="btn btn-primary">
              <span class="emoji">üîç</span> Corriger
            </button>
            <button id="reset-psychopatho" class="btn btn-outline">
              <span class="emoji">‚ôªÔ∏è</span> R√©initialiser
            </button>
            <span id="psychopatho-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-sociale')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Psychologie sociale
          </button>
        </div>
      </section>

      <!-- TAB 8 : PSYCHOLOGIE SOCIALE -->
      <section id="tab-sociale" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>8. Psychologie sociale</span>
              <span class="pill neutral">Socialisation ‚Ä¢ Normalisation ‚Ä¢ Diff√©renciation</span>
            </div>
            <p class="panel-subtitle">
              Explore les concepts cl√©s de la psychologie sociale et leur application dans les interactions humaines.
            </p>
          </div>
        </div>

        <div class="section-card">
          <div id="sociale-container">
            <!-- Questions g√©n√©r√©es en JS -->
          </div>
          <div class="btn-row">
            <button id="check-sociale" class="btn btn-primary">
              <span class="emoji">üß†</span> Corriger tout
            </button>
            <button id="reset-sociale" class="btn btn-outline">
              <span class="emoji">üßº</span> Effacer mes r√©ponses
            </button>
            <span id="sociale-stat" class="stat-line"></span>
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-deuil')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : √âtapes du deuil
          </button>
        </div>
      </section>

      <!-- TAB 9 : √âTAPES DU DEUIL -->
      <section id="tab-deuil" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>9. Les √©tapes du deuil</span>
              <span class="pill neutral">K√ºbler-Ross</span>
            </div>
            <p class="panel-subtitle">
              Ordonne les 5 √©tapes du processus de deuil selon le mod√®le de K√ºbler-Ross.
            </p>
          </div>
        </div>

        <div class="section-card">
          <div class="panel-subtitle" style="margin-bottom:4px;">
            <strong>Ordre des √©tapes :</strong> place les √©tapes dans le bon ordre chronologique.
          </div>
          <div class="freud-order-info">
            Utilise les fl√®ches pour d√©placer les lignes.
          </div>

          <ul id="deuil-order-list" class="freud-order-list">
            <!-- Rempli en JS -->
          </ul>

          <div class="btn-row">
            <button id="check-deuil-order" class="btn btn-primary">
              <span class="emoji">‚úÖ</span> Corriger l'ordre
            </button>
            <button id="reset-deuil-order" class="btn btn-outline">
              <span class="emoji">üßΩ</span> Effacer les r√©ponses
            </button>
            <span id="deuil-order-stat" class="stat-line"></span>
          </div>

          <div id="deuil-order-solution" class="freud-solution"></div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-cas-avances')">
            <span class="emoji">‚û°Ô∏è</span> Exercice suivant : Cas cliniques avanc√©s
          </button>
        </div>
      </section>

      <!-- TAB 10 : CAS CLINIQUES AVANC√âS -->
      <section id="tab-cas-avances" class="tab-panel">
        <div class="panel-header">
          <div>
            <div class="panel-title">
              <span>10. Cas cliniques avanc√©s</span>
              <span class="pill">
                <span>üéØ</span> Tous les concepts UE 1.1
              </span>
            </div>
            <p class="panel-subtitle">
              Des situations complexes int√©grant plusieurs concepts : cognition, topiques, deuil, mod√®les psychopathologiques, etc.
            </p>
          </div>
        </div>

        <div class="section-card">
          <div class="btn-row">
            <button id="new-cas-avance" class="btn btn-primary">
              <span class="emoji">üé≤</span> G√©n√©rer un cas
            </button>
            <span class="badge-count" id="cas-avance-counter">Cas vus : 0</span>
          </div>

          <div class="situation-box" id="cas-avance-text">
            Clique sur ¬´ G√©n√©rer un cas ¬ª pour commencer.
          </div>

          <div style="margin-top: 10px;">
            <label for="cas-avance-answer" style="font-size:0.85rem; color:var(--text-soft);">
              Tes r√©ponses (concepts s√©par√©s par des virgules) :
            </label>
            <input type="text" id="cas-avance-answer" placeholder="Ex. : d√©ni, m√©moire √©pisodique, deuil">
          </div>

          <div class="btn-row">
            <button id="check-cas-avance" class="btn btn-soft">
              <span class="emoji">‚úîÔ∏è</span> V√©rifier
            </button>
            <button id="show-cas-avance-solution" class="btn btn-outline">
              <span class="emoji">üí°</span> Voir les concepts attendus
            </button>
          </div>

          <div id="cas-avance-feedback" class="situation-feedback">
            <!-- Feedback dynamique -->
          </div>
        </div>

        <div class="btn-row">
          <button class="btn btn-soft btn-next" onclick="goToTab('tab-defs')">
            <span class="emoji">üîÅ</span> Revenir √† l'exercice 1
          </button>
        </div>
      </section>

    </div>
  </div>
</div>

<script>
  // ---------- UTILITAIRES ----------
  function shuffleArray(arr) {
    const a = arr.slice();
    for (let i = a.length - 1; i > 0; i--) {
      const j = Math.floor(Math.random() * (i + 1));
      [a[i], a[j]] = [a[j], a[i]];
    }
    return a;
  }

  function normalizeWord(str) {
    return str
      .toLowerCase()
      .normalize("NFD")
      .replace(/[\u0300-\u036f]/g, "")
      .trim();
  }

  function goToTab(tabId) {
    const btn = document.querySelector('.tab-button[data-target="' + tabId + '"]');
    if (btn) btn.click();
  }

  // ---------- DONN√âES : D√âFINITIONS ----------
  const definitionItems = [
    {
      id: "concept",
      term: "Concept",
      definition: "Repr√©sentation mentale abstraite et g√©n√©rale, relativement stable, utilis√©e pour penser et organiser une r√©alit√©."
    },
    {
      id: "theorie",
      term: "Th√©orie",
      definition: "Construction explicative qui relie plusieurs concepts entre eux pour rendre compte d‚Äôun domaine particulier."
    },
    {
      id: "modele",
      term: "Mod√®le",
      definition: "Repr√©sentation simplifi√©e d‚Äôune th√©orie, souvent sch√©matique ou imag√©e, qui la rend plus concr√®te et utilisable."
    },
    {
      id: "emotion",
      term: "√âmotion",
      definition: "Modification br√®ve de l‚Äô√©tat affectif se traduisant par des changements corporels, mentaux et comportementaux."
    },
    {
      id: "mecanisme",
      term: "M√©canisme de d√©fense",
      definition: "Processus psychique inconscient et automatique par lequel le Moi g√®re des tensions internes ou externes."
    },
    {
      id: "stress",
      term: "Stress",
      definition: "√âtat de tension face √† une menace r√©elle ou per√ßue, qui rompt l‚Äô√©quilibre et n√©cessite un effort d‚Äôadaptation."
    },
    {
      id: "empathie",
      term: "Empathie",
      definition: "Capacit√© √† percevoir et comprendre le v√©cu de l‚Äôautre tout en restant √† sa place."
    },
    {
      id: "attachement",
      term: "Attachement",
      definition: "Lien affectif durable servant de base de s√©curit√© dans les relations, surtout chez l‚Äôenfant."
    },
    {
      id: "refoulement",
      term: "Refoulement",
      definition: "M√©canisme de d√©fense qui maintient hors de la conscience des pens√©es ou d√©sirs jug√©s inacceptables."
    },
    {
      id: "deni",
      term: "D√©ni",
      definition: "Refus de reconna√Ætre une r√©alit√© pourtant √©vidente ou mena√ßante."
    },
    {
      id: "rationalisation",
      term: "Rationalisation",
      definition: "M√©canisme de d√©fense qui remplace l‚Äôaffect par des explications logiques pour rendre la situation plus acceptable."
    },
    {
      id: "evitement",
      term: "√âvitement",
      definition: "Strat√©gie consciente ou non consistant √† fuir une situation, un lieu ou un sujet v√©cu comme mena√ßant."
    },
    {
      id: "sublimation",
      term: "Sublimation",
      definition: "Transformation de pulsions jug√©es inacceptables en activit√©s socialement valoris√©es (sport, art, travail‚Ä¶)."
    },
    {
      id: "transfert",
      term: "Transfert",
      definition: "D√©placement, sur le soignant, de sentiments et attentes issus de relations ant√©rieures."
    },
    {
      id: "contretransfert",
      term: "Contre-transfert",
      definition: "R√©actions affectives du soignant face au patient, en √©cho au transfert, pouvant √™tre conscientes ou non."
    }
  ];

  // ---------- DONN√âES : VRAI/FAUX ----------
  const vfQuestions = [
    {
      id: "vf1",
      text: "Une th√©orie est plus g√©n√©rale qu‚Äôun concept et relie plusieurs concepts entre eux.",
      answer: true,
      explanation: "Une th√©orie organise un ensemble de concepts pour expliquer un domaine."
    },
    {
      id: "vf2",
      text: "Les m√©canismes de d√©fense sont toujours conscients et volontaires.",
      answer: false,
      explanation: "Au contraire, ils sont inconscients et automatiques."
    },
    {
      id: "vf3",
      text: "Le stress ne concerne que la dimension psychologique et jamais le corps.",
      answer: false,
      explanation: "Il a une dimension psychologique et une dimension physiologique."
    },
    {
      id: "vf4",
      text: "L‚Äôempathie suppose de ressentir exactement la m√™me chose que le patient, comme si on devenait lui.",
      answer: false,
      explanation: "On per√ßoit et comprend le v√©cu de l‚Äôautre, mais on reste distinct de lui."
    },
    {
      id: "vf5",
      text: "Dans le d√©ni, le sujet refuse une r√©alit√© mena√ßante.",
      answer: true,
      explanation: "Le d√©ni est un refus de percevoir ou reconna√Ætre une r√©alit√© douloureuse."
    },
    {
      id: "vf6",
      text: "Les √©motions de base comme la peur ou la joie sont br√®ves et universelles.",
      answer: true,
      explanation: "Elles sont de courte dur√©e et partag√©es dans toutes les cultures."
    },
    {
      id: "vf7",
      text: "L‚Äôattachement s√©curisant fournit une base de s√©curit√© pour explorer le monde.",
      answer: true,
      explanation: "L‚Äôenfant peut s‚Äô√©loigner en sachant qu‚Äôil peut revenir vers la figure d‚Äôattachement."
    },
    {
      id: "vf8",
      text: "La sublimation consiste √† transformer des pulsions en activit√©s socialement valoris√©es.",
      answer: true,
      explanation: "C‚Äôest une d√©fense mature qui canalise l‚Äô√©nergie pulsionnelle."
    },
    {
      id: "vf9",
      text: "Le transfert concerne uniquement les soignants, jamais les patients.",
      answer: false,
      explanation: "Le transfert concerne d‚Äôabord le patient, qui rejoue sur le soignant d‚Äôanciennes relations."
    },
    {
      id: "vf10",
      text: "Le m√©canisme de d√©fense d‚Äô√©vitement peut se manifester par le fait d‚Äô√©viter un service ou un sujet de conversation.",
      answer: true,
      explanation: "C‚Äôest une mise √† distance d‚Äôune situation ou d‚Äôun affect mena√ßant."
    }
  ];

  // ---------- DONN√âES : FREUD ----------
  const freudStages = [
    { id: "oral", name: "Oral", expected: "0-1" },
    { id: "anal", name: "Anal", expected: "1-3" },
    { id: "phal", name: "Phallique", expected: "3-6" },
    { id: "lat", name: "P√©riode de latence", expected: "6-11" },
    { id: "gen", name: "G√©nital", expected: "puberte-plus" }
  ];

  const freudExpectedOrder = ["oral", "anal", "phal", "lat", "gen"];

  // √Çges : 5 bons + 5 mauvais (distracteurs)
  const freudAges = [
    { id: "0-1", label: "De la naissance √† 1 an (‚âà 0‚Äì1 an)" },
    { id: "1-3", label: "D‚Äôenviron 1 √† 3 ans" },
    { id: "3-6", label: "D‚Äôenviron 3 √† 6 ans" },
    { id: "6-11", label: "D‚Äôenviron 6 √† 11 / 12 ans" },
    { id: "puberte-plus", label: "De la pubert√© √† l‚Äô√¢ge adulte" },
    // distracteurs
    { id: "0-0.5", label: "0 √† 6 mois uniquement" },
    { id: "2-5", label: "De 2 √† 5 ans" },
    { id: "4-8", label: "De 4 √† 8 ans" },
    { id: "10-15", label: "De 10 √† 15 ans" },
    { id: "adulte-mur", label: "√Çge adulte m√ªr uniquement" }
  ];

  // ---------- DONN√âES : SITUATIONS CLINIQUES ----------
  const situations = [
    {
      id: 1,
      text: "Homme de 55 ans, venu pour un scanner thoracique apr√®s la d√©couverte d‚Äôune masse suspecte sur une radio. Il r√©p√®te que ¬´ ce n‚Äôest s√ªrement qu‚Äôune erreur de laboratoire ¬ª et refuse d‚Äô√©couter les explications du m√©decin, en √©voquant plut√¥t un vieux rhume mal soign√©.",
      concepts: ["d√©ni"]
    },
    {
      id: 2,
      text: "√âtudiante EMEM de 20 ans, tr√®s en col√®re apr√®s une remarque humiliante d‚Äôun m√©decin s√©nior. Le soir m√™me, elle s‚Äôinscrit √† un club de boxe et augmente fortement ses s√©ances de sport, expliquant qu‚Äôelle doit ¬´ vider son √©nergie ¬ª.",
      concepts: ["sublimation"]
    },
    {
      id: 3,
      text: "Interne de 26 ans en imagerie d‚Äôurgence avant une garde de nuit. En arrivant dans le service, il sent son c≈ìur battre vite, ses mains sont l√©g√®rement tremblantes, il a du mal √† se concentrer et craint de ne pas suivre le rythme des demandes d‚Äôexamens.",
      concepts: ["stress"]
    },
    {
      id: 4,
      text: "Femme de 48 ans en suivi pour un cancer du sein m√©tastatique, venue pour un contr√¥le scanner. D√®s que la maladie est √©voqu√©e, elle coupe la conversation, parle de la m√©t√©o ou de la d√©coration de la salle, et se montre joviale comme si tout allait bien.",
      concepts: ["d√©ni", "√©vitement"]
    },
    {
      id: 5,
      text: "Homme de 40 ans hospitalis√© pour complications d‚Äôalcoolisation chronique. En salle de radio, il t‚Äôaccuse d‚Äô√™tre ¬´ froid et autoritaire ¬ª, alors que c‚Äôest lui qui hausse la voix, interrompt sans cesse et impose le rythme de l‚Äô√©change.",
      concepts: ["projection"]
    },
    {
      id: 6,
      text: "Adolescent de 15 ans, op√©r√© du genou apr√®s un accident de sport. Les examens somatiques sont rassurants, mais il se plaint tr√®s souvent de maux de ventre et de t√™te. L‚Äô√©quipe sait qu‚Äôil vit de fortes tensions √† la maison (conflit parental, s√©paration).",
      concepts: ["somatisation"]
    },
    {
      id: 7,
      text: "Gar√ßon de 3 ans en radio p√©diatrique pour v√©rifier une suspicion de pneumonie. Il se cramponne √† son p√®re, pleure d√®s qu‚Äôil sort de son champ de vision et ne regarde la salle qu‚Äôune fois que son p√®re est revenu s‚Äôasseoir √† c√¥t√©.",
      concepts: ["attachement"]
    },
    {
      id: 8,
      text: "Femme de 82 ans venue pour un contr√¥le d‚Äôost√©oporose. En te voyant, elle t‚Äôappelle plusieurs fois ¬´ mon petit-fils ¬ª et commence √† raconter des souvenirs de son propre petit-fils en fin d‚Äô√©tudes, en te parlant comme si tu √©tais lui.",
      concepts: ["transfert"]
    },
    {
      id: 9,
      text: "Tu accompagnes un homme de 45 ans alcoolo-d√©pendant pour une imagerie abdominale. Il te rappelle un proche avec qui tu as une histoire compliqu√©e. Pendant l‚Äôexamen, tu te montres inhabituellement sec, impatient, avec peu de tol√©rance pour ses h√©sitations.",
      concepts: ["contre-transfert"]
    },
    {
      id: 10,
      text: "√âtudiante EMEM de 21 ans qui a subi r√©cemment une humiliation publique en staff. Elle a eu des pens√©es tr√®s violentes envers un sup√©rieur, mais dit maintenant qu‚Äôelle ne pense ¬´ plus du tout √† cette histoire ¬ª et ne souhaite pas en parler, comme si l‚Äô√©v√©nement avait disparu.",
      concepts: ["refoulement"]
    },
    {
      id: 11,
      text: "Homme de 60 ans, claustrophobe, programm√© pour une IRM c√©r√©brale. D√®s qu‚Äôil entre dans la salle, il encha√Æne les blagues sur la machine, sur lui-m√™me et sur l‚Äô√©quipe, commente les moindres d√©tails avec un humour tr√®s pr√©sent, alors que son corps reste tendu.",
      concepts: ["humour", "m√©canisme de d√©fense"]
    },
    {
      id: 12,
      text: "Femme de 52 ans en surpoids important, venue pour une √©chographie abdominale. Elle explique que ¬´ de toute fa√ßon, tout le monde finit malade un jour ¬ª et que certains ont ¬´ une constitution faite pour supporter plus de kilos ¬ª, minimisant les recommandations m√©dicales.",
      concepts: ["rationalisation"]
    },
    {
      id: 13,
      text: "Jeune femme de 24 ans, suivie pour une maladie chronique, qui ne vient jamais seule √† ses examens d‚Äôimagerie. Elle insiste pour que sa m√®re reste dans la salle d‚Äôattente et r√©p√®te qu‚Äôelle ¬´ ne pourrait jamais g√©rer tout √ßa toute seule ¬ª. Elle semble apais√©e seulement quand elle voit sa m√®re.",
      concepts: ["attachement"]
    },
    {
      id: 14,
      text: "√âtudiant EMEM de 22 ans ayant v√©cu un incident marquant lors d‚Äôun examen scanner. Depuis, il √©vite syst√©matiquement de se porter volontaire pour ce type d‚Äôexamen, propose toujours d‚Äôaller dans un autre secteur et trouve des justifications pour ¬´ aider ailleurs ¬ª.",
      concepts: ["√©vitement"]
    },
    {
      id: 15,
      text: "Homme de 58 ans diab√©tique qui ne suit pas correctement son traitement. Lorsque les r√©sultats sont mauvais, il reproche aux soignants de ne pas ¬´ bien faire leur travail ¬ª et refuse de reconna√Ætre qu‚Äôil ne prend pas ses m√©dicaments comme pr√©vu.",
      concepts: ["projection", "d√©ni"]
    },
    {
      id: 16,
      text: "Femme de 67 ans, en fin de vie, arrives en IRM pour un bilan de douleurs. Tu per√ßois fortement sa d√©tresse. Tu restes physiquement pr√©sent pr√®s d‚Äôelle, reformules ce qu‚Äôelle exprime, adaptes le rythme de l‚Äôinstallation √† ce qu‚Äôelle supporte, sans t‚Äôeffondrer avec elle.",
      concepts: ["empathie"]
    },
    {
      id: 17,
      text: "Homme de 35 ans victime d‚Äôun accident de la route, examin√© en radio. Il r√©p√®te qu‚Äôil conduisait ¬´ parfaitement bien ¬ª et que ¬´ la route √©tait mal faite ¬ª, alors qu‚Äôil roulait tr√®s vite et avait consomm√© de l‚Äôalcool selon le dossier.",
      concepts: ["rationalisation"]
    },
    {
      id: 18,
      text: "√âtudiante EMEM de 19 ans qui supporte mal la vue du sang et des plaies. Lors des r√©partitions en stage, elle choisit syst√©matiquement les postes en console ou √† distance et √©vite les salles o√π elle serait au contact direct des patients bless√©s.",
      concepts: ["√©vitement"]
    },
    {
      id: 19,
      text: "Soignante de 32 ans travaillant en imagerie d‚Äôurgence. Apr√®s un conflit tr√®s violent dans le service, elle d√©veloppe brutalement des douleurs musculaires diffuses, une grande fatigue et des maux de t√™te, sans explication m√©dicale claire √† l‚Äôexamen.",
      concepts: ["somatisation", "stress"]
    },
    {
      id: 20,
      text: "Homme de 70 ans venu pour une IRM lombaire, qui raconte combien son ancien m√©decin de famille ¬´ s‚Äôoccupait de tout pour lui ¬ª. Il t‚Äôadresse les m√™mes attentes, te demande de ¬´ g√©rer tout le reste ¬ª et semble te confondre avec cette figure du pass√©.",
      concepts: ["transfert"]
    },
    {
      id: 21,
      text: "Femme de 59 ans atteinte d‚Äôun cancer avanc√©, en scanner de contr√¥le. Elle pose surtout des questions tr√®s techniques sur la machine et les param√®tres d‚Äôexposition, s‚Äôint√©resse aux chiffres, mais √©vite compl√®tement de parler de son v√©cu √©motionnel et de son pronostic.",
      concepts: ["rationalisation", "√©vitement"]
    },
    {
      id: 22,
      text: "√âtudiante EMEM de 23 ans tr√®s anxieuse √† l‚Äôid√©e de commettre une erreur en stage. Elle apprend l‚Äôanatomie de fa√ßon extr√™mement d√©taill√©e, r√©p√®te plusieurs fois les proc√©dures et se rassure en r√©citant chaque √©tape avant d‚Äôentrer en salle.",
      concepts: ["stress", "coping"]
    },
    {
      id: 23,
      text: "√âtudiant de 25 ans ayant perdu r√©cemment un proche. Pendant sa p√©riode de deuil, il s‚Äôinvestit fortement dans une association de soutien aux endeuill√©s, consacre ses temps libres √† l‚Äôaccompagnement de familles et √† l‚Äôorganisation d‚Äôactions de sensibilisation.",
      concepts: ["sublimation"]
    },
    {
      id: 24,
      text: "Patient de 62 ans, diab√©tique, qui ne suit pas son r√©gime. Il r√©p√®te qu‚Äôil conna√Æt ¬´ quelqu‚Äôun qui mange bien pire et qui n‚Äôa jamais rien eu ¬ª et qu‚Äôil doit √™tre ¬´ plus r√©sistant que la moyenne ¬ª, minimisant l‚Äôimpact de son comportement.",
      concepts: ["rationalisation", "d√©ni"]
    },
    {
      id: 25,
      text: "√âtudiante EMEM de 20 ans qui doit pr√©senter un expos√© devant la promotion. Elle rougit, a la gorge serr√©e et les mains moites, mais poursuit sa pr√©sentation jusqu‚Äôau bout en gardant un discours coh√©rent.",
      concepts: ["√©motion", "stress"]
    },
    {
      id: 26,
      text: "Patiente de 45 ans, hospitalis√©e pour une pathologie chronique, qui se montre d‚Äôembl√©e froide et distante avec toi en salle de radio. Plus tard, elle explique que les soignants l‚Äôont souvent d√©√ßue et qu‚Äôelle ne peut faire confiance √† personne.",
      concepts: ["transfert", "√©vitement"]
    },
    {
      id: 27,
      text: "Lors d‚Äôun examen scanner, tu t‚Äôoccupes d‚Äôune femme de 79 ans tr√®s douce, qui te rappelle ta propre grand-m√®re. Tu te rends compte que tu lui consacres spontan√©ment plus de temps, plus d‚Äôattention et que tu as du mal √† garder la m√™me distance professionnelle que d‚Äôhabitude.",
      concepts: ["contre-transfert"]
    },
    {
      id: 28,
      text: "Homme de 63 ans venant d‚Äôapprendre un diagnostic grave. Pendant l‚Äôexamen, il parle longuement de son jardin, du sport et de voyages pass√©s. √Ä chaque fois qu‚Äôune allusion √† la maladie appara√Æt, il change de sujet sans s‚Äôy attarder.",
      concepts: ["d√©ni", "√©vitement"]
    },
    {
      id: 29,
      text: "Jeune sportif de 19 ans bless√© au genou, contraint d‚Äôarr√™ter la comp√©tition pendant plusieurs mois. Il utilise sa convalescence pour coacher ses co√©quipiers, organiser des s√©ances de pr√©vention des blessures et cr√©er du contenu en ligne sur l‚Äôentra√Ænement s√©curis√©.",
      concepts: ["sublimation"]
    },
    {
      id: 30,
      text: "Femme de 50 ans, tr√®s anxieuse √† l‚Äôid√©e de passer un scanner abdominal. Elle te demande √† plusieurs reprises si les r√©glages sont corrects, imagine les pires sc√©narios possibles, s‚Äôinqui√®te du moindre bruit de la machine et a du mal √† se calmer malgr√© des explications rassurantes.",
      concepts: ["anxi√©t√©", "stress"]
    },
    {
      id: 31,
      text: "√âtudiant EMEM de 21 ans ayant commis une petite erreur rapidement corrig√©e en stage. Plusieurs jours apr√®s, il y repense encore, rejoue mentalement la sc√®ne, se d√©valorise et craint de ¬´ tout rater ¬ª aux prochains stages.",
      concepts: ["stress", "√©motion"]
    },
    {
      id: 32,
      text: "En radio d‚Äôurgence, un homme de 38 ans, victime d‚Äôun accident de travail, doit attendre une vingtaine de minutes avant son examen. Il se met en col√®re contre toi pour ce l√©ger retard, te reproche violemment un manque de respect alors que l‚Äôorganisation d√©pend d‚Äôun autre service.",
      concepts: ["d√©placement", "m√©canisme de d√©fense"]
    }
  ];

  // ---------- DONN√âES : PSYCHOLOGIE COGNITIVE ----------
  const cognitiveQuestions = [
    {
      id: 1,
      question: "Combien d'√©tapes compte le mod√®le du traitement de l'information d'Atkinson & Shiffrin ?",
      options: ["5 √©tapes", "7 √©tapes", "9 √©tapes", "10 √©tapes"],
      correct: "7 √©tapes"
    },
    {
      id: 2,
      question: "Quelle est la premi√®re √©tape du traitement de l'information ?",
      options: ["Attention", "Perception", "M√©morisation", "Cat√©gorisation"],
      correct: "Perception"
    },
    {
      id: 3,
      question: "Quel est le nombre moyen d'√©l√©ments que peut contenir la m√©moire √† court terme (MCT) ?",
      options: ["3 ¬± 2", "5 ¬± 2", "7 ¬± 2", "9 ¬± 2"],
      correct: "7 ¬± 2"
    },
    {
      id: 4,
      question: "Quel type de m√©moire √† long terme (MLT) stocke les connaissances g√©n√©rales sur le monde ?",
      options: ["M√©moire perceptive", "M√©moire s√©mantique", "M√©moire √©pisodique", "M√©moire proc√©durale"],
      correct: "M√©moire s√©mantique"
    },
    {
      id: 5,
      question: "Quel type de m√©moire √† long terme (MLT) stocke les souvenirs personnels dat√©s ?",
      options: ["M√©moire perceptive", "M√©moire s√©mantique", "M√©moire √©pisodique", "M√©moire proc√©durale"],
      correct: "M√©moire √©pisodique"
    },
    {
      id: 6,
      question: "Quel type de m√©moire √† long terme (MLT) stocke les savoir-faire automatis√©s ?",
      options: ["M√©moire perceptive", "M√©moire s√©mantique", "M√©moire √©pisodique", "M√©moire proc√©durale"],
      correct: "M√©moire proc√©durale"
    },
    {
      id: 7,
      question: "Quels sont les 3 processus essentiels de la m√©moire ?",
      options: ["Encodage, stockage, r√©cup√©ration", "Perception, attention, m√©morisation", "R√©flexion, action, √©valuation", "Observation, analyse, synth√®se"],
      correct: "Encodage, stockage, r√©cup√©ration"
    },
    {
      id: 8,
      question: "Quel processus cognitif permet d'organiser l'information en cat√©gories mentales ?",
      options: ["Perception", "Attention", "Cat√©gorisation", "Communication"],
      correct: "Cat√©gorisation"
    }
  ];

  // ---------- DONN√âES : TOPIQUES DE FREUD ----------
  // La structure a chang√© - plus de donn√©es n√©cessaires ici car tout est g√©r√© dans initTopiques()

  // ---------- DONN√âES : PSYCHOPATHOLOGIE ----------
  const psychopathoQuestions = [
    {
      id: 1,
      statement: "Explore les premi√®res ann√©es de vie et l'impact des relations pr√©coces sur le d√©veloppement",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le psychanalytique"
    },
    {
      id: 2,
      statement: "S'int√©resse aux distorsions dans le traitement de l'information et aux croyances irrationnelles",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le cognitif"
    },
    {
      id: 3,
      statement: "Consid√®re que le probl√®me n'est pas dans l'individu mais dans les interactions entre les membres",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le syst√©mique"
    },
    {
      id: 4,
      statement: "Utilise l'interpr√©tation des r√™ves et des lapsus comme moyens d'acc√®s aux contenus refoul√©s",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le psychanalytique"
    },
    {
      id: 5,
      statement: "Cherche √† identifier les patterns de communication dysfonctionnels au sein du groupe",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le syst√©mique"
    },
    {
      id: 6,
      statement: "Propose des techniques de restructuration pour remplacer les pens√©es n√©gatives par des pens√©es plus adapt√©es",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le cognitif"
    },
    {
      id: 7,
      statement: "Consid√®re que les sympt√¥mes actuels trouvent leur origine dans des conflits de l'enfance non r√©solus",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le psychanalytique"
    },
    {
      id: 8,
      statement: "Travaille principalement sur les pens√©es pr√©sentes et leur impact sur les √©motions et comportements actuels",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le cognitif"
    },
    {
      id: 9,
      statement: "Analyse comment un sympt√¥me peut jouer un r√¥le dans l'√©quilibre relationnel d'un groupe",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le syst√©mique"
    },
    {
      id: 10,
      statement: "Met l'accent sur la relation th√©rapeutique et les ph√©nom√®nes de r√©p√©tition des sch√©mas relationnels pass√©s",
      options: ["Mod√®le psychanalytique", "Mod√®le cognitif", "Mod√®le syst√©mique"],
      correct: "Mod√®le psychanalytique"
    }
  ];

  // ---------- DONN√âES : PSYCHOLOGIE SOCIALE ----------
  const socialeQuestions = [
    {
      id: 1,
      question: "La socialisation est le processus par lequel l'individu int√®gre les normes et valeurs de son groupe social.",
      correct: true,
      explanation: "La socialisation permet l'int√©gration des normes, valeurs et r√¥les sociaux."
    },
    {
      id: 2,
      question: "La normalisation d√©signe l'influence d'une majorit√© sur un individu pour qu'il se conforme aux attentes du groupe.",
      correct: true,
      explanation: "La normalisation est un processus de conformit√© aux normes du groupe."
    },
    {
      id: 3,
      question: "La diff√©renciation sociale consiste √† effacer toutes les diff√©rences entre les individus d'un groupe.",
      correct: false,
      explanation: "La diff√©renciation sociale consiste au contraire √† affirmer son identit√© propre et sa sp√©cificit√© au sein du groupe."
    },
    {
      id: 4,
      question: "La socialisation primaire se d√©roule principalement durant l'enfance au sein de la famille.",
      correct: true,
      explanation: "La socialisation primaire, fondamentale, a lieu dans l'enfance, notamment via la famille."
    },
    {
      id: 5,
      question: "La socialisation secondaire ne se produit qu'√† l'√¢ge adulte.",
      correct: false,
      explanation: "La socialisation secondaire d√©bute d√®s l'adolescence (√©cole, pairs, travail, etc.)."
    },
    {
      id: 6,
      question: "Les st√©r√©otypes sont des g√©n√©ralisations simplifi√©es sur un groupe social.",
      correct: true,
      explanation: "Les st√©r√©otypes sont des repr√©sentations fig√©es et simplifi√©es d'un groupe."
    },
    {
      id: 7,
      question: "Le conformisme est toujours un signe de faiblesse psychologique.",
      correct: false,
      explanation: "Le conformisme est un ph√©nom√®ne social normal qui facilite la coh√©sion de groupe."
    },
    {
      id: 8,
      question: "L'identit√© sociale se construit en partie par l'appartenance √† des groupes.",
      correct: true,
      explanation: "L'identit√© sociale est li√©e aux groupes d'appartenance et aux groupes de r√©f√©rence."
    }
  ];

  // ---------- DONN√âES : √âTAPES DU DEUIL ----------
  const deuilStages = [
    { id: "choc", name: "Choc / D√©ni" },
    { id: "colere", name: "Col√®re" },
    { id: "marchandage", name: "Marchandage" },
    { id: "tristesse", name: "Tristesse / D√©pression" },
    { id: "acceptation", name: "Acceptation" }
  ];
  
  const deuilExpectedOrder = ["choc", "colere", "marchandage", "tristesse", "acceptation"];

  // ---------- DONN√âES : CAS CLINIQUES AVANC√âS ----------
  const casAvances = [
    {
      id: 1,
      text: "Homme de 55 ans, ing√©nieur, hospitalis√© apr√®s un AVC. Il ne parvient plus √† se rappeler comment utiliser son ordinateur ni effectuer des t√¢ches professionnelles automatis√©es qu'il ma√Ætrisait parfaitement. En revanche, il se souvient de la date de son mariage et des pr√©noms de ses enfants.",
      concepts: ["m√©moire proc√©durale", "m√©moire √©pisodique", "m√©moire s√©mantique"]
    },
    {
      id: 2,
      text: "Femme de 68 ans diagnostiqu√©e d'un cancer en phase terminale. Elle affirme que ¬´ les m√©decins se trompent ¬ª et que ¬´ ce n'est qu'une erreur dans les r√©sultats ¬ª. Elle continue √† planifier des projets √† long terme et refuse d'envisager l'√©volution de sa maladie.",
      concepts: ["d√©ni", "√©tape du deuil"]
    },
    {
      id: 3,
      text: "√âtudiant EMEM de 22 ans qui, apr√®s avoir √©t√© confront√© √† un d√©c√®s brutal d'un patient en stage, s'investit intens√©ment dans une association de pr√©vention des accidents domestiques. Il consacre tout son temps libre √† informer le public et sauver des vies.",
      concepts: ["sublimation", "m√©canisme de d√©fense"]
    },
    {
      id: 4,
      text: "Patiente de 47 ans, r√©cemment veuve, qui alterne entre des moments o√π elle crie contre le personnel soignant, accusant tout le monde d'incomp√©tence, et des moments o√π elle n√©gocie avec Dieu en promettant de devenir une meilleure personne si son mari revenait.",
      concepts: ["col√®re", "marchandage", "√©tapes du deuil"]
    },
    {
      id: 5,
      text: "Homme de 40 ans atteint d'une phobie sociale s√©v√®re. Son th√©rapeute l'aide √† identifier ses pens√©es automatiques (¬´ tout le monde me juge n√©gativement ¬ª) et √† les remplacer par des pens√©es plus r√©alistes bas√©es sur des preuves concr√®tes.",
      concepts: ["mod√®le cognitif", "pens√©es dysfonctionnelles"]
    },
    {
      id: 6,
      text: "Adolescente de 16 ans pr√©sentant des troubles alimentaires. En th√©rapie familiale, on d√©couvre que ses sympt√¥mes apparaissent lors des conflits conjugaux de ses parents, d√©tournant ainsi l'attention du couple vers elle.",
      concepts: ["mod√®le syst√©mique", "sympt√¥me du syst√®me"]
    },
    {
      id: 7,
      text: "Femme de 35 ans en r√©mission d'un cancer. Elle ne peut plus se concentrer en r√©union, oublie les conversations r√©centes et perd constamment ses cl√©s. Par contre, elle se souvient parfaitement de son enfance et de comment conduire sa voiture.",
      concepts: ["m√©moire √† court terme", "m√©moire √©pisodique", "m√©moire proc√©durale"]
    },
    {
      id: 8,
      text: "Patient de 50 ans en psychoth√©rapie qui s'√©nerve syst√©matiquement contre son th√©rapeute, l'accusant d'√™tre autoritaire et contr√¥lant, exactement comme l'√©tait son p√®re durant son enfance. Le th√©rapeute devient l'objet de sentiments qui ne lui sont pas destin√©s.",
      concepts: ["transfert", "psychanalyse"]
    },
    {
      id: 9,
      text: "Jeune homme de 28 ans dont la s≈ìur a√Æn√©e vient de mourir. Il refuse d'aller √† l'enterrement, dit qu'¬´ elle n'est pas vraiment morte ¬ª, continue de lui envoyer des messages et garde sa chambre intacte chez leurs parents.",
      concepts: ["d√©ni", "choc", "√©tapes du deuil"]
    },
    {
      id: 10,
      text: "√âtudiante EMEM de 21 ans qui, lors d'un examen pratique stressant, se souvient soudainement de tous les gestes techniques enseign√©s, m√™me ceux qu'elle pensait avoir oubli√©s. Elle les ex√©cute automatiquement et avec pr√©cision.",
      concepts: ["m√©moire proc√©durale", "stress", "r√©cup√©ration"]
    },
    {
      id: 11,
      text: "Homme de 62 ans hospitalis√© pour d√©pression s√©v√®re. En th√©rapie, il explore des souvenirs refoul√©s de maltraitance infantile qui √©mergent progressivement, permettant de comprendre l'origine de ses sympt√¥mes actuels.",
      concepts: ["mod√®le psychanalytique", "refoulement", "inconscient"]
    },
    {
      id: 12,
      text: "Femme de 45 ans qui, apr√®s avoir perdu son emploi, traverse une p√©riode de profonde tristesse, dort beaucoup, pleure fr√©quemment et se replie sur elle-m√™me. Apr√®s plusieurs mois, elle commence lentement √† envisager de nouvelles perspectives professionnelles.",
      concepts: ["tristesse", "d√©pression", "acceptation", "√©tapes du deuil"]
    },
    {
      id: 13,
      text: "Adolescent de 17 ans dont les parents divorcent. La m√®re, en consultation, affirme que son fils ¬´ fait expr√®s d'√©chouer √† l'√©cole pour la punir ¬ª. Le th√©rapeute explique que le sympt√¥me peut refl√©ter un dysfonctionnement dans les interactions familiales.",
      concepts: ["mod√®le syst√©mique", "communication"]
    },
    {
      id: 14,
      text: "Patiente de 52 ans souffrant d'anxi√©t√© g√©n√©ralis√©e. Son th√©rapeute l'aide √† rep√©rer ses sch√©mas de pens√©e catastrophistes (¬´ tout va mal finir ¬ª) et √† d√©velopper des strat√©gies de questionnement de ces croyances irrationnelles.",
      concepts: ["mod√®le cognitif", "pens√©es automatiques", "anxi√©t√©"]
    },
    {
      id: 15,
      text: "Homme de 38 ans qui, apr√®s un traumatisme cr√¢nien, ne parvient plus √† retenir de nouvelles informations au-del√† de quelques secondes. Il ne peut pas tenir une conversation suivie et oublie imm√©diatement ce qu'on vient de lui dire.",
      concepts: ["m√©moire √† court terme", "encodage", "atteinte cognitive"]
    }
  ];

  // ---------- INIT TABS ----------
  function initTabs() {
    const buttons = document.querySelectorAll(".tab-button");
    const panels = document.querySelectorAll(".tab-panel");

    buttons.forEach(btn => {
      btn.addEventListener("click", () => {
        const target = btn.getAttribute("data-target");
        buttons.forEach(b => b.classList.remove("active"));
        panels.forEach(p => p.classList.remove("active"));
        btn.classList.add("active");
        const panel = document.getElementById(target);
        if (panel) {
          panel.classList.add("active");
        }
      });
    });
  }

  // ---------- INIT DEFINITIONS ----------
  function initDefinitions() {
    const tbody = document.getElementById("definitions-body");
    const shuffledDefs = shuffleArray(definitionItems);

    definitionItems.forEach(item => {
      const tr = document.createElement("tr");
      const optionsHtml = shuffledDefs.map(opt =>
        `<option value="${opt.id}">${opt.definition}</option>`
      ).join("");

      tr.innerHTML = `
        <td class="term">${item.term}</td>
        <td>
          <select data-id="${item.id}">
            <option value="">Choisis une d√©finition‚Ä¶</option>
            ${optionsHtml}
          </select>
          <div class="def-detail"></div>
        </td>
        <td class="feedback neutral"></td>
      `;
      tbody.appendChild(tr);
    });

    const checkBtn = document.getElementById("check-definitions");
    const resetBtn = document.getElementById("reset-definitions");
    const stat = document.getElementById("definitions-stat");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const feedback = tr.querySelector(".feedback");
        const detail = tr.querySelector(".def-detail");
        const expected = select.dataset.id;
        const value = select.value;

        select.classList.remove("select-good", "select-bad");
        detail.innerHTML = "";

        if (!value) {
          feedback.textContent = "√Ä compl√©ter";
          feedback.className = "feedback neutral";
          return;
        }

        if (value === expected) {
          correct++;
          feedback.textContent = "‚úî Correct";
          feedback.className = "feedback good";
          select.classList.add("select-good");
        } else {
          feedback.textContent = "‚úñ Faux";
          feedback.className = "feedback bad";
          select.classList.add("select-bad");

          const chosenDef = (definitionItems.find(d => d.id === value) || {}).definition || "";
          const correctDef = (definitionItems.find(d => d.id === expected) || {}).definition || "";

          detail.innerHTML =
            `<div class="def-wrong"><strong>Ta r√©ponse :</strong> ${chosenDef}</div>` +
            `<div class="def-correct"><strong>Bonne d√©finition :</strong> ${correctDef}</div>`;
        }
      });
      stat.innerHTML = `<span>R√©sultat : <strong>${correct}</strong> bonne(s) association(s) / ${definitionItems.length}</span>`;
    });

    resetBtn.addEventListener("click", () => {
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const feedback = tr.querySelector(".feedback");
        const detail = tr.querySelector(".def-detail");
        select.value = "";
        select.classList.remove("select-good", "select-bad");
        feedback.textContent = "";
        feedback.className = "feedback neutral";
        detail.innerHTML = "";
      });
      stat.textContent = "";
    });
  }

  // ---------- INIT VRAI/FAUX ----------
  function initVF() {
    const container = document.getElementById("vf-container");
    const stat = document.getElementById("vf-stat");

    vfQuestions.forEach((q, index) => {
      const card = document.createElement("div");
      card.className = "vf-question";
      card.dataset.id = q.id;

      card.innerHTML = `
        <div class="vf-text"><strong>Q${index + 1}.</strong> ${q.text}</div>
        <div class="vf-actions">
          <button type="button" class="vf-btn" data-value="true">Vrai</button>
          <button type="button" class="vf-btn" data-value="false">Faux</button>
        </div>
        <div class="vf-feedback"></div>
      `;
      container.appendChild(card);
    });

    container.addEventListener("click", e => {
      const btn = e.target.closest(".vf-btn");
      if (!btn) return;
      const card = btn.closest(".vf-question");
      const value = btn.getAttribute("data-value");

      card.querySelectorAll(".vf-btn").forEach(b => b.classList.remove("selected"));
      btn.classList.add("selected");
      card.dataset.selected = value;
      const feedback = card.querySelector(".vf-feedback");
      feedback.textContent = "";
      feedback.className = "vf-feedback";
    });

    const checkBtn = document.getElementById("check-vf");
    const resetBtn = document.getElementById("reset-vf");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      let answered = 0;
      vfQuestions.forEach(q => {
        const card = container.querySelector(`.vf-question[data-id="${q.id}"]`);
        const selected = card.dataset.selected;
        const fb = card.querySelector(".vf-feedback");
        if (!selected) {
          fb.textContent = "R√©ponds avant de corriger.";
          fb.className = "vf-feedback";
          return;
        }
        answered++;
        const isTrue = selected === "true";
        if (isTrue === q.answer) {
          correct++;
          fb.textContent = "‚úî Correct ‚Äì " + q.explanation;
          fb.className = "vf-feedback good";
        } else {
          fb.textContent = "‚úñ Faux ‚Äì " + q.explanation;
          fb.className = "vf-feedback bad";
        }
      });
      stat.innerHTML = `<span>R√©pondu : <strong>${answered}</strong> / ${vfQuestions.length} ‚Ä¢ Justes : <strong>${correct}</strong></span>`;
    });

    resetBtn.addEventListener("click", () => {
      container.querySelectorAll(".vf-question").forEach(card => {
        card.dataset.selected = "";
        card.querySelectorAll(".vf-btn").forEach(b => b.classList.remove("selected"));
        const fb = card.querySelector(".vf-feedback");
        fb.textContent = "";
        fb.className = "vf-feedback";
      });
      stat.textContent = "";
    });
  }

  // ---------- MAPPING NOMS ‚Üí ID STADE ----------
  function mapStageNameToId(name) {
    const n = normalizeWord(name);
    if (!n) return null;
    if (n.startsWith("oral")) return "oral";
    if (n.startsWith("anal")) return "anal";
    if (n.startsWith("phal") || n.startsWith("fall")) return "phal"; // phallique / phallic
    if (n.includes("latenc") || n.includes("latence")) return "lat";
    if (n.startsWith("geni") || n.startsWith("genital")) return "gen";
    return null;
  }

  // ---------- INIT FREUD : PARTIE A (ORDRE) ----------
  function initFreudOrder() {
    const listEl = document.getElementById("freud-order-list");
    const checkBtn = document.getElementById("check-freud-order");
    const resetBtn = document.getElementById("reset-freud-order");
    const stat = document.getElementById("freud-order-stat");
    const solutionEl = document.getElementById("freud-order-solution");

    // Cr√©ation des 5 lignes (positions 1 √† 5)
    function createRows() {
      listEl.innerHTML = "";
      for (let i = 0; i < freudExpectedOrder.length; i++) {
        const li = document.createElement("li");
        li.className = "freud-item";
        li.innerHTML = `
          <div class="freud-left">
            <div class="freud-position-label">Position ${i + 1} (du plus jeune au plus vieux)</div>
            <input type="text" class="freud-input" placeholder="Nom du stade (ex. Oral)">
          </div>
          <div class="freud-controls">
            <button type="button" class="freud-move-btn" data-dir="up">‚Üë</button>
            <button type="button" class="freud-move-btn" data-dir="down">‚Üì</button>
          </div>
        `;
        listEl.appendChild(li);
      }
    }

    createRows();

    // D√©placement des lignes
    listEl.addEventListener("click", e => {
      const btn = e.target.closest(".freud-move-btn");
      if (!btn) return;
      const dir = btn.dataset.dir;
      const li = btn.closest(".freud-item");
      const parent = li.parentElement;
      const items = Array.from(parent.children);
      const index = items.indexOf(li);
      if (index === -1) return;

      if (dir === "up" && index > 0) {
        parent.insertBefore(li, items[index - 1]);
      } else if (dir === "down" && index < items.length - 1) {
        parent.insertBefore(li, items[index + 1].nextSibling);
      }
    });

    function unlockFreudAges() {
      const agesSection = document.getElementById("freud-ages-section");
      const lockedText = document.getElementById("freud-ages-locked-text");
      if (agesSection && agesSection.style.display === "none") {
        agesSection.style.display = "block";
      }
      if (lockedText) {
        lockedText.style.display = "none";
      }
    }

    // Correction ordre
    checkBtn.addEventListener("click", () => {
      const items = Array.from(listEl.querySelectorAll(".freud-item"));
      let allFilled = true;
      const userOrder = [];

      items.forEach(li => {
        li.classList.remove("good", "bad");
        const input = li.querySelector(".freud-input");
        const id = mapStageNameToId(input.value);
        if (!input.value.trim()) {
          allFilled = false;
        }
        userOrder.push(id);
      });

      if (!allFilled) {
        stat.innerHTML = `<span><span class="chip bad">Attention</span> Compl√®te toutes les positions avant de corriger.</span>`;
        solutionEl.innerHTML = "";
        return;
      }

      // Feedback ligne par ligne
      let correctCount = 0;
      userOrder.forEach((id, idx) => {
        const li = items[idx];
        if (id && id === freudExpectedOrder[idx]) {
          li.classList.add("good");
          correctCount++;
        } else {
          li.classList.add("bad");
        }
      });

      stat.innerHTML = `<span>Positions correctes : <strong>${correctCount}</strong> / ${freudExpectedOrder.length}.</span>`;

      // Affichage ordre correct
      const solutionText = freudStages
        .map(s => s.name)
        .join(" ‚Üí ");

      solutionEl.innerHTML =
        `<span>Ordre correct :</span> ` +
        freudStages.map(s => `<span class="freud-tag">${s.name}</span>`).join(" ");

      // D√©bloquer la partie B (ages) apr√®s validation (m√™me si l‚Äôordre n‚Äôest pas parfait)
      unlockFreudAges();
    });

    // Reset
    resetBtn.addEventListener("click", () => {
      stat.textContent = "";
      solutionEl.innerHTML = "";
      createRows();
    });
  }

  // ---------- INIT FREUD : PARTIE B (√ÇGES) ----------
  function initFreudAges() {
    const tbody = document.getElementById("freud-body");
    const stat = document.getElementById("freud-stat");

    freudStages.forEach(stage => {
      const tr = document.createElement("tr");
      const optionsHtml = freudAges.map(opt =>
        `<option value="${opt.id}">${opt.label}</option>`
      ).join("");

      tr.innerHTML = `
        <td class="term">${stage.name}</td>
        <td>
          <select data-expected="${stage.expected}">
            <option value="">Choisis l‚Äô√¢ge‚Ä¶</option>
            ${optionsHtml}
          </select>
        </td>
        <td class="feedback neutral"></td>
      `;
      tbody.appendChild(tr);
    });

    const checkBtn = document.getElementById("check-freud");
    const resetBtn = document.getElementById("reset-freud");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      const total = freudStages.length;
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const expected = select.dataset.expected;
        const value = select.value;
        const fb = tr.querySelector(".feedback");
        select.classList.remove("select-good", "select-bad");
        if (!value) {
          fb.textContent = "√Ä compl√©ter";
          fb.className = "feedback neutral";
          return;
        }
        if (value === expected) {
          correct++;
          fb.textContent = "‚úî Correct";
          fb.className = "feedback good";
          select.classList.add("select-good");
        } else {
          fb.textContent = "‚úñ Faux";
          fb.className = "feedback bad";
          select.classList.add("select-bad");
        }
      });
      stat.innerHTML = `<span>√Çges corrects : <strong>${correct}</strong> / ${total}.</span>`;
    });

    resetBtn.addEventListener("click", () => {
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const fb = tr.querySelector(".feedback");
        select.value = "";
        select.classList.remove("select-good", "select-bad");
        fb.textContent = "";
        fb.className = "feedback neutral";
      });
      stat.textContent = "";
    });
  }

  // ---------- INIT SITUATIONS ----------
  function initSituations() {
    const situationText = document.getElementById("situation-text");
    const answerInput = document.getElementById("situation-answer");
    const feedback = document.getElementById("situation-feedback");
    const newBtn = document.getElementById("new-situation");
    const checkBtn = document.getElementById("check-situation");
    const solutionBtn = document.getElementById("show-solution");
    const counter = document.getElementById("situation-counter");

    let currentIndex = null;
    let seenCount = 0;

    function pickNewSituation() {
      if (!situations.length) return;
      let idx;
      if (situations.length === 1) {
        idx = 0;
      } else {
        do {
          idx = Math.floor(Math.random() * situations.length);
        } while (idx === currentIndex);
      }
      currentIndex = idx;
      const s = situations[idx];
      situationText.textContent = s.text;
      answerInput.value = "";
      feedback.innerHTML = "";
      seenCount++;
      counter.textContent = "Situations vues : " + seenCount;
      answerInput.focus();
    }

    function checkSituation(showOnlySolution) {
      if (currentIndex === null) {
        feedback.innerHTML = `<p><span class="chip info">Info</span> Clique d‚Äôabord sur ¬´ G√©n√©rer une situation ¬ª.</p>`;
        return;
      }
      const s = situations[currentIndex];
      const expected = s.concepts.map(normalizeWord);
      const rawAnswer = answerInput.value;
      const userConcepts = rawAnswer
        .split(/[,\;]/)
        .map(normalizeWord)
        .filter(Boolean);

      if (!userConcepts.length && !showOnlySolution) {
        feedback.innerHTML = `<p><span class="chip bad">Attention</span> Indique au moins un concept (ex. ¬´ d√©ni ¬ª ou ¬´ stress ¬ª).</p>`;
        return;
      }

      let found = 0;
      const extra = [];

      expected.forEach(e => {
        if (userConcepts.includes(e)) {
          found++;
        }
      });

      userConcepts.forEach(u => {
        if (!expected.includes(u)) {
          extra.push(u);
        }
      });

      let html = "";
      if (!showOnlySolution) {
        if (found === expected.length && extra.length === 0 && userConcepts.length > 0) {
          html += `<p><span class="chip good">‚úî Tr√®s bien</span> Tu as identifi√© tous les concepts attendus.</p>`;
        } else if (found > 0) {
          html += `<p><span class="chip info">üß© Partiellement juste</span> Tu as trouv√© une partie des concepts, mais il en manque.</p>`;
        } else {
          html += `<p><span class="chip bad">‚úñ √Ä retravailler</span> Tu n‚Äôas pas retrouv√© les concepts cl√©s de la situation.</p>`;
        }
      }

      html += `<p><span class="highlight">Concept(s) attendu(s) :</span> `;
      s.concepts.forEach(c => {
        html += `<span class="concept-tag"><strong>${c}</strong></span>`;
      });
      html += `</p>`;

      if (!showOnlySolution && extra.length > 0) {
        html += `<p><span class="highlight">Concept(s) en plus :</span> ${extra.map(e => `<span class="chip bad">${e}</span>`).join(" ")}</p>`;
      }

      feedback.innerHTML = html;
    }

    newBtn.addEventListener("click", pickNewSituation);
    checkBtn.addEventListener("click", () => checkSituation(false));
    solutionBtn.addEventListener("click", () => checkSituation(true));
  }

  // ---------- INIT COGNITIVE ----------
  function initCognitive() {
    const tbody = document.getElementById("cognitive-body");
    const stat = document.getElementById("cognitive-stat");

    cognitiveQuestions.forEach(q => {
      const tr = document.createElement("tr");
      const optionsHtml = q.options.map(opt =>
        `<option value="${opt}">${opt}</option>`
      ).join("");

      tr.innerHTML = `
        <td class="term">${q.question}</td>
        <td>
          <select data-expected="${q.correct}">
            <option value="">Choisis une r√©ponse‚Ä¶</option>
            ${optionsHtml}
          </select>
        </td>
        <td class="feedback neutral"></td>
      `;
      tbody.appendChild(tr);
    });

    const checkBtn = document.getElementById("check-cognitive");
    const resetBtn = document.getElementById("reset-cognitive");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      const total = cognitiveQuestions.length;
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const expected = select.dataset.expected;
        const value = select.value;
        const fb = tr.querySelector(".feedback");
        select.classList.remove("select-good", "select-bad");
        if (!value) {
          fb.textContent = "√Ä compl√©ter";
          fb.className = "feedback neutral";
          return;
        }
        if (value === expected) {
          correct++;
          fb.textContent = "‚úî Correct";
          fb.className = "feedback good";
          select.classList.add("select-good");
        } else {
          fb.textContent = "‚úñ Faux";
          fb.className = "feedback bad";
          select.classList.add("select-bad");
        }
      });
      stat.innerHTML = `<span>R√©ponses correctes : <strong>${correct}</strong> / ${total}.</span>`;
    });

    resetBtn.addEventListener("click", () => {
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const fb = tr.querySelector(".feedback");
        select.value = "";
        select.classList.remove("select-good", "select-bad");
        fb.textContent = "";
        fb.className = "feedback neutral";
      });
      stat.textContent = "";
    });
  }

  // ---------- INIT TOPIQUES ----------
  function initTopiques() {
    const introFeedback = document.getElementById("topique-intro-feedback");
    const feedback1ere = document.getElementById("topique-1ere-feedback");
    const feedback2eme = document.getElementById("topique-2eme-feedback");
    const checkBtn = document.getElementById("check-topiques");
    const resetBtn = document.getElementById("reset-topiques");
    const label1 = document.getElementById("label-topique-1");
    const label2 = document.getElementById("label-topique-2");

    // R√©ponse attendue
    const expectedMot = ["topiques", "topique"];
    
    const expected1ere = ["inconscient", "preconscient", "conscient"];
    const expected2eme = ["ca", "moi", "surmoi"];

    checkBtn.addEventListener("click", () => {
      // V√©rification question intro
      const mot = normalizeWord(document.getElementById("topique-mot").value);
      
      const motOk = expectedMot.some(exp => mot === normalizeWord(exp));

      if (!mot) {
        introFeedback.innerHTML = `<span class="chip bad">Attention</span> Compl√®te le champ de la question pr√©liminaire.`;
        label1.textContent = "______";
        label2.textContent = "______";
      } else if (motOk) {
        introFeedback.innerHTML = `<span class="chip good">‚úî Correct</span> Freud nomme ces divisions les <strong>topiques</strong>.`;
        // Affichage dynamique avec le mot trouv√©
        label1.textContent = "topique";
        label2.textContent = "topique";
      } else {
        introFeedback.innerHTML = `<span class="chip bad">‚úñ Faux</span> R√©ponse attendue : <strong>topiques</strong> (ou topique au singulier).`;
        label1.textContent = "______";
        label2.textContent = "______";
      }

      // V√©rification 1√®re topique
      const inputs1ere = Array.from(document.querySelectorAll(".topique-1ere"));
      const values1ere = inputs1ere.map(inp => normalizeWord(inp.value)).filter(Boolean);
      
      if (values1ere.length !== 3) {
        feedback1ere.innerHTML = `<span class="chip bad">Attention</span> Compl√®te les 3 niveaux de la 1√®re topique.`;
      } else {
        const found1ere = expected1ere.filter(exp => values1ere.includes(exp));
        if (found1ere.length === 3) {
          feedback1ere.innerHTML = `<span class="chip good">‚úî Parfait</span> Les 3 niveaux sont corrects : <strong>Inconscient, Pr√©conscient, Conscient</strong>.`;
        } else if (found1ere.length > 0) {
          feedback1ere.innerHTML = `<span class="chip info">Partiellement juste</span> ${found1ere.length}/3 corrects. Attendu : <strong>Inconscient, Pr√©conscient, Conscient</strong>.`;
        } else {
          feedback1ere.innerHTML = `<span class="chip bad">‚úñ Aucun correct</span> R√©ponse attendue : <strong>Inconscient, Pr√©conscient, Conscient</strong>.`;
        }
      }

      // V√©rification 2√®me topique
      const inputs2eme = Array.from(document.querySelectorAll(".topique-2eme"));
      const values2eme = inputs2eme.map(inp => normalizeWord(inp.value)).filter(Boolean);
      
      if (values2eme.length !== 3) {
        feedback2eme.innerHTML = `<span class="chip bad">Attention</span> Compl√®te les 3 instances de la 2√®me topique.`;
      } else {
        const found2eme = expected2eme.filter(exp => values2eme.includes(exp));
        if (found2eme.length === 3) {
          feedback2eme.innerHTML = `<span class="chip good">‚úî Parfait</span> Les 3 instances sont correctes : <strong>√áa, Moi, Surmoi</strong>.`;
        } else if (found2eme.length > 0) {
          feedback2eme.innerHTML = `<span class="chip info">Partiellement juste</span> ${found2eme.length}/3 corrects. Attendu : <strong>√áa, Moi, Surmoi</strong>.`;
        } else {
          feedback2eme.innerHTML = `<span class="chip bad">‚úñ Aucun correct</span> R√©ponse attendue : <strong>√áa, Moi, Surmoi</strong>.`;
        }
      }
    });

    resetBtn.addEventListener("click", () => {
      document.getElementById("topique-mot").value = "";
      document.querySelectorAll(".topique-1ere").forEach(inp => inp.value = "");
      document.querySelectorAll(".topique-2eme").forEach(inp => inp.value = "");
      introFeedback.innerHTML = "";
      feedback1ere.innerHTML = "";
      feedback2eme.innerHTML = "";
      label1.textContent = "______";
      label2.textContent = "______";
    });
  }

  // ---------- INIT PSYCHOPATHO ----------
  function initPsychopatho() {
    const tbody = document.getElementById("psychopatho-body");
    const stat = document.getElementById("psychopatho-stat");

    psychopathoQuestions.forEach(q => {
      const tr = document.createElement("tr");
      const optionsHtml = q.options.map(opt =>
        `<option value="${opt}">${opt}</option>`
      ).join("");

      tr.innerHTML = `
        <td class="term">${q.statement}</td>
        <td>
          <select data-expected="${q.correct}">
            <option value="">Choisis un mod√®le‚Ä¶</option>
            ${optionsHtml}
          </select>
        </td>
        <td class="feedback neutral"></td>
      `;
      tbody.appendChild(tr);
    });

    const checkBtn = document.getElementById("check-psychopatho");
    const resetBtn = document.getElementById("reset-psychopatho");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      const total = psychopathoQuestions.length;
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const expected = select.dataset.expected;
        const value = select.value;
        const fb = tr.querySelector(".feedback");
        select.classList.remove("select-good", "select-bad");
        if (!value) {
          fb.textContent = "√Ä compl√©ter";
          fb.className = "feedback neutral";
          return;
        }
        if (value === expected) {
          correct++;
          fb.textContent = "‚úî Correct";
          fb.className = "feedback good";
          select.classList.add("select-good");
        } else {
          fb.textContent = "‚úñ Faux";
          fb.className = "feedback bad";
          select.classList.add("select-bad");
        }
      });
      stat.innerHTML = `<span>R√©ponses correctes : <strong>${correct}</strong> / ${total}.</span>`;
    });

    resetBtn.addEventListener("click", () => {
      tbody.querySelectorAll("tr").forEach(tr => {
        const select = tr.querySelector("select");
        const fb = tr.querySelector(".feedback");
        select.value = "";
        select.classList.remove("select-good", "select-bad");
        fb.textContent = "";
        fb.className = "feedback neutral";
      });
      stat.textContent = "";
    });
  }

  // ---------- INIT SOCIALE ----------
  function initSociale() {
    const container = document.getElementById("sociale-container");
    const stat = document.getElementById("sociale-stat");

    socialeQuestions.forEach((q, index) => {
      const div = document.createElement("div");
      div.className = "vf-question";
      div.innerHTML = `
        <div class="vf-text">${q.question}</div>
        <div class="vf-actions">
          <button class="vf-btn" data-index="${index}" data-value="true">Vrai</button>
          <button class="vf-btn" data-index="${index}" data-value="false">Faux</button>
          <div class="vf-feedback" data-index="${index}"></div>
        </div>
      `;
      container.appendChild(div);
    });

    container.addEventListener("click", e => {
      if (e.target.classList.contains("vf-btn")) {
        const index = e.target.dataset.index;
        const btns = container.querySelectorAll(`.vf-btn[data-index="${index}"]`);
        btns.forEach(btn => btn.classList.remove("selected"));
        e.target.classList.add("selected");
      }
    });

    const checkBtn = document.getElementById("check-sociale");
    const resetBtn = document.getElementById("reset-sociale");

    checkBtn.addEventListener("click", () => {
      let correct = 0;
      const total = socialeQuestions.length;

      socialeQuestions.forEach((q, index) => {
        const selected = container.querySelector(`.vf-btn[data-index="${index}"].selected`);
        const fb = container.querySelector(`.vf-feedback[data-index="${index}"]`);

        if (!selected) {
          fb.textContent = "Non r√©pondu";
          fb.className = "vf-feedback";
          return;
        }

        const userAnswer = selected.dataset.value === "true";
        if (userAnswer === q.correct) {
          correct++;
          fb.textContent = "‚úî " + q.explanation;
          fb.className = "vf-feedback good";
        } else {
          fb.textContent = "‚úñ " + q.explanation;
          fb.className = "vf-feedback bad";
        }
      });

      stat.innerHTML = `<span>Bonnes r√©ponses : <strong>${correct}</strong> / ${total}.</span>`;
    });

    resetBtn.addEventListener("click", () => {
      container.querySelectorAll(".vf-btn").forEach(btn => btn.classList.remove("selected"));
      container.querySelectorAll(".vf-feedback").forEach(fb => {
        fb.textContent = "";
        fb.className = "vf-feedback";
      });
      stat.textContent = "";
    });
  }

  // ---------- INIT DEUIL ORDER ----------
  function initDeuilOrder() {
    const listEl = document.getElementById("deuil-order-list");
    const checkBtn = document.getElementById("check-deuil-order");
    const resetBtn = document.getElementById("reset-deuil-order");
    const stat = document.getElementById("deuil-order-stat");
    const solutionEl = document.getElementById("deuil-order-solution");

    function mapStageNameToId(name) {
      const n = normalizeWord(name);
      if (n.includes("choc") || n.includes("deni")) return "choc";
      if (n.includes("colere")) return "colere";
      if (n.includes("marchandage")) return "marchandage";
      if (n.includes("tristesse") || n.includes("depression")) return "tristesse";
      if (n.includes("acceptation")) return "acceptation";
      return null;
    }

    function createRows() {
      listEl.innerHTML = "";
      for (let i = 0; i < 5; i++) {
        const li = document.createElement("li");
        li.className = "freud-item";
        li.innerHTML = `
          <div class="freud-left">
            <div class="freud-position-label">√âtape ${i + 1}</div>
            <input type="text" class="freud-input" placeholder="Nom de l'√©tape">
          </div>
          <div class="freud-controls">
            <button type="button" class="freud-move-btn" data-dir="up">‚Üë</button>
            <button type="button" class="freud-move-btn" data-dir="down">‚Üì</button>
          </div>
        `;
        listEl.appendChild(li);
      }
    }

    createRows();

    listEl.addEventListener("click", e => {
      const btn = e.target.closest(".freud-move-btn");
      if (!btn) return;
      const dir = btn.dataset.dir;
      const li = btn.closest(".freud-item");
      const parent = li.parentElement;
      const items = Array.from(parent.children);
      const index = items.indexOf(li);
      if (index === -1) return;

      if (dir === "up" && index > 0) {
        parent.insertBefore(li, items[index - 1]);
      } else if (dir === "down" && index < items.length - 1) {
        parent.insertBefore(li, items[index + 1].nextSibling);
      }
    });

    checkBtn.addEventListener("click", () => {
      const items = Array.from(listEl.querySelectorAll(".freud-item"));
      let allFilled = true;
      const userOrder = [];

      items.forEach(li => {
        li.classList.remove("good", "bad");
        const input = li.querySelector(".freud-input");
        const id = mapStageNameToId(input.value);
        if (!input.value.trim()) {
          allFilled = false;
        }
        userOrder.push(id);
      });

      if (!allFilled) {
        stat.innerHTML = `<span><span class="chip bad">Attention</span> Compl√®te toutes les √©tapes avant de corriger.</span>`;
        solutionEl.innerHTML = "";
        return;
      }

      let correctCount = 0;
      userOrder.forEach((id, idx) => {
        const li = items[idx];
        if (id && id === deuilExpectedOrder[idx]) {
          li.classList.add("good");
          correctCount++;
        } else {
          li.classList.add("bad");
        }
      });

      stat.innerHTML = `<span>√âtapes correctes : <strong>${correctCount}</strong> / ${deuilExpectedOrder.length}.</span>`;

      solutionEl.innerHTML =
        `<span>Ordre correct :</span> ` +
        deuilStages.map(s => `<span class="freud-tag">${s.name}</span>`).join(" ");
    });

    resetBtn.addEventListener("click", () => {
      stat.textContent = "";
      solutionEl.innerHTML = "";
      createRows();
    });
  }

  // ---------- INIT CAS AVANC√âS ----------
  function initCasAvances() {
    const casText = document.getElementById("cas-avance-text");
    const answerInput = document.getElementById("cas-avance-answer");
    const feedback = document.getElementById("cas-avance-feedback");
    const newBtn = document.getElementById("new-cas-avance");
    const checkBtn = document.getElementById("check-cas-avance");
    const solutionBtn = document.getElementById("show-cas-avance-solution");
    const counter = document.getElementById("cas-avance-counter");

    let currentIndex = null;
    let seenCount = 0;

    function pickNewCas() {
      if (!casAvances.length) return;
      let idx;
      if (casAvances.length === 1) {
        idx = 0;
      } else {
        do {
          idx = Math.floor(Math.random() * casAvances.length);
        } while (idx === currentIndex);
      }
      currentIndex = idx;
      const c = casAvances[idx];
      casText.textContent = c.text;
      answerInput.value = "";
      feedback.innerHTML = "";
      seenCount++;
      counter.textContent = "Cas vus : " + seenCount;
      answerInput.focus();
    }

    function checkCas(showOnlySolution) {
      if (currentIndex === null) {
        feedback.innerHTML = `<p><span class="chip info">Info</span> Clique d'abord sur ¬´ G√©n√©rer un cas ¬ª.</p>`;
        return;
      }
      const c = casAvances[currentIndex];
      const expected = c.concepts.map(normalizeWord);
      const rawAnswer = answerInput.value;
      const userConcepts = rawAnswer
        .split(/[,\;]/)
        .map(normalizeWord)
        .filter(Boolean);

      if (!userConcepts.length && !showOnlySolution) {
        feedback.innerHTML = `<p><span class="chip bad">Attention</span> Indique au moins un concept.</p>`;
        return;
      }

      let found = 0;
      const extra = [];

      expected.forEach(e => {
        if (userConcepts.includes(e)) {
          found++;
        }
      });

      userConcepts.forEach(u => {
        if (!expected.includes(u)) {
          extra.push(u);
        }
      });

      let html = "";
      if (!showOnlySolution) {
        if (found === expected.length && extra.length === 0 && userConcepts.length > 0) {
          html += `<p><span class="chip good">‚úî Tr√®s bien</span> Tu as identifi√© tous les concepts attendus.</p>`;
        } else if (found > 0) {
          html += `<p><span class="chip info">üß© Partiellement juste</span> Tu as trouv√© une partie des concepts, mais il en manque.</p>`;
        } else {
          html += `<p><span class="chip bad">‚úñ √Ä retravailler</span> Tu n'as pas retrouv√© les concepts cl√©s.</p>`;
        }
      }

      html += `<p><span class="highlight">Concept(s) attendu(s) :</span> `;
      c.concepts.forEach(concept => {
        html += `<span class="concept-tag"><strong>${concept}</strong></span>`;
      });
      html += `</p>`;

      if (!showOnlySolution && extra.length > 0) {
        html += `<p><span class="highlight">Concept(s) en plus :</span> ${extra.map(e => `<span class="chip bad">${e}</span>`).join(" ")}</p>`;
      }

      feedback.innerHTML = html;
    }

    newBtn.addEventListener("click", pickNewCas);
    checkBtn.addEventListener("click", () => checkCas(false));
    solutionBtn.addEventListener("click", () => checkCas(true));
  }

  // ---------- LANCEMENT ----------
  document.addEventListener("DOMContentLoaded", () => {
    initTabs();
    initDefinitions();
    initVF();
    initFreudOrder();
    initFreudAges();
    initSituations();
    initCognitive();
    initTopiques();
    initPsychopatho();
    initSociale();
    initDeuilOrder();
    initCasAvances();
  });
</script>
</body>
</html>
