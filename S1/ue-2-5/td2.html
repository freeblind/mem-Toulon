<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD2 UE 2.5 S1 - Physiologie G√©n√©rale</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            margin-bottom: 30px;
            text-align: center;
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }

        h2 {
            color: #764ba2;
            margin-bottom: 20px;
        }

        .subtitle {
            color: #666;
            font-size: 1.1em;
        }

        .mode-selector {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
        }

        .mode-btn {
            padding: 15px 40px;
            font-size: 1.1em;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: bold;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .mode-btn.active {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .mode-btn:not(.active) {
            background: white;
            color: #667eea;
        }

        .mode-btn:hover:not(.active) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.25);
        }

        .content-section {
            display: none;
        }

        .content-section.active {
            display: block;
        }

        /* FLASHCARDS MODE */
        .stats-container {
            background: white;
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-item {
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            color: white;
            font-weight: bold;
        }

        .stat-item.total { background: linear-gradient(135deg, #667eea, #764ba2); }
        .stat-item.acquired { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .stat-item.review { background: linear-gradient(135deg, #f2994a, #f2c94c); }
        .stat-item.not-acquired { background: linear-gradient(135deg, #eb3349, #f45c43); }
        .stat-item.new { background: linear-gradient(135deg, #4facfe, #00f2fe); }

        .stat-number {
            font-size: 2em;
            display: block;
            margin-bottom: 5px;
        }

        .progress-bar-container {
            background: #e0e0e0;
            height: 30px;
            border-radius: 15px;
            overflow: hidden;
            margin-top: 15px;
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #667eea, #764ba2);
            transition: width 0.5s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .filters {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .filter-btn.active {
            background: white;
            color: #667eea;
        }

        .filter-btn:hover {
            transform: translateY(-2px);
        }

        .card-controls {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .control-btn {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .export-btn { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .import-btn { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .reset-btn { background: linear-gradient(135deg, #eb3349, #f45c43); }

        .control-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .flashcard-container {
            perspective: 1000px;
            margin: 30px auto;
            max-width: 800px;
        }

        .flashcard {
            background: white;
            min-height: 400px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            cursor: pointer;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            border-radius: 20px;
        }

        .card-front {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
        }

        .card-back {
            background: white;
            transform: rotateY(180deg);
            border: 3px solid #667eea;
        }

        .card-category {
            background: rgba(255,255,255,0.3);
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .card-question, .card-answer {
            font-size: 1.3em;
            text-align: center;
            line-height: 1.6;
        }

        .card-answer {
            color: #333;
        }

        .card-answer ul {
            text-align: left;
            margin-top: 15px;
        }

        .card-answer li {
            margin: 10px 0;
        }

        .evaluation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
            flex-wrap: wrap;
        }

        .eval-btn {
            padding: 15px 30px;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-weight: bold;
            font-size: 1.1em;
            color: white;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .eval-btn.acquired { background: linear-gradient(135deg, #11998e, #38ef7d); }
        .eval-btn.review { background: linear-gradient(135deg, #f2994a, #f2c94c); }
        .eval-btn.not-acquired { background: linear-gradient(135deg, #eb3349, #f45c43); }

        .eval-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .navigation-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 20px;
        }

        .nav-btn {
            padding: 12px 30px;
            border: 2px solid white;
            background: transparent;
            color: white;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
        }

        .nav-btn:hover:not(:disabled) {
            background: white;
            color: #667eea;
            transform: translateY(-2px);
        }

        .nav-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        /* TEST MODE */
        .test-container {
            background: white;
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .question-block {
            margin-bottom: 40px;
            padding: 25px;
            border-radius: 15px;
            background: #f8f9fa;
        }

        .question-title {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .question-type {
            display: inline-block;
            padding: 5px 15px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border-radius: 20px;
            font-size: 0.9em;
            margin-bottom: 15px;
        }

        .options {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .option {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .option input[type="checkbox"],
        .option input[type="radio"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .option.correct {
            background: #d4edda;
            border-color: #28a745;
        }

        .option.incorrect {
            background: #f8d7da;
            border-color: #dc3545;
        }

        .fill-input {
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            width: 100%;
            max-width: 400px;
        }

        .fill-input.correct {
            border-color: #28a745;
            background: #d4edda;
        }

        .fill-input.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .matching-item {
            padding: 15px;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
        }

        .matching-select {
            width: 100%;
            padding: 10px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            margin-top: 10px;
        }

        .explanation {
            margin-top: 15px;
            padding: 15px;
            background: #e7f3ff;
            border-left: 4px solid #667eea;
            border-radius: 8px;
            display: none;
        }

        .explanation.show {
            display: block;
        }

        .submit-btn {
            padding: 15px 40px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.2em;
            font-weight: bold;
            margin-top: 30px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .test-result {
            margin-top: 30px;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            display: none;
        }

        .test-result.show {
            display: block;
        }

        .test-result.excellent {
            background: linear-gradient(135deg, #11998e, #38ef7d);
            color: white;
        }

        .test-result.good {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }

        .test-result.average {
            background: linear-gradient(135deg, #f2994a, #f2c94c);
            color: white;
        }

        .test-result.poor {
            background: linear-gradient(135deg, #eb3349, #f45c43);
            color: white;
        }

        .score-display {
            font-size: 3em;
            font-weight: bold;
            margin: 20px 0;
        }

        .retry-btn {
            padding: 15px 40px;
            background: white;
            color: #667eea;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 1.1em;
            font-weight: bold;
            margin-top: 20px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            transition: all 0.3s ease;
        }

        .retry-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        .no-cards-message {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
        }

        .no-cards-message h3 {
            color: #667eea;
            margin-bottom: 15px;
            font-size: 1.5em;
        }

        @media (max-width: 768px) {
            h1 { font-size: 1.8em; }
            .mode-selector { flex-direction: column; }
            .stats-grid { grid-template-columns: 1fr; }
            .flashcard { min-height: 300px; }
            .card-face { padding: 20px; }
            .card-question, .card-answer { font-size: 1.1em; }
            .matching-container { grid-template-columns: 1fr; }
        }

        input[type="file"] {
            display: none;
        }

        .file-input-label {
            padding: 12px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            color: white;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            display: inline-block;
        }

        .file-input-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üìö TD N¬∞2 - UE 2.5 S1</h1>
            <p class="subtitle">Physiologie g√©n√©rale, physiologie, s√©miologie et pathologies ost√©oarticulaires</p>
            
            <div class="mode-selector">
                <button class="mode-btn active" onclick="switchMode('flashcards', this)">
                    üÉè Mode Flashcards
                </button>
                <button class="mode-btn" onclick="switchMode('test', this)">
                    üìù Mode Test
                </button>
            </div>
        </header>

        <!-- FLASHCARDS MODE -->
        <div id="flashcards-section" class="content-section active">
            <div class="stats-container">
                <div class="stats-grid">
                    <div class="stat-item total">
                        <span class="stat-number" id="total-cards">0</span>
                        <span>Total de cartes</span>
                    </div>
                    <div class="stat-item acquired">
                        <span class="stat-number" id="acquired-cards">0</span>
                        <span>‚úÖ Acquises</span>
                    </div>
                    <div class="stat-item review">
                        <span class="stat-number" id="review-cards">0</span>
                        <span>‚ö†Ô∏è √Ä revoir</span>
                    </div>
                    <div class="stat-item not-acquired">
                        <span class="stat-number" id="not-acquired-cards">0</span>
                        <span>‚ùå Non acquises</span>
                    </div>
                    <div class="stat-item new">
                        <span class="stat-number" id="new-cards">0</span>
                        <span>üÜï Nouvelles</span>
                    </div>
                </div>

                <div class="progress-bar-container">
                    <div class="progress-bar" id="progress-bar">0%</div>
                </div>

                <div class="filters">
                    <button class="filter-btn active" onclick="filterCards('all', this)">Toutes les cartes</button>
                    <button class="filter-btn" onclick="filterCards('new', this)">Nouvelles cartes</button>
                    <button class="filter-btn" onclick="filterCards('review', this)">√Ä r√©viser</button>
                    <button class="filter-btn" onclick="filterCards('acquired', this)">Acquises</button>
                </div>

                <div class="card-controls">
                    <button class="control-btn export-btn" onclick="exportProgress()">üì• Exporter</button>
                    <label class="file-input-label" for="import-file">üì§ Importer</label>
                    <input type="file" id="import-file" accept=".json" onchange="importProgress(event)">
                    <button class="control-btn reset-btn" onclick="resetProgress()">üîÑ R√©initialiser</button>
                </div>
            </div>

            <div id="flashcard-display"></div>
        </div>

        <!-- TEST MODE -->
        <div id="test-section" class="content-section">
            <div class="test-container">
                <h2>üìù √âvaluation - TD N¬∞2</h2>
                <div id="test-questions"></div>
                <button class="submit-btn" onclick="submitTest()">Valider le test</button>
                <div class="test-result" id="test-result"></div>
            </div>
        </div>
    </div>

    <script>
        // DONN√âES DES FLASHCARDS
        const flashcardsData = [
            // CM3 - Les √©tapes de la vie
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce qu'un gam√®te m√¢le ?",
                answer: "Spermatozo√Øde"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce qu'un gam√®te femelle ?",
                answer: "Ovocyte"
            },
            {
                category: "√âtapes de la vie",
                question: "Comment appelle-t-on l'≈ìuf f√©cond√© ?",
                answer: "Zygote"
            },
            {
                category: "√âtapes de la vie",
                question: "Comment appelle-t-on l'≈ìuf apr√®s la premi√®re division ?",
                answer: "Embryon"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce que la nidation ?",
                answer: "L'implantation de l'embryon dans l'ut√©rus (5√®me-7√®me jour)"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce que l'embryog√©n√®se ?",
                answer: "La p√©riode de l'≈ìuf f√©cond√© √† la fin de la 8√®me semaine"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce que l'organog√©n√®se ?",
                answer: "La diff√©rentiation cellulaire et l'apparition des organes (0 √† 8 semaines)"
            },
            {
                category: "√âtapes de la vie",
                question: "√Ä partir de quand parle-t-on de f≈ìtus ?",
                answer: "√Ä partir de la 9√®me semaine jusqu'√† la naissance"
            },
            {
                category: "√âtapes de la vie",
                question: "Quel est l'organe √† l'interface entre le b√©b√© et la m√®re ?",
                answer: "Le placenta"
            },
            {
                category: "√âtapes de la vie",
                question: "Comment appelle-t-on l'enveloppe liquidienne o√π baigne le b√©b√© ?",
                answer: "Le sac amniotique"
            },
            {
                category: "√âtapes de la vie",
                question: "Quelle est la diff√©rence entre semaines de grossesse et semaines d'am√©norrh√©e ?",
                answer: "Les semaines de grossesse partent de la f√©condation, les semaines d'am√©norrh√©e partent du 1er jour des derni√®res r√®gles (2 semaines de d√©calage)"
            },
            {
                category: "√âtapes de la vie",
                question: "Le f≈ìtus a-t-il une ventilation pulmonaire ?",
                answer: "Non, la ventilation pulmonaire du f≈ìtus est inexistante"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce que le m√©conium ?",
                answer: "C'est ce que produit le f≈ìtus en ing√©rant du liquide amniotique (le colostrum est le lait maternel avant la premi√®re mont√©e de lait)"
            },
            {
                category: "√âtapes de la vie",
                question: "Quelles sont les 3 phases de l'accouchement ?",
                answer: "1. Dilatation du col\n2. Expulsion du f≈ìtus\n3. Expulsion du placenta (d√©livrance)"
            },
            {
                category: "√âtapes de la vie",
                question: "Qu'est-ce que la d√©livrance ?",
                answer: "L'expulsion du placenta (3√®me phase de l'accouchement)"
            },
            {
                category: "Nouveau-n√©",
                question: "Citez 2 immaturit√©s du nouveau-n√©",
                answer: "Immaturit√© r√©nale (turn-over hydrique √ó7 et activit√© m√©tabolique √ó2) et immaturit√© h√©patique (biliaire, synth√®se prot√©ines, n√©oglucog√©n√®se d√©ficiente)"
            },
            {
                category: "Nouveau-n√©",
                question: "Le nouveau-n√© a-t-il une immunit√© ?",
                answer: "Oui, une immunit√© h√©rit√©e de la m√®re"
            },
            {
                category: "Nouveau-n√©",
                question: "De quoi le nouveau-n√© a-t-il un besoin accru ?",
                answer: "Fer et vitamine D"
            },
            {
                category: "Nouveau-n√©",
                question: "Quelle est la fr√©quence respiratoire du nouveau-n√© ?",
                answer: "40 par minute (vs 12-20 chez l'adulte)"
            },
            {
                category: "Nouveau-n√©",
                question: "Quelle est la masse hydrique du nouveau-n√© ?",
                answer: "80% (vs 60% chez l'adulte)"
            },
            {
                category: "Nouveau-n√©",
                question: "Quelle est la fr√©quence cardiaque du nouveau-n√© ?",
                answer: "120-180 par minute (vs 60-80 chez l'adulte)"
            },
            {
                category: "Vieillissement",
                question: "Qu'est-ce que la m√©nopause ?",
                answer: "L'arr√™t d√©finitif du fonctionnement des ovaires (plus de s√©cr√©tions d'ovules et plus de production d'≈ìstrog√®nes)"
            },
            {
                category: "Vieillissement",
                question: "Quels risques la m√©nopause accro√Æt-elle ?",
                answer: "Le risque cardio-vasculaire et l'ost√©oporose"
            },
            {
                category: "Vieillissement",
                question: "Que permet de doser l'hormone b√©ta HCG ?",
                answer: "Elle permet d'affirmer la grossesse"
            },
            {
                category: "Vieillissement",
                question: "√Ä partir de quel √¢ge parle-t-on de vieillesse selon l'OMS ?",
                answer: "65 ans"
            },
            {
                category: "Vieillissement",
                question: "Quelle est la diff√©rence entre g√©rontologie et g√©riatrie ?",
                answer: "La g√©rontologie √©tudie le vieillissement dans tous ses aspects (biom√©dical, socio-√©conomique, culturel). La g√©riatrie est la m√©decine des personnes √¢g√©es."
            },
            {
                category: "Vieillissement",
                question: "Comment appelle-t-on la diminution de l'audition ?",
                answer: "Presbyacousie"
            },
            {
                category: "Vieillissement",
                question: "Comment appelle-t-on la diminution de la vue ?",
                answer: "Presbytie"
            },
            {
                category: "Vieillissement",
                question: "Qu'est-ce que la s√©nescence ?",
                answer: "Le vieillissement cellulaire"
            },
            {
                category: "Vieillissement",
                question: "Quelle est la cause de mort la plus fr√©quente ?",
                answer: "Le cancer (plus fr√©quent que l'insuffisance cardiaque)"
            },
            {
                category: "Vieillissement",
                question: "Comment d√©finit-on la mort ?",
                answer: "L'absence totale de conscience, de reflexes et de ventilation"
            },

            // CM4 - Hom√©ostasie
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que la kali√©mie ?",
                answer: "Le taux de potassium dans le sang"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que la thermor√©gulation ?",
                answer: "La r√©gulation de la temp√©rature corporelle"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que la thermog√©n√®se ?",
                answer: "La production de chaleur"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que la thermolyse ?",
                answer: "L'√©vacuation de chaleur"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Que sont les baror√©cepteurs ?",
                answer: "Des capteurs barom√©triques (d√©tectent les variations de pression)"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que l'hypotension ?",
                answer: "Une tension art√©rielle basse"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que l'hypertension ?",
                answer: "Une tension art√©rielle haute"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Que sont les osmor√©cepteurs ?",
                answer: "Des r√©cepteurs qui d√©tectent la variation d'osmolarit√©"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Que sont les substances osmotiques ?",
                answer: "Des substances (glucose, sodium, ur√©e, alcool) qui exercent une force vis-√†-vis d'une membrane semi-perm√©able"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que la glyc√©mie ?",
                answer: "La concentration de sucre dans le sang"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Que d√©termine le pH sanguin ?",
                answer: "L'acidit√© et la basicit√©"
            },
            {
                category: "Hom√©ostasie - D√©finitions",
                question: "Qu'est-ce que l'hyperhydratation ?",
                answer: "Un exc√®s d'eau dans l'organisme"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "Quel pourcentage du poids corporel l'eau repr√©sente-t-elle chez l'adulte ?",
                answer: "60%"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "Dans combien de secteurs l'eau se r√©partit-elle ?",
                answer: "2 secteurs"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "Quel pourcentage de l'eau totale repr√©sente le LIC ?",
                answer: "67% (Liquide IntraCellulaire)"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "Quel pourcentage de l'eau totale repr√©sente le LEC ?",
                answer: "33% (Liquide ExtraCellulaire)"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "Que composent le liquide interstitiel et le plasma ?",
                answer: "Le LEC (Liquide ExtraCellulaire)"
            },
            {
                category: "Hom√©ostasie - Eau",
                question: "√Ä quoi correspond l'environnement interne ?",
                answer: "Au LEC (Liquide ExtraCellulaire)"
            },
            {
                category: "Hom√©ostasie - Concepts",
                question: "D√©finissez l'hom√©ostasie",
                answer: "Un processus de r√©gulation par lequel l'organisme maintient la stabilit√© des constantes dans les limites des valeurs normales (√©quilibre)"
            },
            {
                category: "Hom√©ostasie - Concepts",
                question: "Quel est le r√¥le de l'environnement int√©rieur ?",
                answer: "- Approvisionner les cellules en nutriments et oxyg√®ne via le sang art√©riel\n- Permettre l'√©limination des d√©chets m√©taboliques vers le sang veineux"
            },
            {
                category: "Hom√©ostasie - Concepts",
                question: "Quels sont les 3 composants de l'hom√©ostasie ?",
                answer: "1. Capteur/r√©cepteurs\n2. Centre de contr√¥le\n3. Effecteur"
            },
            {
                category: "Hom√©ostasie - M√©canismes",
                question: "Qu'est-ce que la r√©tro-inhibition (r√©troaction n√©gative) ?",
                answer: "Un m√©canisme de r√©gulation qui diminue le stimulus de d√©part. Si une variable augmente, le m√©canisme la fait diminuer, et inversement."
            },
            {
                category: "Hom√©ostasie - M√©canismes",
                question: "Donnez un exemple de r√©tro-inhibition",
                answer: "R√©gulation de la glyc√©mie : apr√®s un repas, la glyc√©mie augmente ‚Üí s√©cr√©tion d'insuline pour faire entrer le glucose dans les cellules ‚Üí glyc√©mie diminue ‚Üí r√©trocontr√¥le n√©gatif sur la production d'insuline"
            },
            {
                category: "Hom√©ostasie - M√©canismes",
                question: "Qu'est-ce que la r√©tro-activation (r√©troaction positive) ?",
                answer: "Un m√©canisme de r√©gulation qui amplifie le stimulus de d√©part. Si une variable augmente, le m√©canisme l'augmente encore plus."
            },
            {
                category: "Hom√©ostasie - M√©canismes",
                question: "Donnez un exemple de r√©tro-activation",
                answer: "L'accouchement : le b√©b√© appuie sur le col ‚Üí √©tirement du col ‚Üí s√©cr√©tion d'ocytocine ‚Üí contractions plus fortes et intenses ‚Üí le b√©b√© appuie encore plus ‚Üí r√©trocontr√¥le positif jusqu'√† l'accouchement"
            },

            // CM5 - Syst√®me immunitaire
            {
                category: "Syst√®me immunitaire",
                question: "Qu'est-ce que l'immunit√© ?",
                answer: "L'ensemble des acteurs et m√©canismes physiologiques impliqu√©s dans la reconnaissance du 'soi' et du 'non-soi' : tol√©rance ou rejet"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Qu'est-ce qu'un antig√®ne ?",
                answer: "Toute substance √©trang√®re √† l'organisme d√©clenchant une r√©ponse immunitaire (anticorps)"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Qu'est-ce qu'un anticorps ?",
                answer: "Une prot√©ine complexe s√©cr√©t√©e par les cellules immunes (lymphocyte B) capable d'√©tablir une liaison avec un antig√®ne - Immunoglobuline"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Que sont les cellules phagocytaires ?",
                answer: "Des cellules pouvant ing√©rer et d√©truire des particules >0,5Œºm (√©boueurs du syst√®me immunitaire)"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Que sont les lymphocytes ?",
                answer: "Des cellules qui ont un r√¥le majeur de d√©fense contre les infections dans le syst√®me immunitaire"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quelles sont les caract√©ristiques de l'immunit√© non sp√©cifique ?",
                answer: "- Inn√©e\n- 1√®re ligne de d√©fense\n- Granulocytes/polynucl√©aires et macrophages\n- Phagocytose\n- R√©action inflammatoire (rougeur, chaleur, douleur, ≈ìd√®me, +/- hyperthermie)"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quelles sont les caract√©ristiques de l'immunit√© sp√©cifique ?",
                answer: "- Acquise - adaptative\n- Plus rapide et efficace\n- Lymphocytes\n- S√©cr√©tion d'anticorps et cytokines (r√©gulation et cytotoxicit√©)"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quels sont les organes lympho√Ødes primaires ?",
                answer: "Le thymus et la moelle osseuse"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quel est le r√¥le des organes lympho√Ødes primaires ?",
                answer: "Lieu de maturation des lymphocytes (moelle osseuse et thymus). Ils deviennent des lymphocytes na√Øfs et migrent vers les organes secondaires"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quels sont les organes lympho√Ødes secondaires ?",
                answer: "Les ganglions lympho√Ødes, la rate, les amygdales, les v√©g√©tations"
            },
            {
                category: "Syst√®me immunitaire",
                question: "Quel est le r√¥le des organes lympho√Ødes secondaires ?",
                answer: "Lieu de rencontre entre les antig√®nes (apport√©s par le sang) et les lymphocytes. Ils permettent l'activation des lymphocytes B et T et le d√©clenchement de la r√©ponse immunitaire adaptative"
            }
        ];

        // DONN√âES DES QUESTIONS DE TEST
        const testQuestions = [
            {
                type: "qcm",
                question: "Parmi ces affirmations sur le f≈ìtus, lesquelles sont VRAIES ?",
                options: [
                    "La ventilation pulmonaire du f≈ìtus est inexistante",
                    "La my√©linisation du f≈ìtus est compl√®te",
                    "Le f≈ìtus produit de l'urine",
                    "Le sang oxyg√©n√© venant du placenta est d√©vi√© vers les poumons du f≈ìtus"
                ],
                correct: [0, 2],
                explanation: "Le f≈ìtus n'a pas de ventilation pulmonaire, sa my√©linisation est incompl√®te, il produit bien de l'urine, et le sang oxyg√©n√© est d√©vi√© vers le c≈ìur gauche (le poumon est 'shunt√©')."
            },
            {
                type: "qcm",
                question: "Concernant le nouveau-n√©, quelles affirmations sont VRAIES ?",
                options: [
                    "Le nouveau-n√© a une immaturit√© r√©nale",
                    "Le nouveau-n√© a une immaturit√© h√©patique",
                    "Le nouveau-n√© a une immaturit√© endocrinienne",
                    "Le nouveau-n√© n'a aucune immunit√©"
                ],
                correct: [0, 1],
                explanation: "Le nouveau-n√© a une immaturit√© r√©nale et h√©patique, mais il a une maturit√© endocrinienne et une immunit√© h√©rit√©e de la m√®re."
            },
            {
                type: "qcm",
                question: "Concernant le vieillissement, quelles affirmations sont VRAIES ?",
                options: [
                    "La m√©nopause accro√Æt le risque cardio-vasculaire et l'ost√©oporose",
                    "On parle de vieillesse √† partir de 65 ans d'apr√®s l'OMS",
                    "La diminution de l'audition s'appelle la presbyacousie",
                    "La mort est provoqu√©e le plus fr√©quemment par l'insuffisance cardiaque"
                ],
                correct: [0, 1, 2],
                explanation: "Toutes sont vraies sauf la derni√®re : le cancer est la cause de mort la plus fr√©quente, pas l'insuffisance cardiaque."
            },
            {
                type: "fill",
                question: "L'eau repr√©sente environ ___% du poids corporel d'un adulte.",
                answer: "60",
                explanation: "L'eau repr√©sente 60% du poids corporel chez l'adulte (contre 80% chez le nouveau-n√©)."
            },
            {
                type: "fill",
                question: "Le liquide intracellulaire (LIC) repr√©sente ___% de l'eau totale du corps.",
                answer: "67",
                explanation: "Le LIC repr√©sente 67% de l'eau totale, tandis que le LEC en repr√©sente 33%."
            },
            {
                type: "fill",
                question: "La fr√©quence respiratoire du nouveau-n√© est d'environ ___ par minute.",
                answer: "40",
                explanation: "Le nouveau-n√© a une fr√©quence respiratoire de 40/min contre 12-20/min chez l'adulte."
            },
            {
                type: "matching",
                question: "Associez chaque terme √† sa d√©finition correcte",
                pairs: [
                    { term: "Zygote", definition: "≈íuf f√©cond√©" },
                    { term: "Nidation", definition: "Implantation de l'embryon dans l'ut√©rus" },
                    { term: "Organog√©n√®se", definition: "Diff√©rentiation cellulaire et apparition des organes" },
                    { term: "Placenta", definition: "Organe √† l'interface entre le b√©b√© et la m√®re" },
                    { term: "M√©conium", definition: "Ce que produit le f≈ìtus en ing√©rant du liquide amniotique" }
                ],
                explanation: "Ces termes sont essentiels pour comprendre les √©tapes du d√©veloppement embryonnaire et f≈ìtal."
            },
            {
                type: "matching",
                question: "Associez chaque terme physiologique √† sa d√©finition",
                pairs: [
                    { term: "Kali√©mie", definition: "Taux de potassium dans le sang" },
                    { term: "Thermog√©n√®se", definition: "Production de chaleur" },
                    { term: "Thermolyse", definition: "√âvacuation de chaleur" },
                    { term: "Glyc√©mie", definition: "Concentration de sucre dans le sang" },
                    { term: "Osmor√©cepteurs", definition: "D√©tectent la variation d'osmolarit√©" }
                ],
                explanation: "Ces termes sont fondamentaux pour comprendre l'hom√©ostasie et la r√©gulation physiologique."
            },
            {
                type: "matching",
                question: "Associez les organes lympho√Ødes √† leur r√¥le",
                pairs: [
                    { term: "Thymus", definition: "Organe lympho√Øde primaire - maturation des lymphocytes T" },
                    { term: "Moelle osseuse", definition: "Organe lympho√Øde primaire - maturation des lymphocytes B" },
                    { term: "Ganglions lymphatiques", definition: "Organe lympho√Øde secondaire - activation des lymphocytes" },
                    { term: "Rate", definition: "Organe lympho√Øde secondaire - filtre le sang" }
                ],
                explanation: "Les organes primaires permettent la maturation, les organes secondaires permettent l'activation des lymphocytes."
            },
            {
                type: "qcm",
                question: "Quelles sont les composantes du LEC (Liquide ExtraCellulaire) ?",
                options: [
                    "Le liquide intracellulaire",
                    "Le liquide interstitiel",
                    "Le plasma",
                    "Le cytoplasme"
                ],
                correct: [1, 2],
                explanation: "Le LEC est compos√© du liquide interstitiel et du plasma. Il repr√©sente l'environnement interne et 33% de l'eau totale."
            },
            {
                type: "fill",
                question: "Les 3 composants de l'hom√©ostasie sont : le capteur, le ___ de contr√¥le, et l'effecteur.",
                answer: "centre",
                explanation: "L'hom√©ostasie fonctionne avec un capteur/r√©cepteur, un centre de contr√¥le, et un effecteur."
            },
            {
                type: "qcm",
                question: "Concernant l'immunit√© non sp√©cifique, quelles affirmations sont correctes ?",
                options: [
                    "Elle est inn√©e",
                    "C'est la 1√®re ligne de d√©fense",
                    "Elle implique la phagocytose",
                    "Elle produit des anticorps sp√©cifiques"
                ],
                correct: [0, 1, 2],
                explanation: "L'immunit√© non sp√©cifique est inn√©e, constitue la 1√®re ligne de d√©fense et utilise la phagocytose. Les anticorps sp√©cifiques sont produits par l'immunit√© sp√©cifique (acquise)."
            },
            {
                type: "fill",
                question: "L'arr√™t d√©finitif du fonctionnement des ovaires s'appelle la ___.",
                answer: "m√©nopause",
                explanation: "La m√©nopause correspond √† l'arr√™t d√©finitif du fonctionnement des ovaires (plus de s√©cr√©tions d'ovules et plus de production d'≈ìstrog√®nes)."
            },
            {
                type: "qcm",
                question: "Les 3 phases chronologiques de l'accouchement sont :",
                options: [
                    "Dilatation du col, Expulsion du f≈ìtus, D√©livrance (expulsion du placenta)",
                    "Dilatation du col, D√©livrance, Expulsion du f≈ìtus",
                    "Expulsion du f≈ìtus, Dilatation du col, D√©livrance",
                    "Contractions, Expulsion, D√©livrance"
                ],
                correct: [0],
                explanation: "L'ordre correct est : 1. Dilatation du col, 2. Expulsion du f≈ìtus, 3. D√©livrance (expulsion du placenta)."
            },
            {
                type: "matching",
                question: "Associez les param√®tres physiologiques au nouveau-n√©",
                pairs: [
                    { term: "Fr√©quence respiratoire", definition: "40/min" },
                    { term: "Masse hydrique", definition: "80%" },
                    { term: "Fr√©quence cardiaque", definition: "120-180/min" },
                    { term: "Pression art√©rielle", definition: "70 mmHg" }
                ],
                explanation: "Ces valeurs sont significativement diff√©rentes de celles de l'adulte et refl√®tent l'adaptation n√©onatale."
            }
        ];

        // √âTAT DE L'APPLICATION
        let currentMode = 'flashcards';
        let currentCardIndex = 0;
        let filteredCards = [];
        let isFlipped = false;
        let cardProgress = {};

        // Initialisation au chargement
        window.onload = function() {
            initializeProgress();
            updateStats();
            filterCards('all', null);
            generateTest();
            // Activer manuellement le premier bouton de filtre
            document.querySelector('.filter-btn').classList.add('active');
        };

        // GESTION DES MODES
        function switchMode(mode, element) {
            currentMode = mode;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }
            
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            
            if (mode === 'flashcards') {
                document.getElementById('flashcards-section').classList.add('active');
            } else {
                document.getElementById('test-section').classList.add('active');
            }
        }

        // INITIALISATION DE LA PROGRESSION
        function initializeProgress() {
            const saved = localStorage.getItem('td2_progress');
            if (saved) {
                cardProgress = JSON.parse(saved);
            } else {
                flashcardsData.forEach((card, index) => {
                    cardProgress[index] = {
                        status: 'new',
                        reviewCount: 0
                    };
                });
                saveProgress();
            }
        }

        // SAUVEGARDE DE LA PROGRESSION
        function saveProgress() {
            localStorage.setItem('td2_progress', JSON.stringify(cardProgress));
        }

        // MISE √Ä JOUR DES STATISTIQUES
        function updateStats() {
            let total = flashcardsData.length;
            let acquired = 0;
            let review = 0;
            let notAcquired = 0;
            let newCards = 0;

            Object.values(cardProgress).forEach(progress => {
                switch(progress.status) {
                    case 'acquired': acquired++; break;
                    case 'review': review++; break;
                    case 'not-acquired': notAcquired++; break;
                    case 'new': newCards++; break;
                }
            });

            document.getElementById('total-cards').textContent = total;
            document.getElementById('acquired-cards').textContent = acquired;
            document.getElementById('review-cards').textContent = review;
            document.getElementById('not-acquired-cards').textContent = notAcquired;
            document.getElementById('new-cards').textContent = newCards;

            // Mise √† jour barre de progression
            const progress = filteredCards.length > 0 ? 
                ((currentCardIndex + 1) / filteredCards.length * 100).toFixed(0) : 0;
            const progressBar = document.getElementById('progress-bar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = progress + '%';
        }

        // FILTRAGE DES CARTES
        function filterCards(filter, element) {
            document.querySelectorAll('.filter-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            if (element) {
                element.classList.add('active');
            }

            filteredCards = [];
            flashcardsData.forEach((card, index) => {
                const status = cardProgress[index].status;
                
                if (filter === 'all' || 
                    filter === status ||
                    (filter === 'review' && (status === 'review' || status === 'not-acquired'))) {
                    filteredCards.push(index);
                }
            });

            currentCardIndex = 0;
            displayCurrentCard();
            updateStats();
        }

        // AFFICHAGE DE LA CARTE ACTUELLE
        function displayCurrentCard() {
            const container = document.getElementById('flashcard-display');
            
            if (filteredCards.length === 0) {
                container.innerHTML = `
                    <div class="no-cards-message">
                        <h3>üì≠ Aucune carte dans cette cat√©gorie</h3>
                        <p>S√©lectionnez un autre filtre pour continuer l'apprentissage.</p>
                    </div>
                `;
                return;
            }

            const cardIndex = filteredCards[currentCardIndex];
            const card = flashcardsData[cardIndex];
            isFlipped = false;

            container.innerHTML = `
                <div class="flashcard-container">
                    <div class="flashcard" id="current-flashcard" onclick="flipCard()">
                        <div class="card-face card-front">
                            <div class="card-category">${card.category}</div>
                            <div class="card-question">${card.question}</div>
                            <p style="margin-top: 30px; font-size: 0.9em; opacity: 0.8;">
                                Cliquez pour voir la r√©ponse
                            </p>
                        </div>
                        <div class="card-face card-back">
                            <div class="card-category">${card.category}</div>
                            <div class="card-answer">${formatAnswer(card.answer)}</div>
                        </div>
                    </div>
                </div>

                <div class="evaluation-buttons">
                    <button class="eval-btn acquired" onclick="evaluateCard('acquired')">
                        ‚úÖ Acquis
                    </button>
                    <button class="eval-btn review" onclick="evaluateCard('review')">
                        ‚ö†Ô∏è √Ä revoir
                    </button>
                    <button class="eval-btn not-acquired" onclick="evaluateCard('not-acquired')">
                        ‚ùå Non acquis
                    </button>
                </div>

                <div class="navigation-buttons">
                    <button class="nav-btn" onclick="previousCard()" ${currentCardIndex === 0 ? 'disabled' : ''}>
                        ‚óÄ Pr√©c√©dent
                    </button>
                    <span style="color: white; font-weight: bold;">
                        ${currentCardIndex + 1} / ${filteredCards.length}
                    </span>
                    <button class="nav-btn" onclick="nextCard()" ${currentCardIndex >= filteredCards.length - 1 ? 'disabled' : ''}>
                        Suivant ‚ñ∂
                    </button>
                </div>
            `;

            updateStats();
        }

        // FORMATAGE DE LA R√âPONSE
        function formatAnswer(answer) {
            if (answer.includes('\n')) {
                const lines = answer.split('\n');
                return '<ul>' + lines.map(line => '<li>' + line + '</li>').join('') + '</ul>';
            }
            return answer;
        }

        // RETOURNER LA CARTE
        function flipCard() {
            const card = document.getElementById('current-flashcard');
            card.classList.toggle('flipped');
            isFlipped = !isFlipped;
        }

        // √âVALUATION DE LA CARTE
        function evaluateCard(status) {
            const cardIndex = filteredCards[currentCardIndex];
            
            if (status === 'acquired') {
                cardProgress[cardIndex].status = 'acquired';
                cardProgress[cardIndex].reviewCount = 0;
            } else if (status === 'review') {
                cardProgress[cardIndex].status = 'review';
                cardProgress[cardIndex].reviewCount = 1;
            } else if (status === 'not-acquired') {
                cardProgress[cardIndex].status = 'not-acquired';
                cardProgress[cardIndex].reviewCount = 3;
            }

            saveProgress();
            nextCard();
        }

        // CARTE SUIVANTE
        function nextCard() {
            if (currentCardIndex < filteredCards.length - 1) {
                currentCardIndex++;
                displayCurrentCard();
            }
        }

        // CARTE PR√âC√âDENTE
        function previousCard() {
            if (currentCardIndex > 0) {
                currentCardIndex--;
                displayCurrentCard();
            }
        }

        // EXPORT DE LA PROGRESSION
        function exportProgress() {
            const dataStr = JSON.stringify(cardProgress, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'td2_ue25_progression.json';
            link.click();
            URL.revokeObjectURL(url);
        }

        // IMPORT DE LA PROGRESSION
        function importProgress(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        cardProgress = JSON.parse(e.target.result);
                        saveProgress();
                        updateStats();
                        displayCurrentCard();
                        alert('‚úÖ Progression import√©e avec succ√®s !');
                    } catch (error) {
                        alert('‚ùå Erreur lors de l\'import du fichier');
                    }
                };
                reader.readAsText(file);
            }
        }

        // R√âINITIALISATION
        function resetProgress() {
            if (confirm('‚ö†Ô∏è √ätes-vous s√ªr de vouloir r√©initialiser toute votre progression ?')) {
                flashcardsData.forEach((card, index) => {
                    cardProgress[index] = {
                        status: 'new',
                        reviewCount: 0
                    };
                });
                saveProgress();
                updateStats();
                displayCurrentCard();
                alert('‚úÖ Progression r√©initialis√©e !');
            }
        }

        // G√âN√âRATION DU TEST
        function generateTest() {
            const container = document.getElementById('test-questions');
            let html = '';

            testQuestions.forEach((q, index) => {
                html += `<div class="question-block" id="question-${index}">`;
                html += `<div class="question-type">${getQuestionTypeName(q.type)}</div>`;
                html += `<div class="question-title">${index + 1}. ${q.question}</div>`;

                if (q.type === 'qcm') {
                    html += '<div class="options">';
                    q.options.forEach((option, i) => {
                        html += `
                            <label class="option">
                                <input type="checkbox" name="q${index}" value="${i}">
                                <span>${option}</span>
                            </label>
                        `;
                    });
                    html += '</div>';
                } else if (q.type === 'fill') {
                    html += `<input type="text" class="fill-input" id="fill-${index}" placeholder="Votre r√©ponse...">`;
                } else if (q.type === 'matching') {
                    html += '<div class="matching-container">';
                    q.pairs.forEach((pair, i) => {
                        html += `
                            <div class="matching-item">
                                <strong>${pair.term}</strong>
                                <select class="matching-select" id="match-${index}-${i}">
                                    <option value="">-- Choisir --</option>
                                    ${q.pairs.map((p, j) => `<option value="${j}">${p.definition}</option>`).join('')}
                                </select>
                            </div>
                        `;
                    });
                    html += '</div>';
                }

                html += `<div class="explanation" id="explanation-${index}">${q.explanation}</div>`;
                html += '</div>';
            });

            container.innerHTML = html;
        }

        function getQuestionTypeName(type) {
            switch(type) {
                case 'qcm': return '‚òëÔ∏è QCM';
                case 'fill': return '‚úèÔ∏è √Ä compl√©ter';
                case 'matching': return 'üîó Appariement';
                default: return 'Question';
            }
        }

        // SOUMISSION DU TEST
        function submitTest() {
            let score = 0;
            let totalPoints = 0;

            testQuestions.forEach((q, index) => {
                totalPoints++;
                const explanationDiv = document.getElementById(`explanation-${index}`);
                if (explanationDiv) {
                    explanationDiv.classList.add('show');
                }

                if (q.type === 'qcm') {
                    const selected = Array.from(document.querySelectorAll(`input[name="q${index}"]:checked`))
                        .map(input => parseInt(input.value));
                    
                    const isCorrect = arraysEqual(selected.sort(), q.correct.sort());
                    if (isCorrect) score++;

                    document.querySelectorAll(`input[name="q${index}"]`).forEach((input, i) => {
                        const option = input.closest('.option');
                        if (option) {
                            if (q.correct.includes(i)) {
                                option.classList.add('correct');
                            } else if (selected.includes(i)) {
                                option.classList.add('incorrect');
                            }
                        }
                    });
                } else if (q.type === 'fill') {
                    const input = document.getElementById(`fill-${index}`);
                    if (input) {
                        const userAnswer = input.value.trim().toLowerCase();
                        const correctAnswer = q.answer.toLowerCase();
                        
                        if (userAnswer === correctAnswer) {
                            score++;
                            input.classList.add('correct');
                        } else {
                            input.classList.add('incorrect');
                        }
                    }
                } else if (q.type === 'matching') {
                    let allCorrect = true;
                    q.pairs.forEach((pair, i) => {
                        const select = document.getElementById(`match-${index}-${i}`);
                        if (select && parseInt(select.value) !== i) {
                            allCorrect = false;
                        }
                    });
                    if (allCorrect) score++;
                }
            });

            const percentage = (score / totalPoints * 100).toFixed(0);
            displayTestResult(percentage, score, totalPoints);
        }

        function arraysEqual(a, b) {
            return a.length === b.length && a.every((val, i) => val === b[i]);
        }

        // AFFICHAGE DU R√âSULTAT
        function displayTestResult(percentage, score, total) {
            const resultDiv = document.getElementById('test-result');
            resultDiv.classList.add('show');

            let resultClass = '';
            let message = '';

            if (percentage >= 90) {
                resultClass = 'excellent';
                message = 'üèÜ Excellent ! Vous ma√Ætrisez parfaitement le sujet !';
            } else if (percentage >= 70) {
                resultClass = 'good';
                message = 'üëç Tr√®s bien ! Quelques points √† revoir mais c\'est solide !';
            } else if (percentage >= 50) {
                resultClass = 'average';
                message = 'üìö Pas mal, mais il faut encore r√©viser certains points.';
            } else {
                resultClass = 'poor';
                message = 'üí™ Courage ! Reprenez les flashcards pour mieux assimiler.';
            }

            resultDiv.className = `test-result show ${resultClass}`;
            resultDiv.innerHTML = `
                <h3>${message}</h3>
                <div class="score-display">${percentage}%</div>
                <p>Score : ${score}/${total}</p>
                <button class="retry-btn" onclick="retryTest()">üîÑ Refaire le test</button>
            `;

            resultDiv.scrollIntoView({ behavior: 'smooth' });
        }

        // RECOMMENCER LE TEST
        function retryTest() {
            document.querySelectorAll('.option').forEach(opt => {
                opt.classList.remove('correct', 'incorrect');
            });
            document.querySelectorAll('.fill-input').forEach(input => {
                input.classList.remove('correct', 'incorrect');
                input.value = '';
            });
            document.querySelectorAll('input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
            });
            document.querySelectorAll('.matching-select').forEach(select => {
                select.value = '';
            });
            document.querySelectorAll('.explanation').forEach(exp => {
                exp.classList.remove('show');
            });
            document.getElementById('test-result').classList.remove('show');
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }
    </script>
</body>
</html>