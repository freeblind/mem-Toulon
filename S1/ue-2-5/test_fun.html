<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Le Test du For√ßat ‚Äî Physiologie Autonome (Fun+)</title>
  <style>
    :root{
      --bg:#1a1a1a; --fg:#e0e0e0; --card:#2c2c2c; --accent:#ff4500; --accent-2:#32cd32;
      --muted:#888; --danger:#ff6b6b; --ok:#3ddc84; --shadow:rgba(255,69,0,.50);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji","Segoe UI Emoji";
    }
    /* THEMES ‚Äî switch by adding body class .theme-XYZ */
    body.theme-forge { --bg:#111; --card:#242424; --accent:#ff4500; --shadow:rgba(255,69,0,.55); --fg:#eee;}
    body.theme-cyber { --bg:#0b1220; --card:#0f1c33; --accent:#00e0ff; --shadow:rgba(0,224,255,.55); --fg:#e5f6ff;}
    body.theme-chalk { --bg:#1e2b1e; --card:#223722; --accent:#e7e78a; --shadow:rgba(231,231,138,.45); --fg:#fafbf5;}
    body.theme-parch { --bg:#2b261f; --card:#3a3228; --accent:#f1c27d; --shadow:rgba(241,194,125,.45); --fg:#f7f0e6;}
    body.theme-arcade { --bg:#0d0d0d; --card:#161616; --accent:#ff00ff; --shadow:rgba(255,0,255,.45); --fg:#f0eaff;}
    /* Base */
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:24px;
      background: radial-gradient(1200px 600px at 10% -10%, var(--shadow) 0, transparent 60%),
                  radial-gradient(1200px 600px at 110% 120%, var(--shadow) 0, transparent 60%),
                  var(--bg);
      color:var(--fg);
      font-family:var(--sans);
      line-height:1.6;
    }
    .container{
      max-width: 920px; margin: 24px auto; padding: 24px;
      background: var(--card); border:2px solid var(--accent);
      border-radius:18px; box-shadow:0 0 24px var(--shadow);
      animation: pop .25s ease-out;
    }
    @keyframes pop { from { transform: scale(.98); opacity:.8 } to { transform: scale(1); opacity:1 } }
    h1{ margin:0 0 16px; text-align:center; letter-spacing:.5px }
    .sub{ text-align:center; color:var(--muted); margin-bottom:18px; font-size:.95rem }
    .hud{
      display:grid; grid-template-columns: repeat(4, minmax(120px,1fr)); gap:8px; margin: 0 0 16px;
    }
    .hud .tile{
      background:#0003; border:1px solid #fff2; border-radius:12px; padding:10px 12px;
      display:flex; align-items:center; justify-content:space-between;
      font-family:var(--mono); font-size:.95rem;
    }
    .status{ margin: 6px 0 16px; padding:10px 12px; background:#0003; border-left:4px solid var(--accent); border-radius:10px }
    .question{ padding:16px; background:#0004; border:1px solid #fff2; border-radius:14px }
    .question h2{ margin:0 0 6px; font-size:1.15rem }
    .prompt{ margin: 8px 0 12px }
    .options label{
      display:block; margin:6px 0; padding:10px 12px; border:1px solid #fff2; border-radius:10px; cursor:pointer;
      transition: transform .08s ease, background .2s ease, border-color .2s ease;
      user-select:none;
    }
    .options label:hover{ transform: translateX(2px); border-color:var(--accent) }
    input[type="radio"], input[type="checkbox"]{ margin-right:10px }
    input[type="text"]{
      width:100%; padding:10px 12px; border-radius:10px; border:1px solid #fff2; background:#0003; color:var(--fg);
      font-size:1rem;
    }
    select{
      padding:10px 12px; border-radius:10px; border:1px solid #fff2; background:#0003; color:var(--fg);
    }
    .btn{
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border:1px solid var(--accent); background:transparent; color:var(--fg);
      border-radius:12px; cursor:pointer; margin-top:12px; font-weight:600;
      transition: background .2s ease, transform .06s ease;
    }
    .btn:hover{ background:var(--accent); color:#000; }
    .btn:active{ transform: scale(.98) }
    .feedback{ display:none; margin-top:12px; padding:12px; border-radius:12px; font-weight:600 }
    .correct{ background: #083e2c; border:1px solid #0aa56f }
    .incorrect{ background: #3e0c0c; border:1px solid #a50a0a }
    .big{ font-size:1.1rem; margin-bottom:6px }
    .sr-only{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); white-space:nowrap; border:0 }
    /* confetti-ish */
    .confetti{ pointer-events:none; position:fixed; inset:0; overflow:hidden }
    .confetti b{ position:absolute; width:6px; height:12px; background:currentColor; top:-20px; opacity:.9 }
    /* tiny wiggle for wrong */
    .wiggle{ animation: wig .25s ease-in-out 2 }
    @keyframes wig { 0%{transform:translateX(0)} 25%{transform:translateX(-4px)} 50%{transform:translateX(4px)} 75%{transform:translateX(-2px)} 100%{transform:translateX(0)} }
  </style>
</head>
<body class="theme-forge">
  <div class="container" id="app">
    <h1>Le Test du For√ßat ‚Äî Physiologie (UE 2.5 S1)</h1>
    <div class="sub" id="status-message">Affronte la question. R√©ussis ‚ñ∂ passe √† la suivante ; √©choue ‚ñ∂ r√©essaie.</div>

    <div class="hud" aria-live="polite">
      <div class="tile"><span>Question</span><strong id="hud-q">1</strong></div>
      <div class="tile"><span>R√©ussites</span><strong id="hud-ok">0</strong></div>
      <div class="tile"><span>S√©rie</span><strong id="hud-streak">0</strong></div>
      <div class="tile"><span>Record</span><strong id="hud-best">0</strong></div>
    </div>

    <div id="question-area"></div>
  </div>

  <div class="confetti" id="confetti" aria-hidden="true"></div>

  <script>
    // ====== Banque de questions (reprend, puis √©tend celles du fichier initial) ======
    const allQuestions = [
      { id:'q1', type:'vf', title:"√âpreuve V/F : Les Cycles de la Vie",
        prompt:"La <strong>d√©livrance</strong> est l'expulsion du f≈ìtus.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. La d√©livrance est l'expulsion du <strong>placenta</strong>. Le f≈ìtus, c'est l'Expulsion."
      },
      { id:'q2', type:'qcm', title:"√âpreuve du Jugement : Hom√©ostasie",
        prompt:"Quel est le <strong>r√¥le</strong> principal de la <strong>r√©tro‚Äëinhibition</strong> (r√©troaction n√©gative) ?",
        options:[
          "Maintenir l'hom√©ostasie par une r√©ponse qui amplifie le mouvement d'une variable.",
          "Diminuer le stimulus de d√©part pour ramener la variable √† l'√©tat de base.",
          "Permettre l'√©limination des d√©chets m√©taboliques vers le sang veineux.",
          "D√©clencher la s√©cr√©tion d'ocytocine lors de l'accouchement"
        ],
        answer:"Diminuer le stimulus de d√©part pour ramener la variable √† l'√©tat de base.",
        correction:"La r√©tro‚Äëinhibition <strong>diminue le stimulus de d√©part</strong> pour ramener la variable vers la consigne."
      },
      { id:'q3', type:'qcm', title:"√âpreuve du Syst√®me de D√©fense : Les Troupes Primaires",
        prompt:"Quels sont les <strong>deux organes lympho√Ødes primaires</strong> o√π se fait la maturation des lymphocytes ?",
        options:["Ganglions lympho√Ødes et Rate.","Amygdales et V√©g√©tations.","Thymus et Moelle Osseuse.","Placenta et Thymus."],
        answer:"Thymus et Moelle Osseuse.",
        correction:"Les organes lympho√Ødes primaires sont le <strong>Thymus</strong> et la <strong>Moelle osseuse</strong>."
      },
      { id:'q4', type:'text', title:"√âpreuve de Pr√©cision : D√©finition",
        prompt:"Nomme le terme d√©signant le <strong>taux de potassium sanguin</strong> (un seul mot).",
        answer:"Kali√©mie",
        accepted:["kaliemie","kali√©mies","kaliemies"],
        correction:"Le terme est <strong>Kali√©mie</strong>."
      },
      // ‚úÖ FIX HOM√âOSTASIE ‚Äî accepter n'importe lequel des 3 composants avec synonymes
      { id:'q5', type:'text', title:"√âpreuve de Pr√©cision : L'Hom√©ostasie",
        prompt:"Cite l'un des <strong>trois composants</strong> de l'hom√©ostasie (un seul mot ou groupe court).",
        // answer is kept for backward compat but accepted[] drives the logic
        answer:"capteur/r√©cepteur/centre de contr√¥le/effecteur",
        accepted:[
          // capteur / r√©cepteur
          "capteur","capteurs","recepteur","recepteurs","r√©cepteur","r√©cepteurs","sensor","senseur","senseurs",
          // centre int√©grateur / centre de contr√¥le
          "centre de controle","centre de contr√¥le","centre integrateur","centre int√©grateur","integrateur","int√©grateur",
          "centre regulateur","centre r√©gulateur","commande","centre de commande",
          // effecteur(s)
          "effecteur","effecteurs","effectrice","effectrices"
        ],
        correction:"Les trois composants sont : <strong>capteur (r√©cepteur)</strong>, <strong>centre int√©grateur / de contr√¥le</strong>, <strong>effecteur</strong>."
      },
      { id:'q6', type:'vf', title:"√âpreuve V/F : Le Nouveau‚Äën√©",
        prompt:"Le nouveau‚Äën√© n'a <strong>aucune immunit√©</strong>.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Immunit√© passive maternelle : placenta + colostrum."
      },
      { id:'q7', type:'select-match', title:"√âpreuve d'Appariement : Les Fluides (Simul√©)",
        prompt:"Associe correctement la quantit√© d'eau au corps :",
        labels:["Masse hydrique d‚Äôun ADULTE","Masse hydrique d‚Äôun NOUVEAU‚ÄëN√â"],
        options:["60 %","80 %","70 %","120-180"],
        answers:["60 %","80 %"],
        correction:"Adulte ‚âà <strong>60%</strong> ; Nouveau‚Äën√© ‚âà <strong>80%</strong>."
      },
      // V/F CM
      { id:'q8', type:'vf', title:"√âpreuve V/F : D√©veloppement",
        prompt:"La <strong>my√©linisation</strong> du f≈ìtus est compl√®te.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Elle est <strong>incompl√®te</strong>."
      },
      { id:'q9', type:'vf', title:"√âpreuve V/F : F≈ìtus et Colostrum",
        prompt:"Le f≈ìtus ing√®re du liquide amniotique et produit du <strong>colostrum</strong>.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Il produit du <strong>m√©conium</strong>. Le colostrum = lait maternel initial."
      },
      { id:'q10', type:'vf', title:"√âpreuve V/F : Accouchement",
        prompt:"Phases : dilatation du col ‚Üí expulsion du placenta ‚Üí expulsion du f≈ìtus.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Ordre : dilatation ‚Üí <strong>expulsion du f≈ìtus</strong> ‚Üí <strong>d√©livrance (placenta)</strong>."
      },
      { id:'q11', type:'vf', title:"√âpreuve V/F : Nouveau‚Äën√© et Glandes",
        prompt:"Le nouveau‚Äën√© a une <strong>immaturit√©</strong> endocrinienne.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Il a une <strong>maturit√©</strong> endocrinienne."
      },
      { id:'q12', type:'vf', title:"√âpreuve V/F : Besoins du NN",
        prompt:"Besoin accru en <strong>magn√©sium et vitamine C</strong>.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Besoin accru en <strong>fer</strong> et <strong>vitamine D</strong>."
      },
      { id:'q13', type:'vf', title:"√âpreuve V/F : M√©nopause",
        prompt:"La m√©nopause = arr√™t d√©finitif du fonctionnement de l‚Äô<strong>ut√©rus</strong>.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Arr√™t du fonctionnement des <strong>ovaires</strong>."
      },
      { id:'q14', type:'vf', title:"√âpreuve V/F : Dosage",
        prompt:"Le dosage <strong>Œ≤‚ÄëHCG</strong> permet de diagnostiquer le diab√®te.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Œ≤‚ÄëHCG affirme la <strong>grossesse</strong>."
      },
      { id:'q15', type:'vf', title:"√âpreuve V/F : G√©riatrie vs G√©rontologie",
        prompt:"La <strong>g√©riatrie</strong> √©tudie le vieillissement sous tous ses aspects.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. C'est la <strong>g√©rontologie</strong>."
      },
      { id:'q16', type:'vf', title:"√âpreuve V/F : Causes de Mort",
        prompt:"Cause la plus fr√©quente : <strong>insuffisance cardiaque</strong>.",
        options:{ VRAI:false, FAUX:true },
        correction:"FAUX. Le <strong>cancer</strong> est la cause la plus fr√©quente."
      },
      // QCM
      { id:'q17', type:'qcm', title:"√âpreuve du Jugement : L'Eau et l'Adulte",
        prompt:"L'eau repr√©sente environ combien du poids corporel d'un adulte ?",
        options:["75 %", "60 %"], answer:"60 %",
        correction:"Environ <strong>60%</strong>."
      },
      { id:'q18', type:'qcm', title:"√âpreuve du Jugement : R√©partition de l'Eau",
        prompt:"L'eau se r√©partit dans l'organisme en combien de secteurs ?",
        options:["2 secteurs", "3 secteurs"], answer:"3 secteurs",
        correction:"<strong>3</strong> secteurs : LIC, LEC, plasma."
      },
      { id:'q19', type:'qcm', title:"√âpreuve du Jugement : Volume Intracellulaire",
        prompt:"Le LIC repr√©sente combien de l'eau totale du corps ?",
        options:["33 %","67 %"], answer:"67 %",
        correction:"Le LIC ‚âà <strong>67%</strong>."
      },
      { id:'q20', type:'qcm', title:"√âpreuve du Jugement : Environnement Interne",
        prompt:"L'environnement interne correspond au...",
        options:["LEC (Liquide ExtraCellulaire)","LIC (Liquide IntraCellulaire)"],
        answer:"LEC (Liquide ExtraCellulaire)",
        correction:"Environnement interne = <strong>LEC</strong>."
      },
      // D√©finitions (texte)
      { id:'q21', type:'text', title:"√âpreuve de Pr√©cision : P√©riode de Vie",
        prompt:"P√©riode de l'≈ìuf f√©cond√© √† la fin de la <strong>8·µâ semaine</strong> (un mot).",
        answer:"Embryog√©n√®se",
        accepted:["embryogenese","embryogen√®se"],
        correction:"<strong>Embryog√©n√®se</strong>."
      },
      { id:'q22', type:'text', title:"√âpreuve de Pr√©cision : Anatomie F≈ìtale",
        prompt:"Organe interface m√®re‚Äìb√©b√© (un mot).",
        answer:"Placenta", accepted:["placenta","placentas"],
        correction:"<strong>Placenta</strong>."
      },
      { id:'q23', type:'text', title:"√âpreuve de Pr√©cision : R√©gulation",
        prompt:"R√©gulation de la temp√©rature corporelle (un mot).",
        answer:"Thermor√©gulation", accepted:["thermoregulation","thermor√©gulation"],
        correction:"<strong>Thermor√©gulation</strong>."
      },
      { id:'q24', type:'text', title:"√âpreuve de Pr√©cision : Chaleur",
        prompt:"Production de chaleur (un mot).",
        answer:"Thermog√©n√®se", accepted:["thermogenese","thermog√©n√®se"],
        correction:"<strong>Thermog√©n√®se</strong>."
      },
      { id:'q25', type:'text', title:"√âpreuve de Pr√©cision : Capteur",
        prompt:"Capteur d√©tectant la variation d'osmolarit√© (pluriel, un mot).",
        answer:"Osmor√©cepteurs", accepted:["osmorecepteurs","osmor√©cepteurs"],
        correction:"<strong>Osmor√©cepteurs</strong>."
      }
    ];

    // ====== √âtat / HUD ======
    let asked = 0, ok = 0, streak = 0, best = 0;
    const hudQ = document.getElementById('hud-q');
    const hudOk = document.getElementById('hud-ok');
    const hudStreak = document.getElementById('hud-streak');
    const hudBest = document.getElementById('hud-best');

    const questionArea = document.getElementById('question-area');
    const statusMessage = document.getElementById('status-message');
    const app = document.getElementById('app');
    const confetti = document.getElementById('confetti');

    const themes = ['theme-forge','theme-cyber','theme-chalk','theme-parch','theme-arcade'];

    function setThemeRandom(){
      // remove existing
      themes.forEach(t => document.body.classList.remove(t));
      const pick = themes[Math.floor(Math.random()*themes.length)];
      document.body.classList.add(pick);
    }

    function updateHud(){
      hudQ.textContent = asked;
      hudOk.textContent = ok;
      hudStreak.textContent = streak;
      hudBest.textContent = best;
    }

    // ====== Rendu des types ======
    function buildVF(q){
      let html = '<div class="options">';
      for(const k in q.options){
        html += `<label><input type="radio" name="answer" value="${k}"> ${k}</label>`;
      }
      html += '</div>';
      return html;
    }
    function buildQCM(q){
      return '<div class="options">' + q.options.map(opt =>
        `<label><input type="radio" name="answer" value="${escapeHtml(opt)}"> ${escapeHtml(opt)}</label>`
      ).join('') + '</div>';
    }
    function buildText(q){
      return `<input id="text-answer" type="text" placeholder="Entre le terme‚Ä¶ (casse/accents ignor√©s)">`;
    }
    function buildSelectMatch(q){
      const shuffled = [...q.options].sort(()=>Math.random()-0.5);
      let s = '';
      q.labels.forEach((label, idx)=>{
        s += `<p>${escapeHtml(label)} ‚Üí <select id="match-${idx}"><option value="">‚Äî Choisir ‚Äî</option>`;
        shuffled.forEach(opt => s += `<option value="${escapeHtml(opt)}">${escapeHtml(opt)}</option>`);
        s += `</select></p>`;
      });
      return s;
    }

    function escapeHtml(s){ return s.replace(/[&<>"]/g, ch => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch])) }

    // ====== M√©canique ======
    let current = null;

    function loadRandomQuestion(){
      setThemeRandom(); // üé® varier le style √† chaque nouvelle question
      statusMessage.textContent = "Affronte la question. R√©ussis ‚ñ∂ suivante ; √©choue ‚ñ∂ r√©essaie.";
      current = allQuestions[Math.floor(Math.random()*allQuestions.length)];
      asked++; updateHud();

      const box = document.createElement('div');
      box.className = 'question';
      box.innerHTML = `
        <h2>${current.title}</h2>
        <div class="prompt">${current.prompt}</div>
        <div class="ui">
          ${ current.type==='vf' ? buildVF(current) :
              current.type==='qcm' ? buildQCM(current) :
              current.type==='text' ? buildText(current) :
              current.type==='select-match' ? buildSelectMatch(current) : '' }
        </div>
        <div id="fb-${current.id}" class="feedback" aria-live="polite"></div>
        <button id="btn-check" class="btn" onclick="checkAnswer('${current.id}')">V√©rifier la r√©ponse</button>
      `;
      questionArea.innerHTML = '';
      questionArea.appendChild(box);
      // focus first interactive element
      const first = box.querySelector('input,select,button'); if(first) first.focus();
    }

    function normalize(s){
      return (s||'').toString().trim().toLowerCase()
        .normalize('NFD').replace(/[\u0300-\u036f]/g,'')
        .replace(/\s+/g,' ');
    }

    function checkAnswer(id){
      const q = allQuestions.find(x => x.id===id);
      let correct = false;

      if(q.type==='vf' || q.type==='qcm'){
        const pick = document.querySelector('input[name="answer"]:checked');
        if(!pick){ nudge(); return }
        if(q.type==='vf') correct = !!q.options[pick.value];
        else correct = (pick.value === q.answer);
      }
      else if(q.type==='text'){
        const el = document.getElementById('text-answer');
        const val = normalize(el.value);
        if(!val){ nudge(); return }
        // robust acceptance: prefer q.accepted if provided; otherwise split q.answer on '/'
        const expected = (q.accepted && q.accepted.length ? q.accepted : (q.answer||'').split('/').map(normalize))
          .map(normalize);
        correct = expected.includes(val);
      }
      else if(q.type==='select-match'){
        let okCount=0;
        (q.labels||[]).forEach((_,i)=>{
          const sel = document.getElementById(`match-${i}`);
          if(sel && sel.value === q.answers[i]) okCount++;
        });
        correct = okCount === (q.labels||[]).length;
      }

      renderFeedback(q, correct);
    }

    function nudge(){
      const qbox = questionArea.firstElementChild;
      if(qbox){ qbox.classList.remove('wiggle'); void qbox.offsetWidth; qbox.classList.add('wiggle'); }
    }

    function renderFeedback(q, okNow){
      const fb = document.getElementById(`fb-${q.id}`);
      fb.style.display = 'block';
      if(okNow){
        ok++; streak++; best = Math.max(best, streak); updateHud();
        fb.className = 'feedback correct';
        fb.innerHTML = `<div class="big">‚úîÔ∏è SUCC√àS !</div>${q.correction}`;
        boom();
        setTimeout(loadRandomQuestion, 1200);
      }else{
        streak = 0; updateHud();
        fb.className = 'feedback incorrect';
        fb.innerHTML = `<div class="big">‚ùå √âCHEC ‚Äî R√©essaie</div><div>${q.correction}</div>`;
      }
    }

    // Tiny confetti without deps
    function boom(){
      confetti.innerHTML = '';
      const N = 60;
      for(let i=0;i<N;i++){
        const b = document.createElement('b');
        b.style.left = (Math.random()*100)+'%';
        b.style.color = ['#fff','#ffd166','#06d6a0','#118ab2','#ef476f'][Math.floor(Math.random()*5)];
        const dur = 600 + Math.random()*800;
        const dx = (Math.random()*2-1)*80;
        const delay = Math.random()*80;
        b.animate([
          { transform:`translate(0,-20px) rotate(0deg)` , opacity:1 },
          { transform:`translate(${dx}px, 120vh) rotate(${Math.random()*720-360}deg)`, opacity:.9 }
        ], { duration: dur, easing:'cubic-bezier(.2,.7,.2,1)', delay });
        confetti.appendChild(b);
      }
      setTimeout(()=> confetti.innerHTML='', 1200);
    }

    document.addEventListener('DOMContentLoaded', loadRandomQuestion);
  </script>
</body>
</html>
