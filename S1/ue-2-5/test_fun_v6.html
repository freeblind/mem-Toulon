<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>UE 2.5 S1 ‚Äî Mega Quiz Fun (TD1+TD2)</title>
  <style>
    :root{
      --bg:#121212; --fg:#eee; --card:#1e1e1e; --accent:#ff7a00; --ok:#15d07a; --err:#ff4d4f; --muted:#aaa; --shadow:rgba(255,122,0,.35);
      --mono:ui-monospace,SFMono-Regular,Menlo,Consolas,monospace;
      --sans:system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Cantarell,Noto Sans,Helvetica,Arial;
    }
    body.theme-forge { --bg:#121212; --card:#1e1e1e; --accent:#ff7a00; --shadow:rgba(255,122,0,.35) }
    body.theme-cyber { --bg:#04121f; --card:#0b2438; --accent:#00e0ff; --shadow:rgba(0,224,255,.35) }
    body.theme-chalk { --bg:#152415; --card:#1f3a1f; --accent:#f4f1a6; --shadow:rgba(244,241,166,.35) }
    body.theme-parch { --bg:#2b241b; --card:#3a3025; --accent:#f1c27d; --shadow:rgba(241,194,125,.35) }
    body.theme-arcade { --bg:#0d0d0d; --card:#151515; --accent:#ff00ff; --shadow:rgba(255,0,255,.35) }
    *{box-sizing:border-box}
    body{margin:0;padding:24px;background:
      radial-gradient(800px 500px at -10% -20%, var(--shadow) 0, transparent 60%),
      radial-gradient(900px 600px at 120% 120%, var(--shadow) 0, transparent 60%),
      var(--bg);
      color:var(--fg);font-family:var(--sans); line-height:1.6;
    }
    .wrap{max-width:1000px;margin:0 auto;background:var(--card);border:1px solid #fff2;border-radius:16px;padding:24px;box-shadow:0 8px 24px #0007; position:relative}
    h1{margin:0 0 4px;text-align:center}
    .sub{color:var(--muted);text-align:center;margin:0 0 16px}
    .hud{display:grid;grid-template-columns:repeat(5,1fr);gap:8px;margin:12px 0 16px}
    .tile{background:#0003;border:1px solid #fff2;border-radius:10px;padding:10px 12px;display:flex;justify-content:space-between;align-items:center;font-family:var(--mono)}
    .controls{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
    .btn{padding:10px 14px;border:1px solid var(--accent);border-radius:10px;background:transparent;color:var(--fg);cursor:pointer;font-weight:600}
    .btn:hover{background:var(--accent);color:#000}
    .q{padding:16px;border:1px solid #fff2;border-radius:14px;background:#0003}
    .q h2{margin:0 0 6px}
    .q .prompt{margin:8px 0 12px}
    .options label{display:block;margin:6px 0;padding:10px 12px;border:1px solid #fff2;border-radius:10px;cursor:pointer}
    .options label:hover{border-color:var(--accent)}
    input[type="radio"],input[type="checkbox"]{margin-right:10px}
    input[type="text"]{width:100%;padding:10px 12px;border-radius:10px;border:1px solid #fff2;background:#0003;color:var(--fg)}
    select{padding:10px 12px;border-radius:10px;border:1px solid #fff2;background:#0003;color:var(--fg)}
    .feedback{display:none;margin-top:12px;padding:12px;border-radius:12px;font-weight:700}
    .good{background:#0f3; color:#021; }
    .bad{background:#f33; color:#210; }
    .wiggle{animation:wig .25s ease-in-out 2}
    @keyframes wig{0%{transform:translateX(0)}25%{transform:translateX(-4px)}50%{transform:translateX(4px)}75%{transform:translateX(-2px)}100%{transform:translateX(0)}}
    .small{font-size:.9rem;color:var(--muted)}
    select{
      background:#222; color:#f5f5f5; border:1px solid #ffffff33;
      outline:none;
    }
    select:focus{
      border-color: var(--accent);
      box-shadow: 0 0 0 3px color-mix(in oklab, var(--accent) 40%, transparent);
    }
    option{ background:#2b2b2b; color:#f5f5f5 }
    
    .confetti{ pointer-events:none; position:fixed; inset:0; overflow:hidden }
    .confetti b{ position:absolute; width:6px; height:12px; background:currentColor; top:-20px; opacity:.95 }
    .shout{ font-size:1.3rem; font-weight:900; letter-spacing:.5px; margin-bottom:6px }
  </style>
</head>
<body class="theme-forge">
  <div class="wrap">
    <div class="confetti" id="confetti" aria-hidden="true"></div>
    <h1>UE 2.5 S1 ‚Äî Mega Quiz Fun</h1>
    <p class="sub">TD1 + TD2 (texte uniquement) ‚Äî Click / Coche / √âcris ‚Äî Tout en un.</p>

    <div class="hud" aria-live="polite">
      <div class="tile"><span>Question</span><strong id="hud-q">0</strong></div>
      <div class="tile"><span>Bonnes</span><strong id="hud-ok">0</strong></div>
      <div class="tile"><span>S√©rie</span><strong id="hud-streak">0</strong></div>
      <div class="tile"><span>Record</span><strong id="hud-best">0</strong></div>
      <div class="tile"><span>Banque</span><strong id="hud-bank">0</strong></div>
    </div>

    <div class="controls">
      <button class="btn" id="btn-next">Question suivante</button>
      <button class="btn" id="btn-theme">Changer de th√®me</button>
      <button class="btn" id="btn-sound" aria-pressed="true" aria-label="Couper le son" title="Couper le son">üîä</button>
    </div>

    <div id="qa"></div>
    <p class="small">Astuce : pour les questions ¬´ texte ¬ª, les accents/casse ne comptent pas.</p>
  </div>

  <script>
    // THEME
    const themes=['theme-forge','theme-cyber','theme-chalk','theme-parch','theme-arcade'];
    function cycleTheme(){
      const b=document.body;
      const i = themes.findIndex(t=>b.classList.contains(t));
      themes.forEach(t=>b.classList.remove(t));
      b.classList.add(themes[(i+1)%themes.length]);
    }
    document.getElementById('btn-theme').onclick=cycleTheme;

    // BANK ‚Äî TD2 + TD1 (sch√©mas exclus)
    const BANK = [
      {id:'td2-1',type:'text',title:'D√©finition',prompt:"Gam√®te m√¢le (un mot)",answer:"Spermatozo√Øde",accepted:["spermatozoide","spermatozo√Øde"],correction:"Gam√®te m√¢le = <strong>Spermatozo√Øde</strong>."},
      {id:'td2-2',type:'text',title:'D√©finition',prompt:"Gam√®te femelle (un mot)",answer:"Ovocyte",accepted:["ovocyte","ovule"],correction:"Gam√®te femelle = <strong>Ovocyte</strong>."},
      {id:'td2-3',type:'text',title:'D√©finition',prompt:"≈íuf f√©cond√© (un mot)",answer:"Zygote",accepted:["zygote"],correction:"≈íuf f√©cond√© = <strong>Zygote</strong>."},
      {id:'td2-4',type:'text',title:'D√©finition',prompt:"Implantation de l‚Äôembryon dans l‚Äôut√©rus (un mot)",answer:"Nidation",accepted:["nidation"],correction:"Implantation = <strong>Nidation</strong> (J5‚ÄìJ7)."},
      {id:'td2-5',type:'text',title:'D√©finition',prompt:"P√©riode de l‚Äô≈ìuf f√©cond√© √† la fin de la 8·µâ semaine (un mot)",answer:"Embryog√©n√®se",accepted:["embryogenese","embryog√©n√®se"],correction:"<strong>Embryog√©n√®se</strong>."},
      {id:'td2-6',type:'text',title:'D√©finition',prompt:"Diff√©renciation cellulaire et apparition des organes (un mot)",answer:"Organog√©n√®se",accepted:["organogenese","organog√©n√®se"],correction:"<strong>Organog√©n√®se</strong> (0‚Äì8 sem.)."},
      {id:'td2-7',type:'vf',title:'V/F ‚Äî F≈ìtus',prompt:"La my√©linisation du f≈ìtus est compl√®te.",options:{VRAI:false,FAUX:true},correction:"FAUX : elle est incompl√®te."},
      {id:'td2-8',type:'vf',title:'V/F ‚Äî F≈ìtus',prompt:"Le f≈ìtus produit de l‚Äôurine.",options:{VRAI:true,FAUX:false},correction:"VRAI."},
      {id:'td2-9',type:'vf',title:'V/F ‚Äî F≈ìtus',prompt:"Le f≈ìtus produit du colostrum.",options:{VRAI:false,FAUX:true},correction:"FAUX : il s‚Äôagit du <strong>m√©conium</strong>."},
      {id:'td2-10',type:'qcm',title:"Accouchement ‚Äî Ordre",prompt:"Ordre correct des 3 phases ?",options:["Dilatation ‚Üí Expulsion du f≈ìtus ‚Üí D√©livrance","Dilatation ‚Üí D√©livrance ‚Üí Expulsion du f≈ìtus"],answer:"Dilatation ‚Üí Expulsion du f≈ìtus ‚Üí D√©livrance",correction:"<strong>Dilatation ‚Üí Expulsion du f≈ìtus ‚Üí D√©livrance</strong>."},
      {id:'td2-11',type:'vf',title:'V/F ‚Äî D√©finition',prompt:"La d√©livrance est l‚Äôexpulsion du f≈ìtus.",options:{VRAI:false,FAUX:true},correction:"FAUX : c‚Äôest l‚Äôexpulsion du <strong>placenta</strong>."},
      {id:'td2-12',type:'vf',title:"V/F ‚Äî Besoins du Nouveau-n√©",prompt:"Le nouveau-n√© a un besoin accru en magn√©sium et vitamine C.",options:{VRAI:false,FAUX:true},correction:"FAUX : besoin accru en <strong>fer</strong> et <strong>vitamine D</strong>."},
      {id:'td2-13',type:'vf',title:"V/F ‚Äî Nouveau-n√©",prompt:"Le nouveau-n√© n‚Äôa aucune immunit√©.",options:{VRAI:false,FAUX:true},correction:"FAUX : immunit√© passive maternelle (placenta + colostrum)."},
      {id:'td2-14',type:'select-match',title:"Appariement ‚Äî Param√®tres (Adulte vs Nouveau-n√©)",prompt:"Associe Adultes/Nouveau-n√© :",labels:["Masse hydrique ADULTE","Masse hydrique NOUVEAU-N√â","FC NOUVEAU-N√â (bpm)","PA NOUVEAU-N√â (mmHg)"],options:["60 %","80 %","120-180","70"],answers:["60 %","80 %","120-180","70"],correction:"Adulte ~60% ; Nouveau-n√© ~80% ; FC 120‚Äì180 ; PA ~70 mmHg."},
      {id:'td2-15',type:'vf',title:"V/F ‚Äî M√©nopause",prompt:"La m√©nopause correspond √† l‚Äôarr√™t d√©finitif du fonctionnement de l‚Äôut√©rus.",options:{VRAI:false,FAUX:true},correction:"FAUX : arr√™t des <strong>ovaires</strong>."},
      {id:'td2-16',type:'vf',title:"V/F ‚Äî Œ≤-HCG",prompt:"Le dosage Œ≤-HCG permet de diagnostiquer le diab√®te.",options:{VRAI:false,FAUX:true},correction:"FAUX : il affirme la <strong>grossesse</strong>."},
      {id:'td2-17',type:'vf',title:"V/F ‚Äî Vieillissement",prompt:"La g√©riatrie √©tudie le vieillissement sous tous ses aspects.",options:{VRAI:false,FAUX:true},correction:"FAUX : c‚Äôest la <strong>g√©rontologie</strong>."},
      {id:'td2-18',type:'vf',title:"V/F ‚Äî Sensoriel",prompt:"Diminution audition = presbyacousie ; diminution vue = presbytie.",options:{VRAI:true,FAUX:false},correction:"VRAI."},
      {id:'td2-19',type:'vf',title:"V/F ‚Äî Mort",prompt:"La cause la plus fr√©quente de d√©c√®s est l‚Äôinsuffisance cardiaque.",options:{VRAI:false,FAUX:true},correction:"FAUX : <strong>cancer</strong> le plus fr√©quent."},

      {id:'td2-h1',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"Taux de potassium dans le sang (un mot)",answer:"Kali√©mie",accepted:["kaliemie","kali√©mies","kaliemies"],correction:"<strong>Kali√©mie</strong>."},
      {id:'td2-h2',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"R√©gulation de la temp√©rature corporelle (un mot)",answer:"Thermor√©gulation",accepted:["thermoregulation","thermor√©gulation"],correction:"<strong>Thermor√©gulation</strong>."},
      {id:'td2-h3',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"Production de chaleur (un mot)",answer:"Thermog√©n√®se",accepted:["thermogenese","thermog√©n√®se"],correction:"<strong>Thermog√©n√®se</strong>."},
      {id:'td2-h4',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"√âvacuation de chaleur (un mot)",answer:"Thermolyse",accepted:["thermolyse"],correction:"<strong>Thermolyse</strong>."},
      {id:'td2-h5',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"Capteurs barom√©triques (pluriel)",answer:"Baror√©cepteurs",accepted:["barorecepteurs","baror√©cepteurs"],correction:"<strong>Baror√©cepteurs</strong>."},
      {id:'td2-h6',type:'text',title:'Hom√©ostasie ‚Äî Terme',prompt:"Capteurs d√©tectant la variation d‚Äôosmolarit√© (pluriel)",answer:"Osmor√©cepteurs",accepted:["osmorecepteurs","osmor√©cepteurs"],correction:"<strong>Osmor√©cepteurs</strong>."},
      {id:'td2-h7',type:'qcm',title:'Hom√©ostasie ‚Äî Compartiments',prompt:"L‚Äôeau se r√©partit en combien de <strong>grands compartiments</strong> ?",options:["2","3"],answer:"2",correction:"Deux grands compartiments : <strong>LIC</strong> et <strong>LEC</strong> (LEC = interstitiel + plasma)."},
      {id:'td2-h8',type:'qcm',title:'Hom√©ostasie ‚Äî Part LIC',prompt:"Le LIC repr√©sente ‚Ä¶ de l‚Äôeau totale du corps :",options:["33 %","67 %"],answer:"67 %",correction:"LIC ‚âà <strong>67%</strong>."},
      {id:'td2-h9',type:'qcm',title:'Hom√©ostasie ‚Äî Environnement interne',prompt:"L‚Äôenvironnement interne correspond au ‚Ä¶",options:["LEC","LIC"],answer:"LEC",correction:"Environnement interne = <strong>LEC</strong>."},
      {id:'td2-h10',type:'text',title:'Hom√©ostasie ‚Äî Composants',prompt:"Donne <em>un</em> des trois composants de l‚Äôhom√©ostasie.",answer:"capteur/centre de contr√¥le/effecteur",accepted:["capteur","recepteur","r√©cepteur","centre de controle","centre de contr√¥le","centre integrateur","centre int√©grateur","integrateur","int√©grateur","effecteur","effecteurs"],correction:"Trois composants : capteur (r√©cepteur), centre int√©grateur/de contr√¥le, effecteur."},
      {id:'td2-h11',type:'qcm',title:'R√©tro-inhibition',prompt:"R√¥le principal ?",options:["Amplifier le stimulus","Diminuer le stimulus et ramener √† la consigne"],answer:"Diminuer le stimulus et ramener √† la consigne",correction:"R√©tro-inhibition diminue le stimulus initial."},
      {id:'td2-h12',type:'qcm',title:'R√©tro-activation',prompt:"R√¥le principal ?",options:["Amplifier le stimulus","Diminuer le stimulus"],answer:"Amplifier le stimulus",correction:"R√©tro-activation = amplification (ex. ocytocine √† l‚Äôaccouchement)."},
      {id:'td2-h13',type:'text',title:'Exemple ‚Äî R√©tro-inhibition',prompt:"√âcris l‚Äôhormone s√©cr√©t√©e apr√®s un repas pour faire entrer le glucose dans les cellules.",answer:"Insuline",accepted:["insuline"],correction:"<strong>Insuline</strong>."},
      {id:'td2-h14',type:'text',title:'Exemple ‚Äî R√©tro-activation',prompt:"Hormone qui augmente les contractions lors de l‚Äôaccouchement (un mot).",answer:"Ocytocine",accepted:["ocytocine","oxytocine"],correction:"<strong>Ocytocine</strong>."},

      {id:'td2-im1',type:'text',title:'Immunit√© ‚Äî Terme',prompt:"Toute substance √©trang√®re d√©clenchant une r√©ponse immunitaire (un mot).",answer:"Antig√®ne",accepted:["antigene","antig√®ne"],correction:"<strong>Antig√®ne</strong>."},
      {id:'td2-im2',type:'text',title:'Immunit√© ‚Äî Terme',prompt:"Prot√©ine s√©cr√©t√©e par LB, se liant √† un antig√®ne (un mot).",answer:"Anticorps",accepted:["anticorps"],correction:"<strong>Anticorps</strong> (immunoglobuline)."},
      {id:'td2-im3',type:'vf',title:'Immunit√© ‚Äî Types',prompt:"L‚Äôimmunit√© inn√©e est la 1√®re ligne de d√©fense.",options:{VRAI:true,FAUX:false},correction:"VRAI : granulocytes/macrophages, phagocytose, inflammation."},
      {id:'td2-im4',type:'vf',title:'Immunit√© ‚Äî Types',prompt:"L‚Äôimmunit√© sp√©cifique est plus lente et moins efficace.",options:{VRAI:false,FAUX:true},correction:"FAUX : elle est + rapide et efficace (LB/LT, anticorps, cytokines)."},
      {id:'td2-im5',type:'qcm',title:'Lympho√Ødes primaires',prompt:"Organes lympho√Ødes primaires :",options:["Ganglions et rate","Thymus et moelle osseuse"],answer:"Thymus et moelle osseuse",correction:"Primaires = <strong>Thymus + Moelle osseuse</strong>."},
      {id:'td2-im6',type:'qcm',title:'Lympho√Ødes secondaires',prompt:"Organes lympho√Ødes secondaires :",options:["Ganglions, rate, amygdales, v√©g√©tations","Thymus, moelle osseuse"],answer:"Ganglions, rate, amygdales, v√©g√©tations",correction:"Secondaires = ganglions, rate, amygdales, v√©g√©tations."},
      {id:'td2-im7',type:'text',title:'R√¥le ‚Äî Secondaires',prompt:"R√¥le des organes lympho√Ødes secondaires (un mot cl√©) :",answer:"Activation",accepted:["activation","rencontre","r√©ponse","reponse","adaptative"],correction:"Lieu de rencontre antig√®nes/lymphocytes ‚Üí <strong>activation</strong> et r√©ponse adaptative."},

      {id:'td1-p1',type:'text',title:'Racine',prompt:"¬´ derm(ato) ¬ª signifie‚Ä¶",answer:"peau",accepted:["peau"],correction:"derm(ato) = <strong>peau</strong>."},
      {id:'td1-p2',type:'text',title:'Racine',prompt:"¬´ pnee / -pn√©e ¬ª signifie‚Ä¶",answer:"respiration",accepted:["respiration"],correction:"-pn√©e = <strong>respiration</strong>."},
      {id:'td1-p3',type:'text',title:'Racine',prompt:"¬´ cardio ¬ª signifie‚Ä¶",answer:"coeur",accepted:["coeur","c≈ìur"],correction:"cardio = <strong>c≈ìur</strong>."},
      {id:'td1-p4',type:'text',title:'Racine',prompt:"¬´ n√©phro ¬ª signifie‚Ä¶",answer:"rein",accepted:["rein","reins"],correction:"n√©phro = <strong>rein</strong>."},
      {id:'td1-p5',type:'text',title:'Pr√©fixe',prompt:"¬´ hypo ¬ª signifie‚Ä¶",answer:"d√©ficient, bas",accepted:["deficient bas","d√©ficient bas","bas","d√©ficient"],correction:"hypo = <strong>d√©ficient, bas</strong>."},
      {id:'td1-p6',type:'text',title:'Racine',prompt:"¬´ h√©mato ¬ª signifie‚Ä¶",answer:"sang",accepted:["sang"],correction:"h√©mato = <strong>sang</strong>."},
      {id:'td1-p7',type:'text',title:'Suffixe',prompt:"¬´ -√©mie ¬ª signifie‚Ä¶",answer:"dans le sang",accepted:["dans le sang","sang"],correction:"-√©mie = <strong>dans le sang</strong>."},

      {id:'td1-n1',type:'select-match',title:'Niveaux ‚Äî Appariement',prompt:"Associe :",labels:["Cellule","Organe","Syst√®me/Appareil"],options:["Unit√© structurale, fonctionnelle et reproductrice","Ensemble de tissus aux fonctions sp√©cifiques","Ensemble d‚Äôorganes accomplissant une activit√© essentielle"],answers:["Unit√© structurale, fonctionnelle et reproductrice","Ensemble de tissus aux fonctions sp√©cifiques","Ensemble d‚Äôorganes accomplissant une activit√© essentielle"],correction:"Cellule ‚Üí unit√© ; Organe ‚Üí tissus/fonctions ; Syst√®me ‚Üí organes/activit√© essentielle."},
      {id:'td1-n2',type:'qcm',title:'Organisation ‚Äî Ordre',prompt:"Nombre de niveaux d‚Äôorganisation list√©s dans le TD ?",options:["5","6"],answer:"6",correction:"Ordre : chimique ‚Üí cellulaire ‚Üí tissulaire ‚Üí organique ‚Üí syst√©mique ‚Üí organisme."},

      {id:'td1-b1',type:'qcm',title:'Lipides ‚Äî D√©finition',prompt:"Les lipides sont :",options:["Mol√©cules hydrophiles riches en O","Mol√©cules hydrophobes riches en C et H, peu d‚ÄôO"],answer:"Mol√©cules hydrophobes riches en C et H, peu d‚ÄôO",correction:"Hydrophobes ; stockage √©nergie, membranes, hormones (vit. D, st√©ro√Ødes)."},
      {id:'td1-b2',type:'qcm',title:'Glucides ‚Äî Cat√©gories',prompt:"Parmi ces trios, lequel correspond aux <em>disaccharides</em> ?",options:["Glucose, fructose, galactose","Saccharose, lactose, maltose"],answer:"Saccharose, lactose, maltose",correction:"Monosaccharides : glucose/fructose/galactose ; Disaccharides : saccharose/lactose/maltose."},
      {id:'td1-b3',type:'qcm',title:'Protides ‚Äî Fonction',prompt:"Fonction qui n‚Äôest PAS cit√©e :",options:["Structure","Transport","Enzymes","Photosynth√®se"],answer:"Photosynth√®se",correction:"Protides : structure, transport, enzymes, d√©fense, mouvement."},
      {id:'td1-b4',type:'qcm',title:'Acides nucl√©iques ‚Äî Types',prompt:"Types :",options:["ADN et ARN","ARNm et ARNt uniquement"],answer:"ADN et ARN",correction:"ADN = support info ; ARN = synth√®se des prot√©ines."},
      {id:'td1-b5',type:'qcm',title:'Ions ‚Äî D√©finition',prompt:"Un cation est‚Ä¶",options:["Ion positif (perte d‚Äô√©lectrons)","Ion n√©gatif (gain d‚Äô√©lectrons)"],answer:"Ion positif (perte d‚Äô√©lectrons)",correction:"Cation = positif ; Anion = n√©gatif."},

      {id:'td1-c1',type:'qcm',title:'Cellule ‚Äî √âl√©ments communs',prompt:"√âl√©ment <em>non</em> list√© parmi les 4 communs :",options:["Noyau","Cytoplasme","Paroi cellulosique","Membrane plasmique"],answer:"Paroi cellulosique",correction:"Les 4 : noyau, cytoplasme, membrane plasmique, organites."},

      {id:'td1-t1',type:'qcm',title:'Tissu √©pith√©lial',prompt:"Caract√©ristique vraie :",options:["Avasculaire mais innerv√©","Riche en vaisseaux"],answer:"Avasculaire mais innerv√©",correction:"√âpith√©lium : protection/absorption/sensibilit√©/s√©cr√©tion ; forme le parenchyme."},
      {id:'td1-t2',type:'qcm',title:'Tissu conjonctif',prompt:"Constituants :",options:["Cellules + matrice extracellulaire (fibres + substance)","Cellules jointives multinucle√©es"],answer:"Cellules + matrice extracellulaire (fibres + substance)",correction:"Fonction de soutien/isolant ; os, cartilage, derme, tendons, etc."},
      {id:'td1-t3',type:'qcm',title:'Tissu musculaire',prompt:"Fonction principale :",options:["Transport de l‚Äôinflux","Locomotion/contraction"],answer:"Locomotion/contraction",correction:"Stri√©s, lisses, cardiaque."},
      {id:'td1-t4',type:'qcm',title:'Tissu nerveux',prompt:"Pourcentage approximatif de gliocytes :",options:["10%","90%"],answer:"90%",correction:"Ne v√©hiculent pas l‚Äôinflux ; r√¥le de soutien."},

      {id:'td1-s1',type:'qcm',title:'Syst√®mes ‚Äî Nombre',prompt:"Nombre de grands syst√®mes list√©s :",options:["9","11"],answer:"11",correction:"T√©gumentaire, squelettique, musculaire, nerveux, endocrinien, cardio-vasculaire, lymphatique, respiratoire, digestif, urinaire, reproducteur."},
      {id:'td1-s2',type:'qcm',title:'Digestif ‚Äî R√¥le',prompt:"R√¥le principal :",options:["√âchanges gazeux","Digestion + absorption + √©limination solides"],answer:"Digestion + absorption + √©limination solides",correction:"Organes : bouche ‚Üí v√©sicule biliaire."},
      {id:'td1-s3',type:'qcm',title:'Reproducteur ‚Äî Organes',prompt:"Contient <em>tous</em> les organes list√©s :",options:["Testicules, prostate, p√©nis, ovaires, ut√©rus, trompes, vagin","Foie, pancr√©as, v√©sicule biliaire"],answer:"Testicules, prostate, p√©nis, ovaires, ut√©rus, trompes, vagin",correction:"R√¥le : reproduction, gam√®tes, hormones sexuelles."},
      {id:'td1-circ1',type:'vf',title:'Circulation',prompt:"Tous les vaisseaux partant du c≈ìur sont des veines.",options:{VRAI:false,FAUX:true},correction:"FAUX : art√®res partent du c≈ìur."},
      {id:'td1-circ2',type:'vf',title:'Circulation',prompt:"Tous les vaisseaux allant vers le c≈ìur sont des veines.",options:{VRAI:true,FAUX:false},correction:"VRAI."},
      {id:'td1-circ3',type:'vf',title:'Circulation',prompt:"La circulation pulmonaire = grande circulation.",options:{VRAI:false,FAUX:true},correction:"FAUX : pulmonaire = petite ; syst√©mique = grande."},
      {id:'td1-sid1',type:'select-match',title:'Identifier le syst√®me',prompt:"Associe le descriptif au syst√®me :",labels:["Nez, larynx, voies a√©riennes, poumons","C≈ìur, vaisseaux, sang","Reins, uret√®res, vessie, ur√®tre"],options:["Respiratoire","Circulatoire","Urinaire"],answers:["Respiratoire","Circulatoire","Urinaire"],correction:"Respiratoire / Circulatoire / Urinaire."}
    ];

    // CORE
    const qa=document.getElementById('qa');
    const hudQ=document.getElementById('hud-q');
    const hudOk=document.getElementById('hud-ok');
    const hudStreak=document.getElementById('hud-streak');
    const hudBest=document.getElementById('hud-best');
    const hudBank=document.getElementById('hud-bank');

    let asked=0, ok=0, streak=0, best=0;
    hudBank.textContent = BANK.length;

    function esc(s){return (s+'').replace(/[&<>"]/g,ch=>({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[ch]))}
    function norm(s){return (s||'').toString().trim().toLowerCase().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/\s+/g,' ')}

    function build(q){
      let inner='';
      if(q.type==='vf'){
        inner = '<div class="options">'+Object.keys(q.options).map(k=>`<label><input type="radio" name="answer" value="${k}"> ${k}</label>`).join('')+'</div>';
      }else if(q.type==='qcm'){
        inner = '<div class="options">'+q.options.map(o=>`<label><input type="radio" name="answer" value="${esc(o)}"> ${esc(o)}</label>`).join('')+'</div>';
      }else if(q.type==='text'){
        inner = `<input id="text-answer" type="text" placeholder="√âcris ici‚Ä¶ (accents/casse ignor√©s)">`;
      }else if(q.type==='select-match'){
        const sh=[...(q.options||[])].sort(()=>Math.random()-0.5);
        inner = (q.labels||[]).map((lab,i)=> `<p>${esc(lab)} ‚Üí <select id="m-${i}"><option value="">‚Äî Choisir ‚Äî</option>${sh.map(x=>`<option>${esc(x)}</option>`).join('')}</select></p>`).join('');
      }
      return `<div class="q" id="qbox">
        <h2>${q.title}</h2>
        <div class="prompt">${q.prompt||''}</div>
        ${inner}
        <div class="feedback" id="fb"></div>
        <button class="btn" id="check">V√©rifier</button>
      </div>`;
    }

    
    // ====== Audio (WebAudio) ======
    let SOUND_ON = true;
    let _ac = null;
    function getAC(){
      if(!_ac){
        const AC = window.AudioContext || window.webkitAudioContext;
        _ac = new AC();
      }
      return _ac;
    }
    function playTone(freq=440, dur=0.12, type='sine', vol=0.2){
      if(!SOUND_ON) return;
      const ac = getAC();
      const t0 = ac.currentTime;
      const o = ac.createOscillator();
      const g = ac.createGain();
      o.type = type; o.frequency.setValueAtTime(freq, t0);
      g.gain.setValueAtTime(0, t0);
      g.gain.linearRampToValueAtTime(vol, t0+0.01);
      g.gain.exponentialRampToValueAtTime(0.0001, t0+dur);
      o.connect(g).connect(ac.destination);
      o.start(t0); o.stop(t0+dur+0.02);
    }
    function successSfx(){
      // arpeggio up
      playTone(660, 0.10, 'sine', 0.20);
      setTimeout(()=>playTone(880, 0.10, 'sine', 0.20), 100);
      setTimeout(()=>playTone(1046.5, 0.12, 'triangle', 0.18), 210);
    }
    function errorSfx(){
      // brief buzz down
      playTone(200, 0.14, 'square', 0.18);
      setTimeout(()=>playTone(160, 0.14, 'square', 0.18), 110);
    }
    const btnSound = document.getElementById('btn-sound');
    btnSound.onclick = ()=>{
      SOUND_ON = !SOUND_ON;
      btnSound.textContent = SOUND_ON ? 'üîä' : 'üîá';
      btnSound.setAttribute('aria-pressed', SOUND_ON ? 'true' : 'false');
      btnSound.setAttribute('aria-label', SOUND_ON ? 'Couper le son' : 'Activer le son');
      btnSound.title = SOUND_ON ? 'Couper le son' : 'Activer le son';
      if(SOUND_ON){
        try{ getAC().resume(); }catch(e){}
        playTone(800, 0.06, 'sine', 0.15);
      }
    };

    let current=null;
    function next(){
      // change theme randomly
      const pick = themes[Math.floor(Math.random()*themes.length)];
      themes.forEach(t=>document.body.classList.remove(t));
      document.body.classList.add(pick);

      current = BANK[Math.floor(Math.random()*BANK.length)];
      asked++; hudQ.textContent=asked;
      qa.innerHTML = build(current);
      document.getElementById('check').onclick = verify;
      const first = qa.querySelector('input,select'); if(first) first.focus();
    }

    // Confetti
    const confetti = document.getElementById('confetti');
    function boom(){
      confetti.innerHTML='';
      const N=70;
      for(let i=0;i<N;i++){
        const b=document.createElement('b');
        b.style.left=(Math.random()*100)+'%';
        b.style.color=['#ffffff','#ffd166','#06d6a0','#118ab2','#ef476f'][Math.floor(Math.random()*5)];
        const dur=600+Math.random()*900;
        const dx=(Math.random()*2-1)*90;
        const delay=Math.random()*100;
        b.animate([{transform:'translate(0,-20px) rotate(0deg)',opacity:1},
                   {transform:'translate('+dx+'px, 120vh) rotate('+(Math.random()*720-360)+'deg)',opacity:.95}],
                   {duration:dur,easing:'cubic-bezier(.2,.7,.2,1)',delay});
        confetti.appendChild(b);
      }
      setTimeout(()=>confetti.innerHTML='',1300);
    }

    const SHOUTS_BAD = ["NON !","NEIN !","FAUX !","NOPE !","WRONG !","ERRON√â !","N√ÉO !","¬°NO!"];

    function verify(){
      const fb=document.getElementById('fb'); let good=false;
      const q=current;
      if(q.type==='vf'||q.type==='qcm'){
        const pick = qa.querySelector('input[name="answer"]:checked'); if(!pick){ jiggle(); return }
        if(q.type==='vf'){ good = !!q.options[pick.value]; }
        else { good = (pick.value===q.answer); }
      }else if(q.type==='text'){
        const val = norm((qa.querySelector('#text-answer')||{}).value||'');
        if(!val){ jiggle(); return }
        const accepted = (q.accepted && q.accepted.length) ? q.accepted.map(norm) : (q.answer||'').split('/').map(norm);
        good = accepted.includes(val);
      }else if(q.type==='select-match'){
        let okc=0; (q.labels||[]).forEach((_,i)=>{ const v=(qa.querySelector('#m-'+i)||{}).value; if(v===q.answers[i]) okc++; });
        good = okc===(q.labels||[]).length;
      }
      fb.style.display='block';
      if(good){
        ok++; streak++; best=Math.max(best,streak);
        fb.className='feedback good';
        fb.innerHTML='‚úîÔ∏è Bonne r√©ponse ! '+(q.correction||'');
        hudOk.textContent=ok; hudStreak.textContent=streak; hudBest.textContent=best;
        boom(); successSfx();
        setTimeout(next,900);
      }else{
        streak=0; hudStreak.textContent=streak;
        fb.className='feedback bad'; errorSfx();
        const shout = SHOUTS_BAD[Math.floor(Math.random()*SHOUTS_BAD.length)];
        fb.innerHTML='<div class="shout">'+shout+'</div>‚ùå Mauvaise r√©ponse. '+(q.correction||'')+'<br><em>R√©ponds √† nouveau √† la question pour passer √† la suivante.</em>';
      }
    }
    function jiggle(){ const b=document.getElementById('qbox'); b.classList.remove('wiggle'); void b.offsetWidth; b.classList.add('wiggle'); }

    document.getElementById('btn-next').onclick=next;
    document.addEventListener('DOMContentLoaded', next);
  </script>
</body>
</html>
