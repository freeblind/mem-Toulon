<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD1 Physiologie G√©n√©rale - Syst√®me d'Apprentissage</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 1.1em;
        }

        .mode-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            padding: 30px;
            background: #f8f9fa;
        }

        .mode-card {
            background: white;
            padding: 30px;
            border-radius: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .mode-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            border-color: #667eea;
        }

        .mode-card .icon {
            font-size: 3em;
            margin-bottom: 15px;
        }

        .mode-card h2 {
            color: #333;
            margin-bottom: 10px;
        }

        .mode-card p {
            color: #666;
            font-size: 0.9em;
        }

        .content {
            padding: 40px;
            display: none;
        }

        .content.active {
            display: block;
        }

        .flashcard-container {
            perspective: 1000px;
            margin: 30px 0;
        }

        .flashcard {
            width: 100%;
            min-height: 400px;
            position: relative;
            transition: transform 0.6s;
            transform-style: preserve-3d;
            cursor: pointer;
        }

        .flashcard.flipped {
            transform: rotateY(180deg);
        }

        .flashcard-face {
            position: absolute;
            width: 100%;
            min-height: 400px;
            backface-visibility: hidden;
            border-radius: 15px;
            padding: 40px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }

        .flashcard-front {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .flashcard-back {
            background: white;
            transform: rotateY(180deg);
            border: 3px solid #667eea;
        }

        .flashcard-front h2 {
            font-size: 1.8em;
            margin-bottom: 20px;
        }

        .flashcard-back .answer {
            color: #333;
            font-size: 1.3em;
            line-height: 1.6;
        }

        .flashcard-controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }

        .btn {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1em;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-secondary {
            background: #6b7280;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }

        .stats-bar {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: white;
            border-radius: 8px;
        }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: #e0e0e0;
            border-radius: 5px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
        }

        .test-question {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 10px;
            margin: 20px 0;
        }

        .test-question h3 {
            color: #333;
            margin-bottom: 20px;
        }

        .test-options {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .test-option {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .test-option:hover {
            border-color: #667eea;
            transform: translateX(5px);
        }

        .test-option.selected {
            background: #e0e7ff;
            border-color: #667eea;
        }

        .test-option.correct {
            background: #d1fae5;
            border-color: #10b981;
        }

        .test-option.incorrect {
            background: #fee2e2;
            border-color: #ef4444;
        }

        .input-answer {
            width: 100%;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 1em;
            margin: 10px 0;
        }

        .input-answer:focus {
            outline: none;
            border-color: #667eea;
        }

        .feedback {
            margin: 20px 0;
            padding: 15px;
            border-radius: 8px;
            display: none;
        }

        .feedback.show {
            display: block;
        }

        .feedback.correct {
            background: #d1fae5;
            color: #065f46;
            border-left: 5px solid #10b981;
        }

        .feedback.incorrect {
            background: #fee2e2;
            color: #991b1b;
            border-left: 5px solid #ef4444;
        }

        .filter-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .filter-btn.active {
            background: #667eea;
            color: white;
        }

        .save-controls {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }

        table th,
        table td {
            padding: 12px;
            border: 1px solid #e0e0e0;
            text-align: left;
        }

        table th {
            background: #667eea;
            color: white;
        }

        table tr:nth-child(even) {
            background: #f8f9fa;
        }

        .matching-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin: 20px 0;
        }

        .matching-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border: 2px solid #e0e0e0;
            cursor: pointer;
            transition: all 0.3s;
        }

        .matching-item:hover {
            border-color: #667eea;
        }

        .matching-item.selected {
            background: #e0e7ff;
            border-color: #667eea;
        }

        .matching-item.matched {
            background: #d1fae5;
            border-color: #10b981;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            .mode-selector {
                grid-template-columns: 1fr;
            }

            .stats-bar {
                grid-template-columns: 1fr 1fr;
            }

            .matching-container {
                grid-template-columns: 1fr;
            }
        }

        .category-badge {
            display: inline-block;
            padding: 5px 12px;
            background: #667eea;
            color: white;
            border-radius: 15px;
            font-size: 0.8em;
            margin: 5px;
        }

        .flip-hint {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 0.9em;
            opacity: 0.8;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 0.4; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>TD1 - Physiologie G√©n√©rale</h1>
            <p>Syst√®me d'Apprentissage Interactif - UE 2.5 S1</p>
        </div>

        <!-- Mode Selector -->
        <div id="modeSelector" class="mode-selector">
            <div class="mode-card" onclick="startMode('flashcards')">
                <div class="icon">üé¥</div>
                <h2>Mode Flashcards</h2>
                <p>Apprentissage par cartes avec auto-√©valuation</p>
            </div>
            <div class="mode-card" onclick="startMode('test')">
                <div class="icon">üìù</div>
                <h2>Mode Test</h2>
                <p>√âvaluation compl√®te avec correction</p>
            </div>
        </div>

        <!-- Flashcards Content -->
        <div id="flashcardsContent" class="content">
            <!-- Will be populated by JavaScript -->
        </div>

        <!-- Test Content -->
        <div id="testContent" class="content">
            <!-- Will be populated by JavaScript -->
        </div>
    </div>

    <script>
        // Database of flashcards
        const flashcardsData = [
            // Pr√©fixes et suffixes
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'derm(ato)' ?",
                answer: "Peau"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'cardio' ?",
                answer: "C≈ìur"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le suffixe 'pn√©e' ?",
                answer: "Respiration"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'ost√©(o)' ?",
                answer: "Os"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'h√©mato' ?",
                answer: "Sang"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'n√©phro' ?",
                answer: "Rein"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'angio' ?",
                answer: "Vaisseau"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie 'cyto' ?",
                answer: "Cellule"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie le pr√©fixe 'hypo' ?",
                answer: "D√©ficient, bas"
            },
            { 
                category: "Vocabulaire m√©dical",
                question: "Que signifie 'thoraco' ?",
                answer: "Thorax"
            },
            
            // Niveaux d'organisation
            { 
                category: "Organisation du corps",
                question: "Citez les 6 niveaux d'organisation du corps humain dans l'ordre croissant",
                answer: "1. Chimique (atome + mol√©cule)\n2. Cellulaire\n3. Tissulaire\n4. Organique\n5. Syst√©mique\n6. L'organisme"
            },
            { 
                category: "Organisation du corps",
                question: "D√©finissez la cellule dans le contexte des niveaux d'organisation",
                answer: "Unit√© structurale, fonctionnelle et reproductrice de tous les organismes vivants"
            },
            { 
                category: "Organisation du corps",
                question: "Qu'est-ce qu'un tissu ?",
                answer: "Ensemble de cellules reli√©es entre elles par une trame organique"
            },
            { 
                category: "Organisation du corps",
                question: "Qu'est-ce qu'un organe ?",
                answer: "Ensemble de tissus ayant une ou plusieurs fonctions sp√©cifiques"
            },
            { 
                category: "Organisation du corps",
                question: "Qu'est-ce qu'un syst√®me/appareil ?",
                answer: "Ensemble d'organes qui accomplissent en commun une activit√© essentielle de l'organisme"
            },
            
            // Niveau chimique
            { 
                category: "Niveau chimique",
                question: "D√©finissez les lipides",
                answer: "Mol√©cules hydrophobes (peu solubles dans l'eau) constitu√©es principalement de carbone et d'hydrog√®ne avec peu d'oxyg√®ne"
            },
            { 
                category: "Niveau chimique",
                question: "Quelles sont les fonctions principales des lipides ?",
                answer: "Stockage d'√©nergie, structure des membranes cellulaires, r√¥le hormonal et r√©gulateur (vitamine D, hormones sexuelles)"
            },
            { 
                category: "Niveau chimique",
                question: "Citez les 3 cat√©gories de glucides",
                answer: "1. Monosaccharides (glucose, fructose, galactose)\n2. Disaccharides (saccharose, lactose, maltose)\n3. Polysaccharides (amidon, glycog√®ne, cellulose)"
            },
            { 
                category: "Niveau chimique",
                question: "D√©finissez les protides",
                answer: "Assemblage d'acides amin√©s"
            },
            { 
                category: "Niveau chimique",
                question: "Citez 5 fonctions principales des prot√©ines",
                answer: "1. Structure (collag√®ne, k√©ratine)\n2. Transport (h√©moglobine, albumine)\n3. Enzymes (acc√©l√®rent r√©actions chimiques)\n4. D√©fense (anticorps)\n5. Mouvement (myosine, actine)"
            },
            { 
                category: "Niveau chimique",
                question: "Quelle est la diff√©rence entre ADN et ARN ?",
                answer: "ADN : support de l'information g√©n√©tique, double h√©lice\nARN : impliqu√© dans la synth√®se des prot√©ines"
            },
            { 
                category: "Niveau chimique",
                question: "Qu'est-ce qu'un ion ? Citez les deux types",
                answer: "Atomes ou mol√©cules qui poss√®dent une charge √©lectrique.\nCation : ion positif (perte d'√©lectrons, ex: Na+, K+)\nAnion : ion n√©gatif (gain d'√©lectrons, ex: Cl-)"
            },
            
            // Niveau cellulaire
            { 
                category: "Niveau cellulaire",
                question: "Citez les 4 √©l√©ments communs de la cellule",
                answer: "1. Le noyau (contient ADN)\n2. Le cytoplasme (milieu intracellulaire)\n3. La membrane plasmique (d√©limite et prot√®ge)\n4. Les organites (structures dans le cytoplasme)"
            },
            
            // Types de tissus
            { 
                category: "Tissus",
                question: "Quelle est la fonction du tissu √©pith√©lial ? Donnez des exemples",
                answer: "Fonctions : protection, absorption (intestin), sensibilit√© (b√¢tonnets et c√¥nes dans l'≈ìil), s√©cr√©tion\nExemples : trach√©e, √©piderme, tubes digestifs, respiratoires, reproductifs, urinaires"
            },
            { 
                category: "Tissus",
                question: "Quelle est la fonction du tissu conjonctif ? Donnez des exemples",
                answer: "Fonction : soutien et isolant\nExemples : os, cartilage, vaisseaux, poumons, foie, rate, ganglions, derme, tendons, tissu adipeux"
            },
            { 
                category: "Tissus",
                question: "Quelle est la fonction du tissu musculaire ? Citez les types",
                answer: "Fonction : locomotion et contraction (respiration, cardiaque)\nTypes : muscles stri√©s, lisses, cardiaques"
            },
            { 
                category: "Tissus",
                question: "D√©crivez le tissu nerveux",
                answer: "Compos√© de 2 syst√®mes cellulaires :\n- Neurones (10%) : v√©hiculent l'influx nerveux\n- Gliocytes (90%) : soutien, ne v√©hiculent pas d'influx\nR√¥le : transport, r√©ception, conversion et stockage de l'information"
            },
            
            // Syst√®mes
            { 
                category: "Syst√®mes du corps",
                question: "Citez les 11 grands syst√®mes du corps humain",
                answer: "1. T√©gumentaire\n2. Squelettique\n3. Musculaire\n4. Nerveux\n5. Endocrinien\n6. Cardiovasculaire\n7. Lymphatique/immunitaire\n8. Respiratoire\n9. Digestif\n10. Urinaire\n11. Reproducteur"
            },
            { 
                category: "Syst√®me digestif",
                question: "Citez les organes du syst√®me digestif",
                answer: "Bouche, pharynx, ≈ìsophage, estomac, intestins, foie, pancr√©as, v√©sicule biliaire"
            },
            { 
                category: "Syst√®me digestif",
                question: "Quels sont les r√¥les du syst√®me digestif ?",
                answer: "Digestion, absorption des nutriments, √©limination des d√©chets solides"
            },
            { 
                category: "Syst√®me reproducteur",
                question: "Citez les organes du syst√®me reproducteur (homme et femme)",
                answer: "Homme : testicules, prostate, p√©nis\nFemme : ovaires, ut√©rus, trompes, vagin"
            },
            { 
                category: "Syst√®me reproducteur",
                question: "Quels sont les r√¥les du syst√®me reproducteur ?",
                answer: "Reproduction, production des gam√®tes, s√©cr√©tion d'hormones sexuelles"
            },
            
            // Circulation
            { 
                category: "Syst√®me cardiovasculaire",
                question: "Quelle est la diff√©rence entre art√®res et veines ?",
                answer: "Art√®res : vaisseaux partant DU c≈ìur vers un organe\nVeines : vaisseaux partant d'un organe vers LE c≈ìur"
            },
            { 
                category: "Syst√®me cardiovasculaire",
                question: "Qu'est-ce que la petite circulation (circulation pulmonaire) ?",
                answer: "Circuit c≈ìur-poumons-c≈ìur permettant l'oxyg√©nation du sang"
            },
            { 
                category: "Syst√®me cardiovasculaire",
                question: "Qu'est-ce que la grande circulation (circulation syst√©mique) ?",
                answer: "Circuit c≈ìur-organes-c≈ìur permettant d'apporter O2 et nutriments aux organes"
            },
            { 
                category: "Syst√®me cardiovasculaire",
                question: "D√©crivez le trajet du sang dans la petite circulation",
                answer: "Ventricule droit ‚Üí Art√®re pulmonaire ‚Üí Poumons (√©changes gazeux) ‚Üí Veine pulmonaire ‚Üí Oreillette gauche"
            },
            { 
                category: "Syst√®me cardiovasculaire",
                question: "Quel type de sang circule dans les art√®res pulmonaires ?",
                answer: "Sang riche en CO2 et pauvre en O2 (exception : les art√®res pulmonaires transportent du sang d√©soxyg√©n√©)"
            }
        ];

        // Test questions
        const testQuestions = [
            {
                type: 'multiple-choice',
                question: "Quel est le bon ordre des niveaux d'organisation du corps humain ?",
                options: [
                    "Chimique ‚Üí Tissulaire ‚Üí Cellulaire ‚Üí Organique ‚Üí Syst√©mique ‚Üí Organisme",
                    "Chimique ‚Üí Cellulaire ‚Üí Tissulaire ‚Üí Organique ‚Üí Syst√©mique ‚Üí Organisme",
                    "Cellulaire ‚Üí Chimique ‚Üí Tissulaire ‚Üí Organique ‚Üí Syst√©mique ‚Üí Organisme",
                    "Chimique ‚Üí Cellulaire ‚Üí Organique ‚Üí Tissulaire ‚Üí Syst√©mique ‚Üí Organisme"
                ],
                correct: 1,
                explanation: "L'ordre correct est : Chimique ‚Üí Cellulaire ‚Üí Tissulaire ‚Üí Organique ‚Üí Syst√©mique ‚Üí Organisme"
            },
            {
                type: 'multiple-choice',
                question: "Quelle est la fonction principale des lipides ?",
                options: [
                    "Transport de l'oxyg√®ne",
                    "Stockage d'√©nergie et structure membranaire",
                    "Contraction musculaire",
                    "Transmission de l'influx nerveux"
                ],
                correct: 1,
                explanation: "Les lipides servent au stockage d'√©nergie, √† la structure des membranes cellulaires et au r√¥le hormonal."
            },
            {
                type: 'multiple-choice',
                question: "Combien y a-t-il de syst√®mes majeurs dans le corps humain ?",
                options: [
                    "8",
                    "10",
                    "11",
                    "13"
                ],
                correct: 2,
                explanation: "Il y a 11 grands syst√®mes du corps humain."
            },
            {
                type: 'multiple-choice',
                question: "Quelle est la caract√©ristique des art√®res ?",
                options: [
                    "Elles partent d'un organe vers le c≈ìur",
                    "Elles partent du c≈ìur vers un organe",
                    "Elles ne contiennent que du sang oxyg√©n√©",
                    "Elles sont toujours bleues"
                ],
                correct: 1,
                explanation: "Les art√®res sont les vaisseaux qui partent DU c≈ìur vers un organe (attention : les art√®res pulmonaires transportent du sang d√©soxyg√©n√© !)"
            },
            {
                type: 'matching',
                question: "Associez chaque pr√©fixe √† sa signification :",
                pairs: [
                    { left: "cardio", right: "c≈ìur" },
                    { left: "n√©phro", right: "rein" },
                    { left: "ost√©(o)", right: "os" },
                    { left: "derm(ato)", right: "peau" }
                ]
            },
            {
                type: 'matching',
                question: "Associez chaque type de tissu √† sa fonction principale :",
                pairs: [
                    { left: "Tissu √©pith√©lial", right: "Protection, absorption, s√©cr√©tion" },
                    { left: "Tissu conjonctif", right: "Soutien et isolant" },
                    { left: "Tissu musculaire", right: "Locomotion et contraction" },
                    { left: "Tissu nerveux", right: "Transport et stockage de l'information" }
                ]
            },
            {
                type: 'fill-in',
                question: "Compl√©tez : Les mol√©cules hydrophobes constitu√©es principalement de carbone et d'hydrog√®ne sont appel√©es ___________",
                answer: "lipides",
                alternatives: ["lipide"]
            },
            {
                type: 'fill-in',
                question: "Compl√©tez : L'unit√© structurale, fonctionnelle et reproductrice de tous les organismes vivants est la ___________",
                answer: "cellule",
                alternatives: []
            },
            {
                type: 'multiple-choice',
                question: "Quel type de tissu compose les muscles stri√©s, lisses et cardiaques ?",
                options: [
                    "Tissu √©pith√©lial",
                    "Tissu conjonctif",
                    "Tissu musculaire",
                    "Tissu nerveux"
                ],
                correct: 2,
                explanation: "Le tissu musculaire compose les muscles stri√©s, lisses et cardiaques."
            },
            {
                type: 'multiple-choice',
                question: "Dans le tissu nerveux, quel pourcentage repr√©sentent les neurones ?",
                options: [
                    "10%",
                    "50%",
                    "90%",
                    "100%"
                ],
                correct: 0,
                explanation: "Les neurones repr√©sentent 10% du tissu nerveux, les gliocytes repr√©sentent 90%."
            },
            {
                type: 'matching',
                question: "Associez chaque syst√®me √† sa fonction principale :",
                pairs: [
                    { left: "Syst√®me digestif", right: "Nutrition, √©limination des d√©chets" },
                    { left: "Syst√®me respiratoire", right: "√âchanges gazeux" },
                    { left: "Syst√®me urinaire", right: "√âpuration" },
                    { left: "Syst√®me nerveux", right: "V√©hiculer et stocker les informations" }
                ]
            },
            {
                type: 'multiple-choice',
                question: "Quelle circulation concerne le circuit c≈ìur-poumons-c≈ìur ?",
                options: [
                    "Grande circulation",
                    "Circulation syst√©mique",
                    "Petite circulation",
                    "Circulation portale"
                ],
                correct: 2,
                explanation: "La petite circulation (ou circulation pulmonaire) concerne le circuit c≈ìur-poumons-c≈ìur."
            }
        ];

        // Learning state management
        let learningState = {
            flashcards: {},
            currentIndex: 0,
            filter: 'all',
            isFlipped: false
        };

        // Load state from localStorage
        function loadState() {
            const saved = localStorage.getItem('td1_physio_learning_state');
            if (saved) {
                learningState = JSON.parse(saved);
            } else {
                // Initialize state
                flashcardsData.forEach((card, index) => {
                    learningState.flashcards[index] = {
                        status: 'new', // 'new', 'known', 'review', 'unknown'
                        reviewCount: 0
                    };
                });
            }
        }

        // Save state to localStorage
        function saveState() {
            localStorage.setItem('td1_physio_learning_state', JSON.stringify(learningState));
        }

        // Export state as JSON file
        function exportState() {
            const dataStr = JSON.stringify(learningState, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `td1_physio_progress_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Import state from JSON file
        function importState() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            input.onchange = (e) => {
                const file = e.target.files[0];
                const reader = new FileReader();
                reader.onload = (event) => {
                    try {
                        learningState = JSON.parse(event.target.result);
                        saveState();
                        alert('Progression import√©e avec succ√®s !');
                        if (document.getElementById('flashcardsContent').classList.contains('active')) {
                            renderFlashcards();
                        }
                    } catch (error) {
                        alert('Erreur lors de l\'importation du fichier');
                    }
                };
                reader.readAsText(file);
            };
            input.click();
        }

        // Reset progress
        function resetProgress() {
            if (confirm('√ätes-vous s√ªr de vouloir r√©initialiser toute votre progression ?')) {
                flashcardsData.forEach((card, index) => {
                    learningState.flashcards[index] = {
                        status: 'new',
                        reviewCount: 0
                    };
                });
                learningState.currentIndex = 0;
                saveState();
                alert('Progression r√©initialis√©e !');
                renderFlashcards();
            }
        }

        // Start mode
        function startMode(mode) {
            document.getElementById('modeSelector').style.display = 'none';
            
            if (mode === 'flashcards') {
                document.getElementById('flashcardsContent').classList.add('active');
                renderFlashcards();
            } else if (mode === 'test') {
                document.getElementById('testContent').classList.add('active');
                renderTest();
            }
        }

        // Return to menu
        function returnToMenu() {
            document.getElementById('modeSelector').style.display = 'grid';
            document.getElementById('flashcardsContent').classList.remove('active');
            document.getElementById('testContent').classList.remove('active');
        }

        // Get filtered flashcards
        function getFilteredFlashcards() {
            const indices = Object.keys(learningState.flashcards).map(Number);
            
            if (learningState.filter === 'all') {
                return indices;
            } else if (learningState.filter === 'review') {
                return indices.filter(i => {
                    const state = learningState.flashcards[i];
                    return state.status === 'review' || state.status === 'unknown';
                });
            } else if (learningState.filter === 'new') {
                return indices.filter(i => learningState.flashcards[i].status === 'new');
            } else if (learningState.filter === 'known') {
                return indices.filter(i => learningState.flashcards[i].status === 'known');
            }
            return indices;
        }

        // Render flashcards
        function renderFlashcards() {
            const container = document.getElementById('flashcardsContent');
            const filtered = getFilteredFlashcards();
            
            if (learningState.currentIndex >= filtered.length) {
                learningState.currentIndex = 0;
            }
            
            const currentCardIndex = filtered[learningState.currentIndex];
            const currentCard = flashcardsData[currentCardIndex];
            const cardState = learningState.flashcards[currentCardIndex];
            
            // Calculate stats
            const stats = {
                total: flashcardsData.length,
                known: Object.values(learningState.flashcards).filter(s => s.status === 'known').length,
                review: Object.values(learningState.flashcards).filter(s => s.status === 'review').length,
                unknown: Object.values(learningState.flashcards).filter(s => s.status === 'unknown').length,
                new: Object.values(learningState.flashcards).filter(s => s.status === 'new').length
            };
            
            container.innerHTML = `
                <button class="btn btn-secondary" onclick="returnToMenu()" style="margin-bottom: 20px;">‚Üê Retour au menu</button>
                
                <div class="stats-bar">
                    <div class="stat-item">
                        <div class="stat-number">${stats.total}</div>
                        <div class="stat-label">Total</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #10b981;">${stats.known}</div>
                        <div class="stat-label">Acquis</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #f59e0b;">${stats.review}</div>
                        <div class="stat-label">√Ä revoir</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #ef4444;">${stats.unknown}</div>
                        <div class="stat-label">Non acquis</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" style="color: #6b7280;">${stats.new}</div>
                        <div class="stat-label">Nouveau</div>
                    </div>
                </div>
                
                <div class="filter-buttons">
                    <button class="filter-btn ${learningState.filter === 'all' ? 'active' : ''}" onclick="setFilter('all')">
                        Toutes (${flashcardsData.length})
                    </button>
                    <button class="filter-btn ${learningState.filter === 'new' ? 'active' : ''}" onclick="setFilter('new')">
                        Nouvelles (${stats.new})
                    </button>
                    <button class="filter-btn ${learningState.filter === 'review' ? 'active' : ''}" onclick="setFilter('review')">
                        √Ä r√©viser (${stats.review + stats.unknown})
                    </button>
                    <button class="filter-btn ${learningState.filter === 'known' ? 'active' : ''}" onclick="setFilter('known')">
                        Acquises (${stats.known})
                    </button>
                </div>
                
                ${filtered.length === 0 ? `
                    <div style="text-align: center; padding: 60px; color: #666;">
                        <div style="font-size: 3em; margin-bottom: 20px;">üéâ</div>
                        <h2>Aucune carte dans cette cat√©gorie !</h2>
                        <p style="margin-top: 10px;">S√©lectionnez un autre filtre pour continuer.</p>
                    </div>
                ` : `
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${((learningState.currentIndex + 1) / filtered.length) * 100}%"></div>
                    </div>
                    <div style="text-align: center; color: #666; margin-bottom: 20px;">
                        Carte ${learningState.currentIndex + 1} / ${filtered.length}
                    </div>
                    
                    <span class="category-badge">${currentCard.category}</span>
                    
                    <div class="flashcard-container">
                        <div class="flashcard" id="flashcard" onclick="flipCard()">
                            <div class="flashcard-face flashcard-front">
                                <h2>Question</h2>
                                <p style="font-size: 1.3em; margin: 20px 0;">${currentCard.question}</p>
                                <div class="flip-hint">üëÜ Cliquez pour voir la r√©ponse</div>
                            </div>
                            <div class="flashcard-face flashcard-back">
                                <h2 style="color: #667eea; margin-bottom: 20px;">R√©ponse</h2>
                                <div class="answer">${currentCard.answer.replace(/\n/g, '<br>')}</div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="flashcard-controls">
                        <button class="btn btn-success" onclick="markCard('known')" title="Je connais parfaitement">
                            ‚úÖ Acquis
                        </button>
                        <button class="btn btn-warning" onclick="markCard('review')" title="Je dois revoir">
                            ‚ö†Ô∏è √Ä revoir
                        </button>
                        <button class="btn btn-danger" onclick="markCard('unknown')" title="Je ne sais pas">
                            ‚ùå Non acquis
                        </button>
                    </div>
                    
                    <div style="text-align: center; margin-top: 20px; color: #666; font-size: 0.9em;">
                        ${cardState.reviewCount > 0 ? `Cette carte a √©t√© revue ${cardState.reviewCount} fois` : 'Premi√®re fois que vous voyez cette carte'}
                    </div>
                `}
                
                <div class="save-controls">
                    <button class="btn btn-primary" onclick="exportState()">üíæ Exporter la progression</button>
                    <button class="btn btn-primary" onclick="importState()">üìÇ Importer la progression</button>
                    <button class="btn btn-danger" onclick="resetProgress()">üîÑ R√©initialiser</button>
                </div>
            `;
        }

        // Flip card
        function flipCard() {
            const card = document.getElementById('flashcard');
            card.classList.toggle('flipped');
            learningState.isFlipped = !learningState.isFlipped;
        }

        // Mark card
        function markCard(status) {
            const filtered = getFilteredFlashcards();
            const currentCardIndex = filtered[learningState.currentIndex];
            
            learningState.flashcards[currentCardIndex].status = status;
            
            // Update review count based on status
            if (status === 'review') {
                learningState.flashcards[currentCardIndex].reviewCount = 1;
            } else if (status === 'unknown') {
                learningState.flashcards[currentCardIndex].reviewCount = 3;
            } else if (status === 'known') {
                learningState.flashcards[currentCardIndex].reviewCount = 0;
            }
            
            saveState();
            
            // Move to next card
            learningState.currentIndex++;
            learningState.isFlipped = false;
            renderFlashcards();
        }

        // Set filter
        function setFilter(filter) {
            learningState.filter = filter;
            learningState.currentIndex = 0;
            renderFlashcards();
        }

        // Render test
        function renderTest() {
            const container = document.getElementById('testContent');
            
            container.innerHTML = `
                <button class="btn btn-secondary" onclick="returnToMenu()" style="margin-bottom: 20px;">‚Üê Retour au menu</button>
                
                <h2 style="margin-bottom: 30px; color: #333;">Mode Test - √âvaluation Compl√®te</h2>
                
                <div id="testQuestions"></div>
                
                <div style="text-align: center; margin-top: 30px;">
                    <button class="btn btn-primary" onclick="submitTest()" id="submitBtn">Soumettre le test</button>
                </div>
                
                <div id="testResults" style="display: none;"></div>
            `;
            
            renderTestQuestions();
        }

        // Render test questions
        function renderTestQuestions() {
            const questionsContainer = document.getElementById('testQuestions');
            let html = '';
            
            testQuestions.forEach((q, index) => {
                html += `<div class="test-question" id="question-${index}">`;
                html += `<h3>Question ${index + 1}</h3>`;
                html += `<p style="margin: 15px 0;">${q.question}</p>`;
                
                if (q.type === 'multiple-choice') {
                    html += '<div class="test-options">';
                    q.options.forEach((option, optIndex) => {
                        html += `
                            <div class="test-option" onclick="selectTestOption(${index}, ${optIndex})">
                                ${String.fromCharCode(65 + optIndex)}. ${option}
                            </div>
                        `;
                    });
                    html += '</div>';
                } else if (q.type === 'fill-in') {
                    html += `
                        <input type="text" class="input-answer" id="answer-${index}" placeholder="Votre r√©ponse...">
                    `;
                } else if (q.type === 'matching') {
                    html += `<p style="color: #666; margin: 10px 0;">Cliquez sur un √©l√©ment √† gauche, puis sur sa correspondance √† droite</p>`;
                    html += `<div class="matching-container" id="matching-${index}">`;
                    html += '<div>';
                    q.pairs.forEach((pair, pairIndex) => {
                        html += `
                            <div class="matching-item" data-side="left" data-index="${pairIndex}" onclick="selectMatching(${index}, 'left', ${pairIndex})">
                                ${pair.left}
                            </div>
                        `;
                    });
                    html += '</div><div>';
                    const shuffled = [...q.pairs].sort(() => Math.random() - 0.5);
                    shuffled.forEach((pair, pairIndex) => {
                        const originalIndex = q.pairs.findIndex(p => p.left === pair.left);
                        html += `
                            <div class="matching-item" data-side="right" data-index="${originalIndex}" onclick="selectMatching(${index}, 'right', ${originalIndex})">
                                ${pair.right}
                            </div>
                        `;
                    });
                    html += '</div></div>';
                }
                
                html += `<div class="feedback" id="feedback-${index}"></div>`;
                html += '</div>';
            });
            
            questionsContainer.innerHTML = html;
        }

        // Test state
        let testState = {
            answers: {},
            matchingState: {}
        };

        // Select test option
        function selectTestOption(questionIndex, optionIndex) {
            const question = document.querySelectorAll(`#question-${questionIndex} .test-option`);
            question.forEach(opt => opt.classList.remove('selected'));
            question[optionIndex].classList.add('selected');
            
            testState.answers[questionIndex] = optionIndex;
        }

        // Select matching
        function selectMatching(questionIndex, side, index) {
            if (!testState.matchingState[questionIndex]) {
                testState.matchingState[questionIndex] = { selected: null, matched: [] };
            }
            
            const state = testState.matchingState[questionIndex];
            const container = document.getElementById(`matching-${questionIndex}`);
            const items = container.querySelectorAll('.matching-item');
            
            // Check if already matched
            if (state.matched.includes(index)) return;
            
            if (state.selected === null) {
                // First selection
                state.selected = { side, index };
                items.forEach(item => {
                    if (item.dataset.side === side && parseInt(item.dataset.index) === index) {
                        item.classList.add('selected');
                    }
                });
            } else if (state.selected.side === side) {
                // Same side, change selection
                items.forEach(item => item.classList.remove('selected'));
                state.selected = { side, index };
                items.forEach(item => {
                    if (item.dataset.side === side && parseInt(item.dataset.index) === index) {
                        item.classList.add('selected');
                    }
                });
            } else {
                // Different side, check if match
                if (state.selected.index === index) {
                    // Correct match
                    state.matched.push(index);
                    items.forEach(item => {
                        if (parseInt(item.dataset.index) === index) {
                            item.classList.add('matched');
                            item.classList.remove('selected');
                        }
                    });
                    state.selected = null;
                    
                    // Store answer
                    if (!testState.answers[questionIndex]) {
                        testState.answers[questionIndex] = [];
                    }
                    testState.answers[questionIndex].push(index);
                } else {
                    // Wrong match - clear selection
                    items.forEach(item => item.classList.remove('selected'));
                    state.selected = null;
                }
            }
        }

        // Submit test
        function submitTest() {
            let score = 0;
            let total = testQuestions.length;
            
            testQuestions.forEach((q, index) => {
                const feedback = document.getElementById(`feedback-${index}`);
                let correct = false;
                
                if (q.type === 'multiple-choice') {
                    const userAnswer = testState.answers[index];
                    correct = userAnswer === q.correct;
                    
                    const options = document.querySelectorAll(`#question-${index} .test-option`);
                    options.forEach((opt, i) => {
                        opt.classList.add('disabled');
                        if (i === q.correct) {
                            opt.classList.add('correct');
                        } else if (i === userAnswer && !correct) {
                            opt.classList.add('incorrect');
                        }
                    });
                    
                    feedback.className = `feedback show ${correct ? 'correct' : 'incorrect'}`;
                    feedback.innerHTML = correct ? `‚úÖ Correct ! ${q.explanation}` : `‚ùå Incorrect. ${q.explanation}`;
                    
                } else if (q.type === 'fill-in') {
                    const userAnswer = document.getElementById(`answer-${index}`).value.trim().toLowerCase();
                    correct = userAnswer === q.answer.toLowerCase() || q.alternatives.some(alt => userAnswer === alt.toLowerCase());
                    
                    feedback.className = `feedback show ${correct ? 'correct' : 'incorrect'}`;
                    feedback.innerHTML = correct ? 
                        `‚úÖ Correct ! La r√©ponse est bien "${q.answer}"` :
                        `‚ùå Incorrect. La r√©ponse attendue est "${q.answer}"`;
                    
                } else if (q.type === 'matching') {
                    const matchedAll = testState.matchingState[index] && 
                                      testState.matchingState[index].matched.length === q.pairs.length;
                    correct = matchedAll;
                    
                    feedback.className = `feedback show ${correct ? 'correct' : 'incorrect'}`;
                    feedback.innerHTML = correct ? 
                        '‚úÖ Toutes les associations sont correctes !' :
                        '‚ùå Certaines associations sont incorrectes ou manquantes.';
                }
                
                if (correct) score++;
            });
            
            // Show results
            const percentage = Math.round((score / total) * 100);
            let message = '';
            if (percentage >= 90) message = 'üèÜ Excellent ! Vous ma√Ætrisez parfaitement le sujet !';
            else if (percentage >= 75) message = 'üéâ Tr√®s bien ! Bonne compr√©hension globale.';
            else if (percentage >= 60) message = 'üëç Bien ! Continuez √† r√©viser.';
            else message = 'üìö Continuez vos efforts. Revoyez les notions importantes.';
            
            const resultsDiv = document.getElementById('testResults');
            resultsDiv.style.display = 'block';
            resultsDiv.innerHTML = `
                <div style="background: #f8f9fa; padding: 30px; border-radius: 15px; margin-top: 30px; text-align: center;">
                    <h2 style="color: #667eea; margin-bottom: 20px;">R√©sultats du test</h2>
                    <div style="font-size: 3em; font-weight: bold; color: #667eea; margin: 20px 0;">
                        ${percentage}%
                    </div>
                    <p style="font-size: 1.2em; color: #333; margin: 20px 0;">${message}</p>
                    <p style="color: #666;">Score : ${score} / ${total} questions correctes</p>
                    <button class="btn btn-primary" onclick="renderTest()" style="margin-top: 20px;">üîÑ Recommencer le test</button>
                </div>
            `;
            
            document.getElementById('submitBtn').style.display = 'none';
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // Initialize
        loadState();
    </script>
</body>
</html>