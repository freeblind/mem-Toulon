<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TD Complet - UE 3.2 S1 - Imagerie Radiologique</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2em; margin-bottom: 10px; }
        .header p { font-size: 1.1em; opacity: 0.9; }
        .td-selector { display: flex; gap: 10px; justify-content: center; margin-top: 20px; flex-wrap: wrap; }
        .td-btn { padding: 12px 25px; border: 2px solid white; border-radius: 25px; background: transparent; color: white; font-weight: 600; cursor: pointer; transition: all 0.3s; }
        .td-btn:hover, .td-btn.active { background: white; color: #667eea; }
        .td-btn.td2 { border-color: #11998e; } .td-btn.td2:hover, .td-btn.td2.active { background: #11998e; color: white; }
        .td-btn.td3 { border-color: #667eea; } .td-btn.td3:hover, .td-btn.td3.active { background: #667eea; color: white; }
        .td-btn.td4 { border-color: #1e3c72; } .td-btn.td4:hover, .td-btn.td4.active { background: #1e3c72; color: white; }
        .td-btn.random { border-color: #e74c3c; } .td-btn.random:hover, .td-btn.random.active { background: #e74c3c; color: white; }
        .progress-bar { background: #f0f0f0; height: 8px; margin: 20px 30px; border-radius: 10px; overflow: hidden; }
        .progress-fill { height: 100%; background: linear-gradient(90deg, #667eea 0%, #764ba2 100%); width: 0%; transition: width 0.5s ease; }
        .question-container { padding: 30px; display: none; }
        .question-container.active { display: block; animation: fadeIn 0.5s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .question-header { background: #f8f9fa; padding: 20px; border-radius: 10px; margin-bottom: 30px; border-left: 5px solid #667eea; }
        .question-number { color: #667eea; font-weight: bold; font-size: 1.2em; margin-bottom: 10px; }
        .question-text { font-size: 1.1em; line-height: 1.6; color: #333; }
        .theme-section { background: linear-gradient(135deg, rgba(102,126,234,0.1) 0%, rgba(118,75,162,0.1) 100%); padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; border-left: 4px solid #667eea; }
        .theme-title { font-weight: bold; color: #667eea; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px; }
        .td-badge { display: inline-block; padding: 5px 12px; border-radius: 15px; font-size: 0.8em; font-weight: 600; margin-right: 10px; }
        .td-badge.td2 { background: #11998e; color: white; }
        .td-badge.td3 { background: #667eea; color: white; }
        .td-badge.td4 { background: #1e3c72; color: white; }
        .answer-input { width: 100%; min-height: 100px; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; font-size: 1em; font-family: inherit; resize: vertical; }
        .answer-input:focus { outline: none; border-color: #667eea; }
        .button-group { display: flex; gap: 15px; margin-top: 20px; flex-wrap: wrap; }
        .btn { padding: 12px 30px; border: none; border-radius: 8px; font-size: 1em; cursor: pointer; transition: all 0.3s; font-weight: 600; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4); }
        .btn-secondary { background: #6c757d; color: white; } .btn-secondary:hover { background: #5a6268; }
        .btn-success { background: #28a745; color: white; } .btn-success:hover { background: #218838; }
        .feedback { margin-top: 20px; padding: 15px; border-radius: 10px; display: none; }
        .feedback.show { display: block; }
        .feedback.correct { background: #d4edda; border: 2px solid #28a745; color: #155724; }
        .feedback.incorrect { background: #f8d7da; border: 2px solid #dc3545; color: #721c24; }
        .feedback.accepted { background: #d1ecf1; border: 2px solid #17a2b8; color: #0c5460; }
        .solution { margin-top: 15px; padding: 15px; background: #fff3cd; border-radius: 8px; border-left: 4px solid #ffc107; }
        .mcq-options { display: flex; flex-direction: column; gap: 15px; margin-top: 20px; }
        .mcq-option { display: flex; align-items: center; padding: 15px; border: 2px solid #e0e0e0; border-radius: 10px; cursor: pointer; transition: all 0.3s; }
        .mcq-option:hover { border-color: #667eea; background: #f8f9fa; }
        .mcq-option input { width: 20px; height: 20px; margin-right: 15px; cursor: pointer; }
        .mcq-option.selected { border-color: #667eea; background: #e7f1ff; }
        .navigation { display: flex; justify-content: space-between; padding: 30px; background: #f8f9fa; border-top: 1px solid #e0e0e0; }
        .table-container { overflow-x: auto; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; background: white; }
        th, td { padding: 12px; text-align: left; border: 2px solid #e0e0e0; }
        th { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; }
        td input[type="text"], td textarea { width: 100%; padding: 8px; border: 2px solid #e0e0e0; border-radius: 5px; }
        .solution-row { background: #fff3cd !important; font-style: italic; color: #856404; display: none; }
        .solution-row.show { display: table-row; }
        .text-gap-container { display: inline-block; min-width: 80px; margin: 0 5px; }
        .text-gap { border: none; border-bottom: 2px solid #667eea; padding: 5px; width: 100px; text-align: center; background: transparent; }
        .text-gap-solution { display: none; color: #28a745; font-weight: bold; margin-left: 10px; }
        .text-gap-solution.show { display: inline; }
        .text-to-fill { line-height: 2.5; font-size: 1.1em; }
        .stats { padding: 30px; background: #f8f9fa; text-align: center; }
        .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px; }
        .stat-card { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .stat-value { font-size: 2.5em; font-weight: bold; color: #667eea; }
        .stat-label { color: #666; margin-top: 10px; }
        .nav-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px; }
        .nav-card { background: #f8f9fa; padding: 20px; border-radius: 10px; }
        .pitch-box { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin-top: 15px; }
        .pitch-card { background: white; padding: 15px; border-radius: 10px; border: 2px solid #e0e0e0; text-align: center; }
        @media (max-width: 768px) { .header h1 { font-size: 1.5em; } .button-group, .navigation { flex-direction: column; } .btn { width: 100%; } .pitch-box, .td-selector { flex-direction: column; } }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üìö TD Complet - UE 3.2 S1</h1>
            <p>Physique appliqu√©e et technologie en imagerie radiologique</p>
            <div class="td-selector">
                <button class="td-btn td2" onclick="selectTD('td2')">TD2 - Ost√©o/Doses/Scanner</button>
                <button class="td-btn td3" onclick="selectTD('td3')">TD3 - Cha√Æne Radiologique</button>
                <button class="td-btn td4" onclick="selectTD('td4')">TD4 - Scanographie</button>
                <button class="td-btn random" onclick="startRandomMode()">üé≤ Mode Al√©atoire</button>
            </div>
        </div>
        <div class="progress-bar"><div class="progress-fill" id="progressFill"></div></div>

        <!-- PAGE ACCUEIL -->
        <div class="question-container active" id="home">
            <div class="question-header">
                <div class="question-number">üè† Bienvenue</div>
                <div class="question-text">S√©lectionnez un TD ci-dessus pour commencer ou utilisez le mode al√©atoire pour r√©viser toutes les questions dans le d√©sordre.</div>
            </div>
            <div class="nav-grid">
                <div class="nav-card" style="border-left: 4px solid #11998e;"><h4 style="color: #11998e;">ü¶¥ TD2 - 14 questions</h4><p>Ost√©odensitom√©trie, Indicateurs de dose, Analyse spectrale, Scanographie</p></div>
                <div class="nav-card" style="border-left: 4px solid #667eea;"><h4 style="color: #667eea;">üì∑ TD3 - 7 questions</h4><p>Cha√Æne radiologique, Scopie/Graphie, D√©tecteurs, Param√®tres d'acquisition</p></div>
                <div class="nav-card" style="border-left: 4px solid #1e3c72;"><h4 style="color: #1e3c72;">üñ•Ô∏è TD4 - 9 questions</h4><p>Scanographie avanc√©e, Modes d'acquisition, Pitch, Art√©facts</p></div>
            </div>
        </div>

        <!-- Questions will be loaded dynamically -->
        <div id="questionsContainer"></div>

        <!-- STATISTIQUES -->
        <div class="question-container" id="stats">
            <div class="stats">
                <h2>üéâ Statistiques</h2>
                <div class="stats-grid">
                    <div class="stat-card"><div class="stat-value" id="correctAnswers">0</div><div class="stat-label">R√©ponses correctes</div></div>
                    <div class="stat-card"><div class="stat-value" id="acceptedAnswers">0</div><div class="stat-label">R√©ponses accept√©es</div></div>
                    <div class="stat-card"><div class="stat-value" id="totalScore">0%</div><div class="stat-label">Score total</div></div>
                </div>
                <div style="margin-top: 30px; padding: 25px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 15px; color: white;">
                    <h3>üèÜ Score Final</h3>
                    <div style="font-size: 3em; font-weight: bold;" id="finalScoreDisplay">0 / 0</div>
                </div>
                <div style="margin-top: 30px;">
                    <button class="btn btn-primary" onclick="resetQuiz()">üîÑ Recommencer</button>
                    <button class="btn btn-secondary" onclick="goHome()">üè† Accueil</button>
                </div>
            </div>
        </div>

        <div class="navigation">
            <button class="btn btn-secondary" id="prevBtn" onclick="previousQuestion()" style="display: none;">‚Üê Pr√©c√©dent</button>
            <button class="btn btn-primary" id="nextBtn" onclick="nextQuestion()" style="display: none;">Suivant ‚Üí</button>
        </div>
    </div>

    <script>
        // ============ DATA ============
        const questionsData = {
            td2: [
                { id: 'td2_q1', theme: 'ü¶¥ Ost√©odensitom√©trie', title: 'Question 1 - Tableau', text: 'Ost√©odensitom√©trie - Bases', type: 'table',
                  fields: [
                    {q: 'D√©finition de l\'ost√©odensitom√©trie', sol: 'Examen m√©dical mesurant la densit√© osseuse (DMO)'},
                    {q: 'Signification de l\'acronyme DMO', sol: 'Densit√© Min√©rale Osseuse, en gramme/cm¬≤'},
                    {q: 'Principe physique (loi)', sol: 'Loi d\'absorption ‚Äì mesure de l\'att√©nuation d\'un faisceau de photons'},
                    {q: 'Technologie radiologique', sol: 'Absorption biphotonique - √âmission de photons X √† 2 √©nergies diff√©rentes'},
                    {q: '√ânergies utilis√©es', sol: '70/140 kV ou 100/140 kV'},
                    {q: 'Obtention des √©nergies', sol: 'Variation de la tension du tube ou tension constante avec filtration par terre rare'},
                    {q: '3 g√©om√©tries de faisceau', sol: 'Faisceau droit, Faisceau en √©ventail √©troit, Faisceau en √©ventail large'},
                    {q: '2 types de d√©tecteur', sol: 'Conversion indirecte (RX‚Üílumi√®re‚Üísignal) et Conversion directe (RX‚Üísignal)'}
                  ]},
                { id: 'td2_q2', theme: 'üìä Indicateurs de Dose', title: 'Question 2 - Tableau', text: 'Indicateurs dosim√©triques en radiologie', type: 'table',
                  fields: [
                    {q: 'Indicateur dosim√©trique en radiologie', sol: 'Produit Dose Surface (PDS)'},
                    {q: 'Unit√©', sol: 'mGy.cm¬≤'},
                    {q: 'Valeur transmise', sol: 'Dose d√©livr√©e au patient'},
                    {q: 'Document mentionnant cet indicateur', sol: 'Compte rendu radiologique'},
                    {q: 'Proc√©d√© de recueil', sol: 'Chambre d\'ionisation ou Calculateur int√©gr√©'},
                    {q: 'R√©f√©rence de comparaison', sol: 'Niveaux de R√©f√©rence Diagnostique (NRD)'},
                    {q: 'Int√©r√™t', sol: '√âvaluer ses pratiques'},
                    {q: 'Dose √† l\'entr√©e', sol: '√ânergie en un point √† la peau du patient'},
                    {q: 'Comment estimer la dose √† l\'entr√©e', sol: 'Tension, charge, DFP √ó facteur de r√©trodiffusion'},
                    {q: 'Facteurs de r√©trodiffusion', sol: '1,1 enfants | 1,3 adultes (60-80kV) | 1,5 haute tension (120-140kV)'}
                  ]},
                { id: 'td2_q3', theme: 'üìä Indicateurs de Dose', title: 'Question 3 - Tableau', text: 'Indicateurs dosim√©triques par modalit√©', type: 'table',
                  fields: [
                    {q: 'Scanographie', sol: 'IDSV (mGy) - Indice de Dose Scanographique Volumique | PDL (mGy.cm)'},
                    {q: 'Imagerie radioguid√©e', sol: 'PDS (Gy.cm¬≤) | Temps de scopie | Kerma (mGy)'},
                    {q: 'M√©decine nucl√©aire', sol: 'Activit√© (MBq) | IDSV (mGy) | PDL (mGy.cm)'},
                    {q: 'Mammographie', sol: 'DMG (mGy) - Dose Glandulaire Moyenne'}
                  ]},
                { id: 'td2_q4', theme: 'üìä Optimisation', title: 'Question 4', text: 'NRD, VGD et NRL - Significations et objectifs', type: 'open',
                  solution: '<strong>NRD:</strong> Niveaux de R√©f√©rence Diagnostique<br><strong>VGD:</strong> Valeur Guide Diagnostique<br><strong>NRL:</strong> Niveaux de R√©f√©rence Local<br><br><strong>Objectifs:</strong> D√©finir les modalit√©s d\'√©valuation des doses, d√©finir les niveaux de r√©f√©rence nationaux, transmettre les donn√©es √† l\'IRSN'},
                { id: 'td2_q5', theme: 'üìä Optimisation', title: 'Question 5', text: 'D√©marche d\'optimisation', type: 'open',
                  solution: '<strong>1.</strong> Compromis entre qualit√© image et dose<br><strong>2.</strong> Les 4 acteurs: Physicien m√©dical, Radiologue, Manipulateur, Ing√©nieur d\'application<br><strong>3.</strong> NRL > NRD: D√©marche d\'optimisation prioritaire<br><strong>4.</strong> VGD < NRL < NRD: D√©marche pour atteindre la VGD<br><strong>5.</strong> NRL < VGD de 20%: √âvaluation de la qualit√© image'},
                { id: 'td2_q6', theme: 'üìà Analyse Spectrale', title: 'Question 6', text: 'Analyse spectrale et spectre de Fourier', type: 'open',
                  solution: '<strong>Analyse spectrale:</strong> Trouver toutes les sinuso√Ødes qui contribuent au signal: identifier fr√©quences et amplitudes.<br><strong>Spectre de Fourier:</strong> Repr√©sentation graphique fr√©quences/amplitudes d\'un signal p√©riodique.'},
                { id: 'td2_q7', theme: 'üìà Analyse Spectrale', title: 'Question 7 - Vrai/Faux', text: 'Spectre de Fourier', type: 'trueFalse',
                  items: [
                    {text: 'Sur un spectre de Fourier, le 1er pic (f0) = FONDAMENTAL et les autres = HARMONIQUES', answer: 'true'},
                    {text: 'Le spectre de Fourier repr√©sente un signal p√©riodique ET non p√©riodique', answer: 'false'},
                    {text: 'Seul le signal sinuso√Ødal est simple, les autres sont une somme de sinuso√Ødes', answer: 'true'},
                    {text: 'Le spectre du signal CR√âNEAU poss√®de 1 seul pic appel√© harmonique', answer: 'false'}
                  ]},
                { id: 'td2_q8', theme: 'üìà Analyse Spectrale', title: 'Question 8 - Calcul', text: 'Signal de p√©riode T = 4 ms : Calculer la fr√©quence', type: 'open',
                  solution: '<strong>P√©riode:</strong> T = 4 ms = 4√ó10‚Åª¬≥ s = 0,004 s<br><strong>Fr√©quence:</strong> f = 1/T = 1/(4√ó10‚Åª¬≥) = <strong>250 Hz</strong>'},
                { id: 'td2_q9', theme: 'üî¨ Scanographie', title: 'Question 9 - Texte √† trous', text: 'Le scanner - D√©finition', type: 'fillGaps',
                  gaps: [
                    {text: 'Le scanner est une technique d\'imagerie par', sol: 'rotation'},
                    {text: 'qui utilise les', sol: 'photons X'},
                    {text: 'pour cr√©er des images', sol: 'axiales'},
                    {text: '', sol: 'anatomiques'},
                    {text: 'et parfois', sol: 'fonctionnelles'},
                    {text: 'TDM =', sol: 'Tomodensitom√©trie'},
                    {text: 'CT =', sol: 'Computerized Tomography'}
                  ]},
                { id: 'td2_q10', theme: 'üî¨ Scanographie', title: 'Question 10', text: 'Quelles sont les 2 propri√©t√©s du scanner ?', type: 'open',
                  solution: '<strong>Propri√©t√© 1:</strong> Mesure de densit√© des volumes √©l√©mentaires √† partir de l\'att√©nuation RX.<br><strong>Propri√©t√© 2:</strong> Reconstruction d\'une image en coupe √† partir des projections transversales.'},
                { id: 'td2_q11', theme: 'üî¨ Scanographie', title: 'Question 11', text: '√âchelle de Hounsfield', type: 'open',
                  solution: '<strong>√âchelle de Hounsfield:</strong> Compare les densit√©s en se r√©f√©rant √† l\'eau.<br><strong>UH:</strong> Unit√©s Hounsfield = Nombre CT<br><strong>Valeurs:</strong> OS = +1000 | EAU = 0 | AIR = -1000'},
                { id: 'td2_q12', theme: 'üî¨ Scanographie', title: 'Question 12', text: 'Le fen√™trage en scanographie', type: 'open',
                  solution: '<strong>Fen√™trage:</strong> Zoom en contraste sur une portion de l\'√©chelle de Hounsfield.<br><strong>Param√®tres:</strong> WL (Window Level) = niveau | WW (Window Width) = largeur'},
                { id: 'td2_q13', theme: 'üî¨ Scanographie', title: 'Question 13 - Tableau', text: 'Comparer les scanners 1√®re, 3√®me et 6√®me g√©n√©ration', type: 'table',
                  fields: [
                    {q: 'Configuration 1√®re g√©n', sol: 'Tube RX + 1 seul d√©tecteur'},
                    {q: 'Configuration 3√®me g√©n', sol: 'D√©tecteurs en arc de cercle centr√©s sur le foyer'},
                    {q: 'Configuration 6√®me g√©n', sol: 'Am√©liorations des appareils 3√®me g√©n√©ration'},
                    {q: 'Mouvement 1√®re g√©n', sol: 'Translation + rotation degr√© par degr√©'},
                    {q: 'Mouvement 3√®me g√©n', sol: 'Rotation seule (plus de translation)'},
                    {q: 'Mouvement 6√®me g√©n', sol: 'Rotation continue, multibarrettes'}
                  ]},
                { id: 'td2_q14', theme: 'üî¨ Scanographie', title: 'Question 14 - Tableau', text: 'Scanner en imagerie spectrale', type: 'table',
                  fields: [
                    {q: 'Bitube', sol: '2 tubes perpendiculaires √©mettant √† 80 et 140 kV'},
                    {q: 'kV switching', sol: '√âmission alternative 80/140 kV par rotation'},
                    {q: 'Succession de rotation', sol: 'Une rotation √† 80 kV et l\'autre √† 140 kV'},
                    {q: 'Twin beam', sol: 'Faisceau X 120 kV subdivis√© par des filtres diff√©rents'},
                    {q: 'Superposition d√©tecteurs', sol: 'Couche sup: √©nergies faibles | Couche inf: √©nergies √©lev√©es'},
                    {q: 'Comptage photonique', sol: 'Discrimination √©nerg√©tique des photons'}
                  ]}
            ],
            td3: [
                { id: 'td3_q1', theme: 'üì∑ Cha√Æne Radiologique', title: 'Question 1', text: 'Facteurs de qualit√© image et √©l√©ments additionnels', type: 'open',
                  solution: '<strong>Les 4 facteurs:</strong> 1) kV/mAs (constantes), 2) Type radiographie, 3) Corpulence patient, 4) Flous divers.<br><strong>√âl√©ments additionnels:</strong> Diaphragme, C√¥ne, Air-Gap (Groedel), Grilles, Compression, Filtres compensatoires.'},
                { id: 'td3_q2', theme: 'üì∑ Cha√Æne Radiologique', title: 'Question 2 - Tableau', text: 'Diff√©rencier Scopie et Graphie', type: 'table',
                  fields: [
                    {q: 'Type d\'image - Scopie', sol: 'Image dynamique / en temps r√©el'},
                    {q: 'Type d\'image - Graphie', sol: 'Image statique (instant T)'},
                    {q: 'Sauvegarde - Scopie', sol: 'Image non sauvegard√©e'},
                    {q: 'Sauvegarde - Graphie', sol: 'Image fig√©e et sauvegard√©e'},
                    {q: 'Irradiation - Scopie', sol: 'Moins irradiante (faible mA)'},
                    {q: 'Irradiation - Graphie', sol: 'Image coup√©e par la cellule'},
                    {q: 'Qualit√© - Scopie', sol: 'Moins bonne qualit√© image'},
                    {q: 'Qualit√© - Graphie', sol: 'Meilleure qualit√© image'}
                  ]},
                { id: 'td3_q3', theme: 'üì∑ D√©tecteurs', title: 'Question 3', text: 'Amplificateur de Brillance - 4 √©tapes', type: 'open',
                  solution: '<strong>Nom:</strong> Amplificateur de Brillance (IA II)<br><strong>4 √©tapes:</strong> 1. Conversion RX‚Üílumi√®re (√©cran CsI), 2. Conversion lumi√®re‚Üí√©lectrons (photocathode), 3. Acc√©l√©ration et focalisation (25-35 kV), 4. Conversion √©lectrons‚Üílumi√®re (√©cran de sortie)'},
                { id: 'td3_q4', theme: 'üì∑ D√©tecteurs', title: 'Question 4 - Tableau', text: 'Capteur Plan (FPXD)', type: 'table',
                  fields: [
                    {q: 'Nom complet', sol: 'Flat Panel X-ray Detector'},
                    {q: 'Couche de conversion', sol: 'Scintillateur (CsI ou Gd2O2S) ou S√©l√©nium amorphe'},
                    {q: 'Matrice TFT', sol: 'Thin Film Transistor - Matrice de pixels pour lecture'},
                    {q: '2 circuits', sol: 'Circuit adressage (gate driver) + Circuit lecture (data line)'}
                  ]},
                { id: 'td3_q5', theme: '‚öôÔ∏è Param√®tres', title: 'Question 5 - Tableau', text: 'kV, mA, s, mAs', type: 'table',
                  fields: [
                    {q: 'kV - D√©nomination', sol: 'Tension'},
                    {q: 'mA - D√©nomination', sol: 'Intensit√©'},
                    {q: 's - D√©nomination', sol: 'Temps de pose'},
                    {q: 'mAs - D√©nomination', sol: 'Charge'},
                    {q: 'kV - Production RX', sol: '√ânergie et p√©n√©tration'},
                    {q: 'mA/s/mAs - Production RX', sol: 'Quantit√© RX'},
                    {q: 'kV - Qualit√© image', sol: 'Contraste + Noircissement'},
                    {q: 'mA/s - Qualit√© image', sol: 'Rapport S/B'}
                  ]},
                { id: 'td3_q6', theme: '‚öôÔ∏è Tube RX', title: 'Question 6 - Vrai/Faux', text: 'Foyers et Anode', type: 'trueFalse',
                  items: [
                    {text: 'L\'anode tournante permet de dissiper la chaleur plus efficacement', answer: 'true'},
                    {text: 'L\'angle d\'anode influence la taille du foyer optique', answer: 'true'},
                    {text: 'Le foyer optique est plus petit que le foyer thermique', answer: 'true'},
                    {text: 'Un petit foyer am√©liore la r√©solution spatiale de l\'image', answer: 'true'},
                    {text: 'Le petit foyer sera utilis√© pour les membres et la p√©diatrie', answer: 'true'},
                    {text: 'Le grand foyer sera utilis√© pour les zones √©paisses et p√©ristaltiques', answer: 'true'}
                  ]},
                { id: 'td3_q7', theme: '‚öôÔ∏è Param√©trage', title: 'Question 7 - Tableau', text: 'Techniques 2 points vs 1 point + Cellules', type: 'table',
                  fields: [
                    {q: '2 points (kV + mAs manuels)', sol: 'DIRECT - Organe sur d√©tecteur'},
                    {q: '1 point (kV manuel + cellules)', sol: 'POTTER - D√©tecteur dans potter'},
                    {q: 'Nombre de cellules', sol: '3 : 2 lat√©rales + 1 centrale'},
                    {q: 'R√¥le des cellules', sol: 'Stopper RX quand nombre suffisant'},
                    {q: 'S√©lectionn√©es par', sol: 'MEM selon clich√©'},
                    {q: 'Technologie', sol: 'Chambre ionisation ‚Üí courant ‚Üí condensateur ‚Üí coupe RX'}
                  ]}
            ],
            td4: [
                { id: 'td4_q1', theme: 'üñ•Ô∏è Scanographie', title: 'Question 1', text: 'Les 4 syst√®mes de la cha√Æne scanographique', type: 'open',
                  solution: '<strong>1. Syst√®me de production RX:</strong> G√©n√©rateur HT, Tube RX, Filtres, Collimateurs<br><strong>2. Syst√®me de d√©tection:</strong> D√©tecteur primaire (chambre ionisation), D√©tecteurs secondaires (barrettes)<br><strong>3. Syst√®me informatique:</strong> Console, Reconstruction, Traitement images<br><strong>4. Syst√®me patient:</strong> Table, Statif (rotor/stator)'},
                { id: 'td4_q2', theme: 'üñ•Ô∏è Scanographie', title: 'Question 2 - Vrai/Faux', text: 'Caract√©ristiques des scanners modernes', type: 'trueFalse',
                  items: [
                    {text: 'Les scanners actuels sont de 3√®me g√©n√©ration, rotation continue, h√©lico√Ødal et multi barrettes', answer: 'true'},
                    {text: 'Le transfert √©lectrique se fait par WIFI', answer: 'false'},
                    {text: 'Le transfert des donn√©es se fait via SLIP RING ou WIFI', answer: 'true'},
                    {text: 'Le stator est la partie mobile du statif', answer: 'false'},
                    {text: 'Le rotor est la partie fixe du statif', answer: 'false'},
                    {text: 'Un scanner mono-barrette a 1 seule couronne de d√©tecteur dans l\'axe Z', answer: 'true'},
                    {text: 'Un scanner ¬´ 64 barrettes ¬ª poss√®de 32 rang√©es de d√©tecteurs dans l\'axe Z', answer: 'false'}
                  ]},
                { id: 'td4_q3', theme: 'üñ•Ô∏è Scanographie', title: 'Question 3 - Texte √† trous', text: 'Caract√©ristiques du g√©n√©rateur scanographique', type: 'fillGaps',
                  gaps: [
                    {text: 'Haute tension continue: __ √† __ kV', sol: '70 √† 140'},
                    {text: 'Intensit√© constante: __ √† __ mA', sol: '10 √† 1000'},
                    {text: 'Puissance totale: __ √† __ kW', sol: '50 √† 60'}
                  ]},
                { id: 'td4_q4', theme: 'üñ•Ô∏è Scanographie', title: 'Question 4 - Texte √† trous', text: 'Les d√©tecteurs scanographiques', type: 'fillGaps',
                  gaps: [
                    {text: 'D√©tecteur __ (sortie tube) = chambre d\'ionisation', sol: 'primaire'},
                    {text: 'Mesure les indicateurs de __', sol: 'dose'},
                    {text: 'D√©tecteurs __ (barrettes) apr√®s le patient', sol: 'secondaires'},
                    {text: 'Transformer en signal __', sol: '√©lectrique'}
                  ]},
                { id: 'td4_q5', theme: 'üñ•Ô∏è Scanographie', title: 'Question 5 - Tableau', text: 'Les 2 filtrations scanographiques', type: 'table',
                  fields: [
                    {q: 'Filtre 1 - Nom', sol: 'Filtre plat'},
                    {q: 'Filtre 1 - Localisation', sol: 'En sortie du tube'},
                    {q: 'Filtre 1 - R√¥le', sol: 'Homog√©n√©iser - Durcissement - Alu min 2,5mm'},
                    {q: 'Filtre 2 - Nom', sol: 'Filtre papillon'},
                    {q: 'Filtre 2 - Localisation', sol: 'Entre filtre plat et collimateur'},
                    {q: 'Filtre 2 - R√¥le', sol: 'Homog√©n√©iser l\'irradiation - Morphologie'}
                  ]},
                { id: 'td4_q6', theme: 'üñ•Ô∏è Scanographie', title: 'Question 6 - Tableau', text: 'Les collimateurs', type: 'table',
                  fields: [
                    {q: 'Collimateur PRIMAIRE (1-Sortie tube, 3-Apr√®s filtrage, 5-Ouverture champ x/y, 7-√âpaisseur collimation z)', sol: '1 ‚Äì 3 ‚Äì 5 ‚Äì 7'},
                    {q: 'Collimateur SECONDAIRE (2-Devant d√©tecteur, 4-Limite p√©nombres, 6-Affine profil z)', sol: '2 ‚Äì 4 ‚Äì 6'}
                  ]},
                { id: 'td4_q7', theme: 'üñ•Ô∏è Scanographie', title: 'Question 7 - Tableau', text: 'Modes d\'acquisition scanographiques', type: 'table',
                  fields: [
                    {q: 'Rotation continue + Table fixe + Interventionnel/Perfusion', sol: 'Mode CIN√â - Acquisition continue sur m√™me zone'},
                    {q: '1 rotation + Table fixe + Coupe apr√®s coupe', sol: 'Mode S√âQUENTIEL - C≈ìur, Cr√¢ne'},
                    {q: 'Tube fixe + Table d√©placement + Face et profil', sol: 'Mode RADIO/SCOUT/TOPOGRAMME - Rep√©rage, Modulation mA'},
                    {q: 'Rotation continue + Table d√©placement + Conventionnel/Oncologie/Urgence', sol: 'Mode H√âLICO√èDAL - Volume en 1 acquisition'}
                  ]},
                { id: 'td4_q8', theme: 'üñ•Ô∏è Scanographie', title: 'Question 8', text: 'Le Pitch en scanographie', type: 'open',
                  solution: '<strong>Pitch:</strong> Rapport entre l\'avancement de table par rotation et l\'√©paisseur de collimation.<br><strong>Formule:</strong> Pitch = Avancement table / Collimation<br><strong>P&lt;1:</strong> Chevauchement (surirradiation)<br><strong>P=1:</strong> Coupes jointives<br><strong>P&gt;1:</strong> Espacement (interpolation n√©cessaire)'},
                { id: 'td4_q9', theme: 'üñ•Ô∏è Scanographie', title: 'Question 9', text: 'Citez 3 art√©facts en scanographie et leurs causes', type: 'open',
                  solution: '<strong>1. Art√©facts m√©talliques:</strong> Stries dues aux implants m√©talliques<br><strong>2. Art√©facts de mouvement:</strong> Flou d√ª au mouvement du patient<br><strong>3. Art√©facts de durcissement:</strong> Bandes sombres entre structures denses'}
            ]
        };
        let currentTD = null;
        let currentQuestionIndex = 0;
        let questionOrder = [];
        let isRandomMode = false;
        let answers = { correct: 0, accepted: 0, total: 0, answered: new Set() };

        // ============ RENDER QUESTIONS ============
        function renderQuestion(q, td) {
            let html = '<div class="question-container" id="' + q.id + '" data-td="' + td + '">';
            html += '<div class="question-header">';
            html += '<span class="td-badge ' + td + '">' + td.toUpperCase() + '</span>';
            html += '<div class="theme-section"><div class="theme-title">' + q.theme + '</div></div>';
            html += '<div class="question-number">' + q.title + '</div>';
            html += '<div class="question-text"><strong>' + q.text + '</strong></div></div>';

            if (q.type === 'table') {
                html += '<div class="table-container"><table><thead><tr><th>Question</th><th>Votre r√©ponse</th></tr></thead><tbody>';
                q.fields.forEach((f, i) => {
                    html += '<tr><td><strong>' + f.q + '</strong></td><td><input type="text" id="' + q.id + '_' + i + '" placeholder="Votre r√©ponse"></td></tr>';
                    html += '<tr class="solution-row"><td colspan="2" class="solution-cell">üí° ' + f.sol + '</td></tr>';
                });
                html += '</tbody></table></div>';
            } else if (q.type === 'trueFalse') {
                q.items.forEach((item, i) => {
                    html += '<div style="margin-bottom: 30px;"><div style="padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 15px;"><strong>' + (i+1) + '. ' + item.text + '</strong></div>';
                    html += '<div class="mcq-options">';
                    html += '<label class="mcq-option"><input type="radio" name="' + q.id + '_' + i + '" value="true"><span>VRAI</span></label>';
                    html += '<label class="mcq-option"><input type="radio" name="' + q.id + '_' + i + '" value="false"><span>FAUX</span></label>';
                    html += '</div></div>';
                });
            } else if (q.type === 'fillGaps') {
                html += '<div class="text-to-fill">';
                q.gaps.forEach((g, i) => {
                    html += '<p>' + g.text + ' <span class="text-gap-container"><input type="text" id="' + q.id + '_' + i + '" class="text-gap" placeholder="..."><span class="text-gap-solution" id="sol_' + q.id + '_' + i + '">' + g.sol + '</span></span></p>';
                });
                html += '</div>';
            } else {
                html += '<textarea class="answer-input" id="' + q.id + '_answer" placeholder="Tapez votre r√©ponse ici..."></textarea>';
            }

            html += '<div class="button-group">';
            html += '<button class="btn btn-primary" onclick="checkQuestion(\'' + q.id + '\')">V√©rifier</button>';
            html += '<button class="btn btn-success" onclick="acceptAnswer(\'' + q.id + '\')">Accepter</button>';
            html += '</div>';
            html += '<div class="feedback" id="feedback_' + q.id + '"></div></div>';
            return html;
        }

        function initQuestions() {
            let html = '';
            Object.keys(questionsData).forEach(td => {
                questionsData[td].forEach(q => { html += renderQuestion(q, td); });
            });
            document.getElementById('questionsContainer').innerHTML = html;
        }

        // ============ NAVIGATION ============
        function selectTD(td) {
            currentTD = td;
            isRandomMode = false;
            questionOrder = questionsData[td].map(q => q.id);
            currentQuestionIndex = 0;
            answers = { correct: 0, accepted: 0, total: questionOrder.length, answered: new Set() };
            document.querySelectorAll('.td-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.td-btn.' + td).classList.add('active');
            showQuestion(questionOrder[0]);
            updateNavButtons();
            updateProgress();
        }

        function startRandomMode() {
            isRandomMode = true;
            currentTD = 'random';
            questionOrder = [];
            Object.keys(questionsData).forEach(td => {
                questionsData[td].forEach(q => questionOrder.push(q.id));
            });
            for (let i = questionOrder.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [questionOrder[i], questionOrder[j]] = [questionOrder[j], questionOrder[i]];
            }
            currentQuestionIndex = 0;
            answers = { correct: 0, accepted: 0, total: questionOrder.length, answered: new Set() };
            document.querySelectorAll('.td-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.td-btn.random').classList.add('active');
            showQuestion(questionOrder[0]);
            updateNavButtons();
            updateProgress();
        }

        function showQuestion(questionId) {
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            const question = document.getElementById(questionId);
            if (question) question.classList.add('active');
        }

        function goHome() {
            currentTD = null;
            questionOrder = [];
            document.querySelectorAll('.td-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            document.getElementById('home').classList.add('active');
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
        }

        function updateProgress() {
            if (questionOrder.length > 0) {
                const progress = (currentQuestionIndex / questionOrder.length) * 100;
                document.getElementById('progressFill').style.width = progress + '%';
            }
        }

        function updateNavButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            if (!currentTD) { prevBtn.style.display = 'none'; nextBtn.style.display = 'none'; return; }
            prevBtn.style.display = currentQuestionIndex > 0 ? 'block' : 'none';
            nextBtn.textContent = currentQuestionIndex >= questionOrder.length - 1 ? 'Voir statistiques ‚Üí' : 'Suivant ‚Üí';
            nextBtn.style.display = 'block';
        }

        function nextQuestion() {
            if (currentQuestionIndex < questionOrder.length - 1) {
                currentQuestionIndex++;
                showQuestion(questionOrder[currentQuestionIndex]);
            } else { showStats(); }
            updateNavButtons();
            updateProgress();
        }

        function previousQuestion() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                showQuestion(questionOrder[currentQuestionIndex]);
            }
            updateNavButtons();
            updateProgress();
        }

        function showStats() {
            document.querySelectorAll('.question-container').forEach(q => q.classList.remove('active'));
            document.getElementById('stats').classList.add('active');
            document.getElementById('correctAnswers').textContent = answers.correct;
            document.getElementById('acceptedAnswers').textContent = answers.accepted;
            const total = answers.correct + answers.accepted;
            const percentage = answers.total > 0 ? Math.round((total / answers.total) * 100) : 0;
            document.getElementById('totalScore').textContent = percentage + '%';
            document.getElementById('finalScoreDisplay').textContent = total + ' / ' + answers.total;
            document.getElementById('prevBtn').style.display = 'none';
            document.getElementById('nextBtn').style.display = 'none';
        }

        // ============ CHECK FUNCTIONS ============
        function getQuestionData(id) {
            for (let td of Object.keys(questionsData)) {
                const q = questionsData[td].find(q => q.id === id);
                if (q) return q;
            }
            return null;
        }

        function checkQuestion(id) {
            const q = getQuestionData(id);
            const feedback = document.getElementById('feedback_' + id);
            
            if (q.type === 'table' || q.type === 'fillGaps') {
                document.querySelectorAll('#' + id + ' .solution-row').forEach(row => row.classList.add('show'));
                document.querySelectorAll('#' + id + ' .text-gap-solution').forEach(sol => sol.classList.add('show'));
                feedback.classList.remove('correct', 'incorrect', 'accepted');
                feedback.classList.add('show', 'correct');
                feedback.innerHTML = '<strong>‚úÖ Solutions affich√©es !</strong> Comparez vos r√©ponses.';
                if (!answers.answered.has(id)) { answers.correct++; answers.answered.add(id); }
            } else if (q.type === 'trueFalse') {
                const selectedAnswers = [];
                q.items.forEach((_, i) => {
                    const selected = document.querySelector('input[name="' + id + '_' + i + '"]:checked');
                    selectedAnswers.push(selected ? selected.value : null);
                });
                if (selectedAnswers.includes(null)) {
                    feedback.classList.remove('correct', 'incorrect');
                    feedback.classList.add('show', 'incorrect');
                    feedback.innerHTML = '<strong>‚ö†Ô∏è</strong> R√©pondez √† toutes les affirmations.';
                    return;
                }
                const isCorrect = q.items.every((item, i) => item.answer === selectedAnswers[i]);
                feedback.classList.remove('correct', 'incorrect', 'accepted');
                feedback.classList.add('show');
                if (!answers.answered.has(id)) {
                    if (isCorrect) {
                        feedback.classList.add('correct');
                        feedback.innerHTML = '<strong>‚úÖ Parfait !</strong>';
                        answers.correct++;
                        answers.answered.add(id);
                    } else {
                        feedback.classList.add('incorrect');
                        let txt = '<strong>‚ùå Erreur(s)</strong><br>Solutions: ';
                        txt += q.items.map((item, i) => (i+1) + ': ' + (item.answer === 'true' ? 'VRAI' : 'FAUX')).join(', ');
                        feedback.innerHTML = txt;
                    }
                }
            } else {
                feedback.classList.remove('correct', 'incorrect', 'accepted');
                feedback.classList.add('show', 'correct');
                feedback.innerHTML = '<strong>‚úÖ Voici la solution :</strong>' + (q.solution ? '<div class="solution">' + q.solution + '</div>' : '');
                if (!answers.answered.has(id)) { answers.correct++; answers.answered.add(id); }
            }
        }

        function acceptAnswer(id) {
            const q = getQuestionData(id);
            const feedback = document.getElementById('feedback_' + id);
            if (!answers.answered.has(id)) {
                feedback.classList.remove('correct', 'incorrect');
                feedback.classList.add('show', 'accepted');
                feedback.innerHTML = '<strong>‚úì Accept√©e</strong>' + (q && q.solution ? '<div class="solution">' + q.solution + '</div>' : '');
                document.querySelectorAll('#' + id + ' .solution-row').forEach(row => row.classList.add('show'));
                document.querySelectorAll('#' + id + ' .text-gap-solution').forEach(sol => sol.classList.add('show'));
                answers.accepted++;
                answers.answered.add(id);
            }
        }

        function resetQuiz() {
            document.querySelectorAll('textarea, input[type="text"]').forEach(input => { input.value = ''; });
            document.querySelectorAll('input[type="checkbox"], input[type="radio"]').forEach(input => input.checked = false);
            document.querySelectorAll('.feedback').forEach(fb => fb.classList.remove('show', 'correct', 'incorrect', 'accepted'));
            document.querySelectorAll('.mcq-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelectorAll('.solution-row').forEach(row => row.classList.remove('show'));
            document.querySelectorAll('.text-gap-solution').forEach(sol => sol.classList.remove('show'));
            answers = { correct: 0, accepted: 0, total: questionOrder.length, answered: new Set() };
            currentQuestionIndex = 0;
            if (isRandomMode) startRandomMode();
            else if (currentTD && currentTD !== 'random') selectTD(currentTD);
            else goHome();
        }

        document.addEventListener('change', function(e) {
            if (e.target.type === 'radio') {
                const option = e.target.closest('.mcq-option');
                if (option) {
                    document.querySelectorAll('input[name="' + e.target.name + '"]').forEach(input => {
                        const opt = input.closest('.mcq-option');
                        if (opt) opt.classList.remove('selected');
                    });
                    option.classList.add('selected');
                }
            }
        });

        // Initialize
        initQuestions();
        goHome();
    </script>
</body>
</html>
